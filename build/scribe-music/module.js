/* Scribe 
   0.3.0
   By Stephen
   Built 2024-04-24 13:43 */

var on=Object.defineProperty;var cn=(e,t)=>{for(var r in t)on(e,r,{get:t[r],enumerable:!0})};var Sr=(e,t,r)=>{if(!t.has(e))throw TypeError("Cannot "+r)};var be=(e,t,r)=>(Sr(e,t,"read from private field"),r?r.call(e):t.get(e)),tt=(e,t,r)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,r)},Pe=(e,t,r,u)=>(Sr(e,t,"write to private field"),u?u.call(e,r):t.set(e,r),r);function fe(){}var He;function fn(e,t){let r=0;for(;e[--r];);for(e[r]=t,r=-1;t[++r];)if(t[r]===e)return;t[r]=e}function ln(e,t){let r=0;for(;e[--r];)e[r]=void 0;let u=He;He=e;let l=e.value=t();return He=u,l}var Ne,We,Ae,rt,he=class{constructor(t,r){tt(this,Ne,void 0);tt(this,We,void 0);tt(this,Ae,void 0);tt(this,rt,void 0);t&&Pe(this,rt,t),Pe(this,Ae,r||fe)}static of(t){let r=new this;return r.value=t,r}static from(t){return new this(t)}static get evaluating(){return He}set value(t){if(be(this,We)===t){Pe(this,Ne,!0);return}if(Pe(this,We,t),be(this,Ne)){let r=-1;for(;this[++r];)this[r].invalidate();be(this,Ae).call(this)}else Pe(this,Ne,!0)}get value(){return He&&fn(He,this),be(this,Ne)?be(this,We):ln(this,be(this,rt))}each(t,r){return Pe(this,Ae,()=>{let u=this.value;if(u===r){r=NaN;return}t(u)}),be(this,Ae).call(this),this}invalidate(){if(be(this,Ne)){Pe(this,Ne,!1);let t=-1;for(;this[++t];)this[t].invalidate();be(this,Ae).call(this)}return this}valueOf(){return this.value}toString(){return this.valueOf()+""}toJSON(){return this.value}};Ne=new WeakMap,We=new WeakMap,Ae=new WeakMap,rt=new WeakMap;function ye(e){return e}function j(e,t){return function(){let u=e.apply(this,arguments),l=t[u]||t.default;if(!l)throw new Error('overload() no function defined for key "'+u+'"');return l.apply(this,arguments)}}function Ue(e){var t=new Map;return function(u){if(t.has(u))return t.get(u);var l=e(u);return t.set(u,l),l}}var un=Array.prototype;function hn(e,t){return typeof e=="function"?e.apply(null,t):e}function Ir(e,t,r){r=r||e.length;var u=r===1?t?e:Ue(e):Ue(function(l){return Ir(function(){var d=[l];return d.push.apply(d,arguments),e.apply(null,d)},t,r-1)});return function l(d){return arguments.length===0?l:arguments.length===1?u(d):arguments.length>=r?e.apply(null,arguments):hn(u(d),un.slice.call(arguments,1))}}var re=Ir;var dn=j(ye,{is:fe,tag:fe,data:function(e,t,r){for(e in r)r[e]===void 0&&delete r[e];Object.assign(t.dataset,r)},dataset:function(e,t,r){Object.assign(t.dataset,r)},html:function(e,t,r){t.innerHTML=r},text:function(e,t,r){t.textContent=r},children:function(e,t,r){t.innerHTML="",t.append.apply(t,r)},points:de,cx:de,cy:de,r:de,x:de,y:de,dx:de,dy:de,transform:de,preserveAspectRatio:de,viewBox:de,default:function(e,t,r){e in t?t[e]=r:t.setAttribute(e,r)}});function de(e,t,r){t.setAttribute(e,r)}function pn(e,t){for(var r=Object.keys(t),u=r.length;u--;)dn(r[u],e,t[r[u]]);return e}var Tt=re(pn,!0);var $t="http://www.w3.org/2000/svg",Or=document.createElement("template"),Ht=(e,t)=>t&&typeof t;function Gr(e,t=""){let r=document.createRange();return r.selectNode(e),r.createContextualFragment(t)}var ae=j(Ht,{string:function(e,t){let r=document.createElementNS($t,e);return r.innerHTML=t,r},object:function(e,t){let r=document.createElementNS($t,e);return typeof t.length=="number"?r.append.apply(r,t):Tt(r,t),r},default:e=>document.createElementNS($t,e)}),mn=j(Ht,{string:function(e,t){let r=document.createElement(e);return r.innerHTML=t,r},object:function(e,t){let r=document.createElement(e);return typeof t.length=="number"?r.append.apply(r,t):Tt(r,t),r},default:e=>document.createElement(e)}),gn=j(ye,{comment:function(e,t){return document.createComment(t||"")},fragment:j(Ht,{string:function(e,t,r){return r?Gr(r,t):(Or.innerHTML=t,Or.content.cloneNode(!0))},object:function(e,t,r){let u=r?Gr(r):document.createDocumentFragment();return typeof t.length=="number"?u.append.apply(u,t):Tt(u,t),u},default:()=>document.createDocumentFragment()}),text:function(e,t){return document.createTextNode(t||"")},circle:ae,ellipse:ae,g:ae,glyph:ae,image:ae,line:ae,rect:ae,use:ae,path:ae,pattern:ae,polygon:ae,polyline:ae,svg:ae,tspan:ae,default:mn}),H=gn;function Wt(e,t,r){let u;typeof r!="string"&&r.input!==void 0&&r.index!==void 0&&(u=r,r=u.input.slice(r.index+r[0].length+(r.consumed||0)));let l=e.exec(r);if(!l)return;let d=t(l);return u&&(u.consumed=(u.consumed||0)+l.index+l[0].length+(l.consumed||0)),d}var Ss=re(Wt,!0);function vn(e,t,r){throw r.input!==void 0&&r.index!==void 0&&(r=r.input),new Error('Cannot parse string "'+(r.length>128?r.length.slice(0,128)+"…":r)+'"')}function bn(e,t,r){let u=-1;for(;++u<r.length;)t=r[u]!==void 0&&e[u]?e[u](t,r):t;return e.done?e.done(t,r):e.close?e.close(t,r):t}function yn(e,t,r,u){let l=Wt(e,d=>bn(t,r,d),u);return l===void 0?t.catch?t.catch(r,u):vn(e,t,u):l}var zr=re(yn,!0);var qr={once:!0};function at(e){return new Promise((t,r)=>{e.addEventListener("load",t,qr),e.addEventListener("error",r,qr)})}var Rr=Ue(e=>{if(!e||e.includes("undefined"))throw new Error("ERRR?");let t=H("link",{rel:"preload",as:"style",href:e}),r=at(t);return document.head.append(t),r});var $r=Symbol("internals");function xn(e){var t;if(e.attachInternals){if(t=e.attachInternals(),t.setFormValue)return t}else t={shadowRoot:elem.shadowRoot};return t.polyfillInput=H("input",{type:"hidden",name:elem.name}),elem.appendChild(t.polyfillInput),t.setFormValue=function(r){this.input.value=r},t}function Ut(e,t,r){return t[$r]=e.formAssociated?xn(t):{shadowRoot:r}}function W(e){return e[$r]}var Hr=Object.defineProperties,wn={},Cn={a:HTMLAnchorElement,article:HTMLElement,dl:HTMLDListElement,p:HTMLParagraphElement,br:HTMLBRElement,fieldset:HTMLFieldSetElement,hr:HTMLHRElement,img:HTMLImageElement,li:HTMLLIElement,ol:HTMLOListElement,optgroup:HTMLOptGroupElement,q:HTMLQuoteElement,section:HTMLElement,textarea:HTMLTextAreaElement,td:HTMLTableCellElement,th:HTMLTableCellElement,tr:HTMLTableRowElement,tbody:HTMLTableSectionElement,thead:HTMLTableSectionElement,tfoot:HTMLTableSectionElement,ul:HTMLUListElement},En={name:{set:function(e){return this.setAttribute("name",e)},get:function(){return this.getAttribute("name")||""}},form:{get:function(){return W(this).form}},labels:{get:function(){return W(this).labels}},validity:{get:function(){return W(this).validity}},validationMessage:{get:function(){return W(this).validationMessage}},willValidate:{get:function(){return W(this).willValidate}},checkValidity:{value:function(){return W(this).checkValidity()}},reportValidity:{value:function(){return W(this).reportValidity()}}},kn=0,Wr=!1;function Nn(e){return Cn[e]||window["HTML"+e[0].toUpperCase()+e.slice(1)+"Element"]||(()=>{throw new Error('Constructor not found for tag "'+e+'"')})()}var _n=zr(/^\s*<?([a-z][\w]*-[\w-]+)>?\s*$|^\s*<?([a-z][\w]*)\s+is[=\s]*["']?([a-z][\w]*-[\w-]+)["']?>?\s*$/,{1:(e,t)=>({name:t[1]}),2:(e,t)=>({name:t[3],tag:t[2]}),catch:function(e,t){throw new SyntaxError(`dom element() – name must be of the form 'element-name' or 'tag is="element-name"' (`+t+")")}},null);function Tn(e,t){if(e.hasOwnProperty(t)){let r=e[t];delete e[t],e[t]=r}return e}function Ur(e,t,r){let u=e.attachShadow({mode:t.mode||"closed",delegatesFocus:t.focusable||!1});if(r){let l=H("link",{rel:"stylesheet",href:r});u.append(l)}return u}function Mn(e,t){return typeof t=="string"?t[0]==="#"?e.appendChild(document.getElementById(t.slice(1)).content.clone(!0)):e.innerHTML=t:e.appendChild(t.content.clone(!0)),e}function Ln(e){return!!e.attribute}function Bn(e){return e.set||e.get||e.hasOwnProperty("value")}function Pn(e,t){return Ln(t[1])&&(e.attributes[t[0]]=t[1].attribute),Bn(t[1])&&(e.properties[t[0]]=t[1]),e}function Kt(e,t,r,u,l=""){let{name:d,tag:f}=_n(e),n=typeof f=="string"?Nn(f):HTMLElement,{attributes:o,properties:c}=r?Object.entries(r).reduce(Pn,{attributes:{},properties:{}}):wn;function p(){let a=Reflect.construct(n,arguments,p),i=t.mode||t.shadow?Ur(a,t,u||t.stylesheet):void 0;t.shadow&&Mn(i,t.shadow);let s=Ut(p,a,i);if(s.unconnected=!0,f&&(Wr=!0),t.construct&&t.construct.call(a,i,s),c&&Object.keys(c).reduce(Tn,a),i){let h=i.querySelectorAll('link[rel="stylesheet"]');if(h.length){let m=H("style","*:not(:has(slot:not([name]))) { display: none !important; }");i.append(m),s.stylesheetsLoadPromise=Promise.all(Array.from(h,at)).finally(()=>m.remove())}}return a}return u&&(Rr(u),l=l),p.prototype=Object.create(n.prototype,c),c&&c.value&&(p.formAssociated=!0,Hr(p.prototype,En),(t.enable||t.disable)&&(p.prototype.formDisabledCallback=function(a){let i=W(this),s=i.shadowRoot;return a?t.disable&&t.disable.call(this,s,i):t.enable&&t.enable.call(this,s,i)}),t.reset&&(p.prototype.formResetCallback=function(){let a=W(this),i=a.shadowRoot;return t.reset.call(this,i,a)}),t.restore&&(p.prototype.formStateRestoreCallback=function(){let a=W(this),i=a.shadowRoot;return t.restore.call(this,i,a)})),o&&(p.observedAttributes=Object.keys(o),p.prototype.attributeChangedCallback=function(a,i,s){return o[a].call(this,s)}),p.prototype.connectedCallback=function(){let a=W(this),i=a.shadowRoot;a.polyfillInput&&elem.appendChild(a.polyfillInput),a.unconnected&&(t.load&&a.stylesheetsLoadPromise?a.stylesheetsLoadPromise.then(()=>t.load.call(this,i,a)):t.load&&Promise.resolve().then(()=>t.load.call(this,i,a)),delete a.unconnected),t.connect&&t.connect.call(this,i,a)},t.disconnect&&(p.prototype.disconnectedCallback=function(){let a=W(this),i=a.shadowRoot;return t.disconnect.call(this,i,a)}),window.console&&window.console.log("%c<"+(f?f+" is="+d:d)+">%c "+l,"color:#3a8ab0;font-weight:600;","color:#888888;font-weight:400;"),window.customElements.define(d,p,f&&{extends:f}),f&&!Wr&&document.querySelectorAll('[is="'+d+'"]').forEach(a=>{c&&Hr(a,c);let i=t.construct&&t.construct.length>kn?Ur(a,t,u||t.stylesheet):void 0,s=Ut(p,a,i);t.construct&&t.construct.call(a,i);let h;for(h in o){let m=a.attributes[h];m&&o[h].call(a,m.value)}t.connect&&t.connect.apply(a)}),p}function Qt(e){return function(){return arguments[e]}}function pe(){return this}var Kr=Object.create,An=Object.freeze,Mt=An(Kr(Kr(Object.prototype,{at:{value:fe},shift:{value:fe},push:{value:fe},forEach:{value:fe},join:{value:function(){return""}},every:{value:function(){return!0}},filter:{value:pe},find:{value:fe},findIndex:{value:function(){return-1}},flat:{value:pe},flatMap:{value:pe},includes:{value:function(){return!1}},indexOf:{value:function(){return-1}},map:{value:pe},reduce:{value:Qt(1)},sort:{value:pe},each:{value:pe},pipe:{value:ye},start:{value:pe},stop:{value:pe},done:{value:pe},valueOf:{value:function(){return null}}}),{length:{value:0}}));function Xt(e,t){return(t%e+e)%e}var Qr=re(Xt);var Xr=Qr(12);var nt={C:0,"C♯":1,"C#":1,"D♭":1,Db:1,D:2,"D♯":3,"D#":3,"E♭":3,Eb:3,E:4,F:5,"F♯":6,"F#":6,"G♭":6,Gb:6,G:7,"G♯":8,"G#":8,"A♭":8,Ab:8,A:9,"A♯":10,"A#":10,"B♭":10,Bb:10,B:11},Fn=/^([A-G][♭♯#b]?)(-?\d)$/,Dn=/^[A-G][♭♯#b]?/,Sn=/-?\d$/;function xe(e){if(typeof e=="number")return e;var t=Fn.exec(e);return(parseInt(t[2],10)+1)*12+nt[t[1]]}function Zt(e){return typeof e=="number"?Xr(e):nt[Dn.exec(e)[0]]}var Yt=["C","C♯","D","E♭","E","F","F♯","G","G♯","A","B♭","B"];function Jt(e){return it(e)+Lt(e)}function it(e){return Yt[Xr(e)]}function Lt(e){return typeof e=="number"?Math.floor(e/12)-1:Number(nt[(Sn.exec(name)||Mt)[0]])}function In(e,t,r){let u=e(t),l=e(r);return l===u?0:u>l?1:-1}var jt=re(In,!0);function On(e,t){return t[e]}var we=re(On,!0);function Vt(e,t){return t+e}function Ce(e){return Xt(12,e)}function Ke(e,t){return e>t?1:e<t?-1:0}var er=[];function st(e){er.length=0;for(var t=e.length,r,u;t--;)r=e[t],u!==r[0]&&(u=r[0],er.push(u));return er.sort(Ke)}function Gn(e,t,r){return r.indexOf(e)===t}function tr(e,t){return e.map(r=>Ce(r+t)).filter(Gn).sort(Ke)}function Zr(e,t){return tr(e,t*7)}var rr=[{name:"C",symbol:"C∆",spellings:[0,1,0,-1,0,0,1,0,-1,0,-1,0]},{name:"D♭",symbol:"D♭∆",spellings:[0,-1,0,-1,-1,0,-1,0,-1,0,-1,-1]},{name:"D",symbol:"D∆",spellings:[0,1,0,1,0,0,1,0,1,0,-1,0]},{name:"E♭",symbol:"E♭∆",spellings:[0,-1,0,-1,0,0,-1,0,-1,0,-1,-1]},{name:"E",symbol:"E∆",spellings:[0,1,0,1,0,1,1,0,1,0,1,0]},{name:"F",symbol:"F∆",spellings:[0,-1,0,-1,0,0,1,0,-1,0,-1,0]},{name:"G♭",symbol:"G♭∆",spellings:[0,-1,0,-1,-1,0,-1,0,-1,0,-1,-1]},{name:"G",symbol:"G∆",spellings:[0,1,0,-1,0,0,1,0,1,0,-1,0]},{name:"A♭",symbol:"A♭∆",spellings:[0,-1,0,-1,-1,0,-1,0,-1,0,-1,-1]},{name:"A",symbol:"A∆",spellings:[0,1,0,1,0,0,1,0,1,0,1,0]},{name:"B♭",symbol:"B♭∆",spellings:[0,-1,0,-1,0,0,-1,0,-1,0,-1,0]},{name:"B",symbol:"B∆",spellings:[1,1,0,1,0,1,1,0,1,0,1,0]}],Yr=[0,2,4,5,7,9,11],Jr={"F♭":-8,"C♭":-7,"G♭":-6,"D♭":-5,"A♭":-4,"E♭":-3,"B♭":-2,F:-1,C:0,G:1,D:2,A:3,E:4,B:5,"F♯":6,"C♯":7,"G♯":8,"D♯":9,"A♯":10,"E♯":11,"B♯":12};function jr(e){return typeof e=="number"?e:Jr[e]}function Vr(e){return typeof e=="number"?tr(Yr,e):Zr(Yr,Jr[e])}var ta=/([ABCDEFG][b#♭♯𝄫𝄪]?)([^\/]*)(?:\/([ABCDEFG]))?/;var ea={"∆":[0,2,4,7,9,11],"∆7":[0,2,4,7,9,11],"-":[0,3,7],"-7":[0,2,3,5,7,9,10],"sus♭9":[0,1,5,7,10],"7sus♭9":[0,1,5,7,10],"∆♯11":[0,2,4,6,7,9,11],"∆(♯11)":[0,2,4,6,7,9,11],7:[0,4,7,10],13:[0,4,7,9,10],sus:[0,2,5,7,10],"7sus":[0,2,5,7,10],"-♭6":[0,2,3,5,7,8],ø:[0,3,6,10],"-∆":[0,2,3,5,7,9,11],"13sus♭9":[0,1,5,7,9,10],"∆+":[0,2,4,6,8,9,11],"∆♯5":[0,2,4,6,8,9,11],"7♯11":[0,2,4,6,7,9,10],"7♭13":[0,2,4,7,8,10],"ø(9)":[0,2,3,6,10],"7alt":[0,1,3,4,6,8,10],"∆♭6":[0,4,7,8,11]};function zn(e){return e.replace(/(maj)|(min)/,(t,r,u)=>r?"∆":u?"-":"")}function qn(e){var t=(ta.exec(e)||Mt)[1];return nt[t]}function Rn(e){let t=zn(e);return(ta.exec(t)||empty)[2]}function ra(e){let t=qn(e),r=Rn(e);return ea[r]?ea[r].map(u=>Ce(u+t)).sort(Ke):[]}var ar=j(we(1),{chord:e=>ra(e[2]),note:e=>[xe(e[2])%12],default:e=>[]});var aa=j(we(1),{chord:e=>e[3],lyric:e=>e[3],note:e=>e[4],sequence:e=>e[4],default:e=>0});var nr=[];function ot(e,t){nr.length=0;let r,u=-1;for(;(r=e[++u])&&!(r[0]>t);)(r[0]===t||r[0]+aa(r)>t)&&nr.push(r);return nr}var $n=[1/12,1/12,1/12,1/12,1/12,1/12,1/12,1/12,1/12,1/12,1/12,1/12],ia=[10,5,8,10,6,10,8,10,7,10,8,4],Hn=ia.reduce(Vt),Wn=ia.map(e=>e/Hn).map(sa),Un=[.1,.04,.1,.04,.1,.1,.04,.1,.04,.1,.04,.1].map(sa);function sa(e,t,r){return r.slice(12-t).concat(r.slice(0,12-t))}function na(e,t){for(var r=0,u=0;u<e.length;++u)r+=Math.log(t[e[u]]);return r}function Kn(e,t,r,u){var l=[],d=[],f=[],n=[],o=0,c=-1,p,a,i;for(d[o]=l;++c<12;)l[c]=Math.log(t[c])+na(e[0],u[c]),f[c]=[c];for(;++o<e.length;){for(l=[],a=[],d[o]=l,p=-1;++p<12;){for(n.length=0,n[0]=-1/0,c=-1;++c<12;)i=d[o-1][c]+Math.log(r[c][p])+na(e[o],u[p]),i>n[0]&&(n[0]=i,n[1]=c);l[p]=n[0],a[p]=f[n[1]].concat(p)}f=a}for(n.length=0,n[0]=-1/0,c=-1;++c<12;)i=d[e.length-1][c],i>n[0]&&(n[0]=i,n[1]=c);return f[n[1]]}function Qn(e,t){return e.push.apply(e,t),e}function ir(e){let t=st(e),r=t.length,u=[],l=-1,d,f;for(;++l<r;){d=t[l],f=ot(e,d);var n=f.map(ar);if(n.find(o=>o.find(Number.isNaN)!==void 0)!==void 0)throw console.log(f),new Error("toNotes has returned NaN for beatEvents");u.push(f.map(ar).reduce(Qn,[]))}return Kn(u,$n,Wn,Un)}function oa(e){let t=e.filter(l=>/^note|chord$/.test(l[1])),r=st(t),u=ir(t);return r.map((l,d)=>[l,u[d]])}function ca(e,t){let r=e.length;for(;r--;)if(e[r][0]<=t)return e[r][1];return e[0][1]}var ct={};cn(ct,{bass:()=>Jn,chords:()=>Yn,drums:()=>Vn,percussion:()=>ei,piano:()=>jn,treble:()=>sr});var Xn={"-2":"𝄫","-1":"♭",0:"",1:"♯",2:"𝄪"},Zn=/^[A-G][b#♭♯𝄫𝄪]?(-?\d)?$/;function Fe(e,t,r=0){let u=rr[Ce(e+r)],l,d,f;if(typeof t[2]=="string"){let[c,p]=Zn.exec(t[2])||[t[2]];p?(l=xe(t[2])+r,d=u.spellings[Ce(l)],f=Lt(l-d)):(l=Zt(t[2])+r,d=u.spellings[Ce(l)],f="")}else l=t[2]+r,d=u.spellings[Ce(l)],f=Lt(l-d);let n=Yt[Ce(l-d)],o=Xn[d];return n+o+f}var Yn={clef:"chords",getSpelling:Fe},sr={clef:"treble",topPitch:"G5",centerPitch:"B4",bottomPitch:"D4",getSpelling:Fe},Jn={clef:"bass",topPitch:"B3",centerPitch:"D3",bottomPitch:"F2",getSpelling:Fe},jn={clef:"piano",getSpelling:Fe,topPitch:"G5",centerPitch:"B4",bottomPitch:"D4",getPart:function(e){return/[012]$|[AC-G][b#♭♯𝄫𝄪]*3$/.test(e)?{part:"lower",centerPitch:"D3",centerRow:"stave-lower"}:{centerPitch:"B4",centerRow:"stave-upper"}}},Vn={clef:"drums",getSpelling:(e,t,r)=>t[1]==="note"?Jt(xe(t[2])):Fe(e,t,r),heads:{"E♭2":"head[x]","F♯2":"head[x]","G♯2":"head[x]","A♭2":"head[x]","B♭2":"head[x]","C♯3":"head[x]","E♭3":"head[x]",E3:"head[x]",F3:"head[x]","F♯3":"head[x]",G3:"head[x]","G♯3":"head[v]","A♭3":"head[v]",A3:"head[x]","B♭3":"head[v]",B3:"head[x]"},getHead:function(e,t){return this.heads[e]},centerPitch:"B4",getPart:function(e){return"B1 C1 A♭2 G♯2".includes(e)?{part:"feet",stemDirection:"down",tieDirection:"down",centerRow:"stave-lower"}:{stemDirection:"up",tieDirection:"up",centerRow:"stave-upper"}},getRowDiff:function(e,t){return .1}},ei={clef:"percussion",topPitch:"C4",centerPitch:"B4",bottomPitch:"A4",getSpelling:(e,t,r)=>t[1]==="note"?Jt(xe(t[2])):Fe(e,t,r)};var ne=Object.assign,{abs:fa,ceil:Mc,floor:Lc}=Math,ti=/b|♭/,ri=/#|♯/;var Qe=[0,2,4,5,7,9,11],la=["F♯","C♯","G♯","D♯","A♯","E♯","B♯","B♭","E♭","A♭","D♭","G♭","C♭","F♭"];function ai(e,t){let r=la.indexOf(e.pitch),u=la.indexOf(t.pitch);return r>u?1:r<u?-1:0}function cr(e,t){return t&&t.stemDirection||(xe(e)<xe(t.pitch)?"down":"up")}function ni(e,t,r){let u=-1;for(;e[++u]&&e[u]<=t;);return r>=e[u]}function ua(e){return e[1]==="lyric"?e[3]:e[4]}function ii(e,t,r){let u=e[r],l=cr(t.centerPitch,u);return e.splice(r,0,ne({},u,{type:"stem",stemDirection:l}),ne({},u,{type:"tail",stemDirection:l})),2}var ha=["C","D","E","F","G","A","B"];function De(e,t,r){if(e.getRowDiff)return e.getRowDiff(t,r);let u=t[0],l=parseInt(t[t.length-1],10),d=r[0],f=parseInt(r[r.length-1],10),n=ha.indexOf(u);return ha.indexOf(d)-n+(f-l)*7}function da(e,t,r,u){let l=e[0].part;if(r.length===1){if(r[0]>=u)throw new Error("Last beam index ("+a+") cant be greater than n ("+u+")");return ii(e,t,r[0])}let d=e[r[0]]&&e[r[0]].stemDirection?e[r[0]].stemDirection:r.map(x=>De(t,t.centerPitch,e[x].pitch)).reduce((x,g)=>x+g,0)/r.length<0?"up":"down",f=[],n=[],o=-1,c=0,p=0,a,i,s,h;for(;r[++o]!==void 0;)a=r[o],i=e[a],s=De(t,t.centerPitch,i.pitch),i.stemDirection=d,i.tieDirection=d==="up"?"down":"up",o<(r.length-1)/2?c+=s/Math.floor(r.length/2):o>(r.length-1)/2&&(p+=s/Math.floor(r.length/2)),h&&h.beat===i.beat?(h.range=De(t,h.pitch,i.pitch),h.pitch=h.range<0?h.stemDirection==="up"?h.pitch:i.pitch:h.stemDirection==="up"?i.pitch:h.pitch):(h=ne({},i,{type:"stem"}),f.push(h)),i.tie==="begin"&&n.push(ne({},i,{type:"tie",beat:i.beat,updown:i.tieDirection,event:i.event}));let m=f[0],v=f[f.length-1],w=De(t,m.pitch,v.pitch),N=p-c,L=fa(N)>fa(.75*w)?.75*w:N;return f.forEach((x,g)=>{x.beamY=d==="down"?-L*g/(f.length-1)+De(t,m.pitch,x.pitch):L*g/(f.length-1)-De(t,m.pitch,x.pitch)}),e.splice(a,0,...f),e.splice(a,0,ne({},m,{type:"beam",beat:m.beat,duration:v.beat-m.beat,range:L,updown:d,stems:f})),e.splice(a,0,...n),f.length+n.length+1}function si(e,t){let r=e[0].part,u=t.stave,l=t.key.reduce((p,a,i)=>{let s=a-Qe[i];if(s!==0){let h=it(Qe[i]),m=10;for(;m--;)p[h+m]=s}return p},{}),d=0,f=-1,n,o,c;for(;n=e[++f];){if(c=n.beat+n.duration,n.type!=="head")continue;n.beat>d&&e.splice(f++,0,{beat:d,type:"rest",pitch:"",part:r,duration:n.beat-d}),c>d&&(d=c);let p=ri.test(n.pitch)?1:ti.test(n.pitch)?-1:void 0,a=n.pitch[0]+n.pitch.slice(-1);!(n.beat===0&&n.tie&&n.tie!=="begin")&&p!==l[a]&&(l[a]=p,e.splice(f++,0,ne({},n,{type:"acci",value:p||0})));let i=De(t.stave,t.stave.topPitch,n.pitch);if(i>0?e.splice(f++,0,ne({},n,{type:"upledger",rows:i})):(i=De(t.stave,n.pitch,t.stave.bottomPitch),i>0&&e.splice(f++,0,ne({},n,{type:"downledger",rows:i}))),o&&o.length&&(n.duration>=1||n.duration.toFixed(2)==="0.67"||ni(t.breaks,e[o[o.length-1]].beat,n.beat))&&(f+=da(e,t.stave,o,f),o=void 0),n.duration<4)if(n.duration<1&&n.duration.toFixed(2)!=="0.67")o?o.push(f):o=[f];else{let s=cr(u.centerPitch,n);e.splice(f++,0,ne({},n,{type:"stem",stemDirection:s})),n.tie==="begin"&&e.splice(f++,0,ne({},n,{type:"tie",beat:n.beat,updown:s==="up"?"down":"up",event:n.event}))}else if(n.tie==="begin"||n.tie==="middle"){let s=cr(u.centerPitch,n);e.splice(f++,0,ne({},n,{type:"tie",beat:n.beat,updown:s==="up"?"down":"up",event:n.event}))}}return o&&o.length&&(f+=da(e,t.stave,o,f),o=void 0),d<t.duration&&e.push({type:"rest",beat:d,duration:t.duration-d,pitch:"",part:r}),e}function oi(e){let t={clef:{name:"treble",stemDirectionNote:"B4"}},r=Object.values(e.symbols.reduce((u,l)=>(u[l.part]||(u[l.part]=[]),u[l.part].push(l),u),{}));return r.forEach(u=>si(u,e,t.clef.stemDirectionNote)),e.symbols.length=0,r.reduce((u,l)=>(u.push.apply(u,l),u),e.symbols),e}function or(e,t,r,u,l){let d={beat:e,duration:u[2],breaks:u[2]===4?[2]:u[2]===3?[1,2]:[2],symbols:[],stave:t,key:r,meter:u};u[0]===e&&d.symbols.push({type:"timesig",beat:0,numerator:u[2]/u[3],denominator:4/u[3],event:u});let f=-1,n,o;for(;(n=l[++f])&&(o=n.event)&&o[0]<d.beat+u[2];){let c=o[0]+o[4]-d.beat;c>d.duration?d.symbols.push(ne({},n,{beat:0,duration:d.duration,head:t.getHead&&t.getHead(n.pitch,d.duration),tie:"middle"},t.getPart&&t.getPart(n.pitch))):(d.symbols.push(ne({},n,{beat:0,duration:c,head:t.getHead&&t.getHead(n.pitch,c),tie:"end"},t.getPart&&t.getPart(n.pitch))),l.splice(f,1),--f)}return d}var ci={"-2":"𝄫","-1":"♭",0:"",1:"♯",2:"𝄪"};function fi(e,t,r,u,l,d){let f=[],n=[];l=ot(e,0).find(i=>i[1]==="meter")||l;let c=or(0,r,u,l,f);n.push(c),c.symbols.unshift.apply(c.symbols,u.map((i,s)=>i-Qe[s]&&{type:"acci",pitch:it(Qe[s])+ci[i-Qe[s]],value:i-Qe[s]}).filter(i=>!!i).sort(ai)),c.symbols.unshift({type:"clef",beat:0,clef:r.clef});let p=-1,a;for(;a=e[++p];){if(a[1]==="meter"){a[0]!==c.beat&&new TypeError('Scribe: "meter" event must occur at bar start – event ['+a.join(", ")+"] is on beat "+(a[0]-c.beat)+" of bar");continue}if(a[1]!=="note"&&a[1]!=="chord"&&a[1]!=="lyric")continue;for(;a[0]>=c.beat+c.duration;){if(a[0]===c.beat+c.duration){let m=p-1;for(;e[++m]&&e[m][0]===a[0];)e[m][1]==="meter"&&(l=e[m])}c=or(c.beat+c.duration,r,u,l,f),n.push(c)}let i=a[0]-c.beat,s=ca(t,a[0]),h=a[0]+ua(a)>c.beat+c.duration?c.beat+c.duration-a[0]:ua(a);if(a[1]==="note"){let m=r.getSpelling(s,a,d),v=ne({type:"head",beat:i,duration:h,pitch:m,transpose:d,head:r.getHead&&r.getHead(m,h),event:a},r.getPart&&r.getPart(m));c.symbols.push(v),a[4]>h&&(v.tie="begin",f.push(v))}else a[1]==="chord"?c.symbols.push({type:"chord",beat:i,duration:h,transpose:d,value:r.getSpelling(s,a,d)+a[3],event:a}):c.symbols.push({type:"lyric",beat:i,duration:h,value:a[2],event:a})}for(;f.length;)c=or(c.beat+c.duration,r,u,l,f),n.push(c);return n}function fr(e,t,r,u,l){e.sort(jt(we(0)));let d=t?ct[t]:sr,f=oa(e),n=jr(r),o=Vr(n*7+l);return fi(e,f,d,o,u,l).map(oi)}function lr(e){var t={};return function(u){return u in t?t[u]:t[u]=e(u)}}function Bt(e){return function(r,...u){var l=e[r]||e.default;return l&&l.apply(this,u)}}var li={xml:"application/xml",html:"text/html",svg:"image/svg+xml"};function pa(e,t){if(t){var r=li[e.toLowerCase()]||e,u;try{u=new window.DOMParser().parseFromString(t,r)}catch{return}if(!u||u.getElementsByTagName("parsererror").length)throw new Error("Invalid "+e.toUpperCase()+": "+t);return u}}function ma(e){return pa("html",e)}function ga(e){return pa("svg",e)}var _e=Object.assign,Xe={headers:function(e){return{}},body:ye},ui=Bt({"application/x-www-form-urlencoded":function(e){return _e(e,{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"})},"application/json":function(e){return _e(e,{"Content-Type":"application/json; charset=utf-8","X-Requested-With":"XMLHttpRequest"})},"multipart/form-data":function(e){return _e(e,{"Content-Type":"multipart/form-data","X-Requested-With":"XMLHttpRequest"})},"audio/wav":function(e){return _e(e,{"Content-Type":"audio/wav","X-Requested-With":"XMLHttpRequest"})},"image/png":function(e){return _e(e,{"Content-Type":"image/png","X-Requested-With":"XMLHttpRequest"})},"image/jpg":function(e){return _e(e,{"Content-Type":"image/jpg","X-Requested-With":"XMLHttpRequest"})},"image/jpeg":function(e){return _e(e,{"Content-Type":"image/jpeg","X-Requested-With":"XMLHttpRequest"})},default:function(e){return _e(e,{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"})}}),hi=Bt({"application/json":function(e){return e.get?di(e):JSON.stringify(e)},"application/x-www-form-urlencoded":function(e){return e.get?ba(e):ya(e)},"multipart/form-data":function(e){return e.get?e:pi(e)},default:ye});function di(e){return JSON.stringify(Array.from(e.entries()).reduce(function(t,r){return t[r[0]]=r[1],t},{}))}function ba(e){return new URLSearchParams(e).toString()}function ya(e){return Object.keys(e).reduce((t,r)=>(t.append(r,e[r]),t),new URLSearchParams)}function pi(e){throw new Error("TODO: dataToFormData(data)")}function mi(e,t){return t instanceof FormData?e+"?"+ba(t):e+"?"+ya(t)}function gi(e,t,r,u){let l=typeof r=="string"?r:r&&r["Content-Type"]||"application/json",d=ui(l,_e(Xe.headers&&t?Xe.headers(t):{},typeof r=="string"?{}:r)),f={method:e,mode:"cors",headers:d,credentials:"same-origin",signal:u&&u.signal};return e!=="GET"&&(f.body=hi(l,Xe.body?Xe.body(t):t)),f}function Pt(e){return e.blob()}function vi(e){return e.json().catch(t=>{throw new Error("Cannot parse JSON "+e.url+". "+t.message)})}function va(e){return e.formData()}function bi(e){return e.text()}function yi(e){return e.text().then(t=>/^\s*<!DOCTYPE html>/.test(t)?ma(t):H("fragment",t))}function xi(e){return e.text().then(t=>/^\s*<\?xml/.test(t)?ga(t):(console.warn("Untested SVG fragment parsing in request.js!"),H("fragment",t)))}var wi={"text/plain":bi,"text/html":yi,"image/svg+xml":xi,"application/json":vi,"multipart/form-data":va,"application/x-www-form-urlencoded":va,audio:Pt,"audio/wav":Pt,"audio/m4a":Pt,"application/zip":Pt};function Ci(e){if(Xe.onresponse&&(e=Xe.onresponse(e)),!e.ok)throw new Error(e.statusText+"");let t=e.headers.get("Content-Type");if(!t)return;let r=t.replace(/\;.*$/,"");return wi[r](e)}function xa(e="GET",t,r={},u="application/json"){e=e.toUpperCase(),e==="GET"&&r&&(t=mi(t,r));let l=gi(e,r,u,arguments[4]);return fetch(t,l).then(Ci)}function wa(e){return xa("GET",e)}function Ei(e,t){let r;for(r in e)if(e[r]!==t[r])return!1;return!0}var Ca=re(Ei,!0);var le={};le.clone=function(e){var t={};for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t};le.cloneArray=function(e){for(var t=[],r=0;r<e.length;r++)t.push(le.clone(e[r]));return t};le.cloneHashOfHash=function(e){var t={};for(var r in e)e.hasOwnProperty(r)&&(t[r]=le.clone(e[r]));return t};le.cloneHashOfArrayOfHash=function(e){var t={};for(var r in e)e.hasOwnProperty(r)&&(t[r]=le.cloneArray(e[r]));return t};le.strip=function(e){return e.replace(/^\s+/,"").replace(/\s+$/,"")};le.startsWith=function(e,t){return e.indexOf(t)===0};le.endsWith=function(e,t){var r=e.length-t.length;return r>=0&&e.lastIndexOf(t)===r};le.last=function(e){return e.length===0?null:e[e.length-1]};var G=le;var Ge={};(function(){"use strict";var e,t,r,u,l;Ge.initialize=function(y,b,_,E,F){e=y,t=b,r=_,u=E,l=F,d()};function d(){r.annotationfont={face:"Helvetica",size:12,weight:"normal",style:"normal",decoration:"none"},r.gchordfont={face:"Helvetica",size:12,weight:"normal",style:"normal",decoration:"none"},r.historyfont={face:'"Times New Roman"',size:16,weight:"normal",style:"normal",decoration:"none"},r.infofont={face:'"Times New Roman"',size:14,weight:"normal",style:"italic",decoration:"none"},r.measurefont={face:'"Times New Roman"',size:14,weight:"normal",style:"italic",decoration:"none"},r.partsfont={face:'"Times New Roman"',size:15,weight:"normal",style:"normal",decoration:"none"},r.repeatfont={face:'"Times New Roman"',size:13,weight:"normal",style:"normal",decoration:"none"},r.textfont={face:'"Times New Roman"',size:16,weight:"normal",style:"normal",decoration:"none"},r.tripletfont={face:"Times",size:11,weight:"normal",style:"italic",decoration:"none"},r.vocalfont={face:'"Times New Roman"',size:13,weight:"bold",style:"normal",decoration:"none"},r.wordsfont={face:'"Times New Roman"',size:16,weight:"normal",style:"normal",decoration:"none"},u.formatting.composerfont={face:'"Times New Roman"',size:14,weight:"normal",style:"italic",decoration:"none"},u.formatting.subtitlefont={face:'"Times New Roman"',size:16,weight:"normal",style:"normal",decoration:"none"},u.formatting.tempofont={face:'"Times New Roman"',size:15,weight:"bold",style:"normal",decoration:"none"},u.formatting.titlefont={face:'"Times New Roman"',size:20,weight:"normal",style:"normal",decoration:"none"},u.formatting.footerfont={face:'"Times New Roman"',size:12,weight:"normal",style:"normal",decoration:"none"},u.formatting.headerfont={face:'"Times New Roman"',size:12,weight:"normal",style:"normal",decoration:"none"},u.formatting.voicefont={face:'"Times New Roman"',size:13,weight:"bold",style:"normal",decoration:"none"},u.formatting.tablabelfont={face:'"Trebuchet MS"',size:16,weight:"normal",style:"normal",decoration:"none"},u.formatting.tabnumberfont={face:'"Arial"',size:11,weight:"normal",style:"normal",decoration:"none"},u.formatting.tabgracefont={face:'"Arial"',size:8,weight:"normal",style:"normal",decoration:"none"},u.formatting.annotationfont=r.annotationfont,u.formatting.gchordfont=r.gchordfont,u.formatting.historyfont=r.historyfont,u.formatting.infofont=r.infofont,u.formatting.measurefont=r.measurefont,u.formatting.partsfont=r.partsfont,u.formatting.repeatfont=r.repeatfont,u.formatting.textfont=r.textfont,u.formatting.tripletfont=r.tripletfont,u.formatting.vocalfont=r.vocalfont,u.formatting.wordsfont=r.wordsfont}var f={gchordfont:!0,measurefont:!0,partsfont:!0,annotationfont:!0,composerfont:!0,historyfont:!0,infofont:!0,subtitlefont:!0,textfont:!0,titlefont:!0,voicefont:!0},n=function(y){switch(y){case"Arial-Italic":return{face:"Arial",weight:"normal",style:"italic",decoration:"none"};case"Arial-Bold":return{face:"Arial",weight:"bold",style:"normal",decoration:"none"};case"Bookman-Demi":return{face:"Bookman,serif",weight:"bold",style:"normal",decoration:"none"};case"Bookman-DemiItalic":return{face:"Bookman,serif",weight:"bold",style:"italic",decoration:"none"};case"Bookman-Light":return{face:"Bookman,serif",weight:"normal",style:"normal",decoration:"none"};case"Bookman-LightItalic":return{face:"Bookman,serif",weight:"normal",style:"italic",decoration:"none"};case"Courier":return{face:'"Courier New"',weight:"normal",style:"normal",decoration:"none"};case"Courier-Oblique":return{face:'"Courier New"',weight:"normal",style:"italic",decoration:"none"};case"Courier-Bold":return{face:'"Courier New"',weight:"bold",style:"normal",decoration:"none"};case"Courier-BoldOblique":return{face:'"Courier New"',weight:"bold",style:"italic",decoration:"none"};case"AvantGarde-Book":return{face:"AvantGarde,Arial",weight:"normal",style:"normal",decoration:"none"};case"AvantGarde-BookOblique":return{face:"AvantGarde,Arial",weight:"normal",style:"italic",decoration:"none"};case"AvantGarde-Demi":case"Avant-Garde-Demi":return{face:"AvantGarde,Arial",weight:"bold",style:"normal",decoration:"none"};case"AvantGarde-DemiOblique":return{face:"AvantGarde,Arial",weight:"bold",style:"italic",decoration:"none"};case"Helvetica-Oblique":return{face:"Helvetica",weight:"normal",style:"italic",decoration:"none"};case"Helvetica-Bold":return{face:"Helvetica",weight:"bold",style:"normal",decoration:"none"};case"Helvetica-BoldOblique":return{face:"Helvetica",weight:"bold",style:"italic",decoration:"none"};case"Helvetica-Narrow":return{face:'"Helvetica Narrow",Helvetica',weight:"normal",style:"normal",decoration:"none"};case"Helvetica-Narrow-Oblique":return{face:'"Helvetica Narrow",Helvetica',weight:"normal",style:"italic",decoration:"none"};case"Helvetica-Narrow-Bold":return{face:'"Helvetica Narrow",Helvetica',weight:"bold",style:"normal",decoration:"none"};case"Helvetica-Narrow-BoldOblique":return{face:'"Helvetica Narrow",Helvetica',weight:"bold",style:"italic",decoration:"none"};case"Palatino-Roman":return{face:"Palatino",weight:"normal",style:"normal",decoration:"none"};case"Palatino-Italic":return{face:"Palatino",weight:"normal",style:"italic",decoration:"none"};case"Palatino-Bold":return{face:"Palatino",weight:"bold",style:"normal",decoration:"none"};case"Palatino-BoldItalic":return{face:"Palatino",weight:"bold",style:"italic",decoration:"none"};case"NewCenturySchlbk-Roman":return{face:'"New Century",serif',weight:"normal",style:"normal",decoration:"none"};case"NewCenturySchlbk-Italic":return{face:'"New Century",serif',weight:"normal",style:"italic",decoration:"none"};case"NewCenturySchlbk-Bold":return{face:'"New Century",serif',weight:"bold",style:"normal",decoration:"none"};case"NewCenturySchlbk-BoldItalic":return{face:'"New Century",serif',weight:"bold",style:"italic",decoration:"none"};case"Times":case"Times-Roman":case"Times-Narrow":case"Times-Courier":case"Times-New-Roman":return{face:'"Times New Roman"',weight:"normal",style:"normal",decoration:"none"};case"Times-Italic":case"Times-Italics":return{face:'"Times New Roman"',weight:"normal",style:"italic",decoration:"none"};case"Times-Bold":return{face:'"Times New Roman"',weight:"bold",style:"normal",decoration:"none"};case"Times-BoldItalic":return{face:'"Times New Roman"',weight:"bold",style:"italic",decoration:"none"};case"ZapfChancery-MediumItalic":return{face:'"Zapf Chancery",cursive,serif',weight:"normal",style:"normal",decoration:"none"};default:return null}},o=function(y,b,_,E,F){function q(){var oe=parseInt(y[0].token);return y.shift(),b?y.length===0?{face:b.face,weight:b.weight,style:b.style,decoration:b.decoration,size:oe}:y.length===1&&y[0].token==="box"&&f[F]?{face:b.face,weight:b.weight,style:b.style,decoration:b.decoration,size:oe,box:!0}:(t("Extra parameters in font definition.",_,E),{face:b.face,weight:b.weight,style:b.style,decoration:b.decoration,size:oe}):(t("Can't set just the size of the font since there is no default value.",_,E),{face:'"Times New Roman"',weight:"normal",style:"normal",decoration:"none",size:oe})}if(y[0].token==="*"){if(y.shift(),y[0].type==="number")return q();t("Expected font size number after *.",_,E)}if(y[0].type==="number")return q();for(var $=[],R,te="normal",K="normal",se="none",U=!1,Me="face",$e=!1;y.length;){var ee=y.shift(),X=ee.token.toLowerCase();switch(Me){case"face":$e||X!=="utf"&&ee.type!=="number"&&X!=="bold"&&X!=="italic"&&X!=="underline"&&X!=="box"?$.length>0&&ee.token==="-"?($e=!0,$[$.length-1]=$[$.length-1]+ee.token):$e?($e=!1,$[$.length-1]=$[$.length-1]+ee.token):$.push(ee.token):ee.type==="number"?(R?t("Font size specified twice in font definition.",_,E):R=ee.token,Me="modifier"):X==="bold"?te="bold":X==="italic"?K="italic":X==="underline"?se="underline":X==="box"?(f[F]?U=!0:t(`This font style doesn't support "box"`,_,E),Me="finished"):X==="utf"?(ee=y.shift(),Me="size"):t("Unknown parameter "+ee.token+" in font definition.",_,E);break;case"size":ee.type==="number"?R?t("Font size specified twice in font definition.",_,E):R=ee.token:t("Expected font size in font definition.",_,E),Me="modifier";break;case"modifier":X==="bold"?te="bold":X==="italic"?K="italic":X==="underline"?se="underline":X==="box"?(f[F]?U=!0:t(`This font style doesn't support "box"`,_,E),Me="finished"):t("Unknown parameter "+ee.token+" in font definition.",_,E);break;case"finished":t('Extra characters found after "box" in font definition.',_,E);break}}R===void 0?b?R=b.size:(t("Must specify the size of the font since there is no default value.",_,E),R=12):R=parseFloat(R),$=$.join(" "),$===""&&(b?$=b.face:(t("Must specify the name of the font since there is no default value.",_,E),$="sans-serif"));var Oe=n($),J={};return Oe?(J.face=Oe.face,J.weight=Oe.weight,J.style=Oe.style,J.decoration=Oe.decoration,J.size=R,U&&(J.box=!0),J):(J.face=$,J.weight=te,J.style=K,J.decoration=se,J.size=R,U&&(J.box=!0),J)},c=function(y,b,_){return b.length===0?'Directive "'+y+'" requires a font as a parameter.':(r[y]=o(b,r[y],_,0,y),r.is_in_header&&(u.formatting[y]=r[y]),null)},p=function(y,b,_){return b.length===0?'Directive "'+y+'" requires a font as a parameter.':(u.formatting[y]=o(b,u.formatting[y],_,0,y),null)},a=function(y,b){var _="";b.forEach(function(F){_+=F.token});var E=parseFloat(_);if(isNaN(E)||E===0)return'Directive "'+y+'" requires a number as a parameter.';u.formatting.scale=E},i=["acoustic-bass-drum","bass-drum-1","side-stick","acoustic-snare","hand-clap","electric-snare","low-floor-tom","closed-hi-hat","high-floor-tom","pedal-hi-hat","low-tom","open-hi-hat","low-mid-tom","hi-mid-tom","crash-cymbal-1","high-tom","ride-cymbal-1","chinese-cymbal","ride-bell","tambourine","splash-cymbal","cowbell","crash-cymbal-2","vibraslap","ride-cymbal-2","hi-bongo","low-bongo","mute-hi-conga","open-hi-conga","low-conga","high-timbale","low-timbale","high-agogo","low-agogo","cabasa","maracas","short-whistle","long-whistle","short-guiro","long-guiro","claves","hi-wood-block","low-wood-block","mute-cuica","open-cuica","mute-triangle","open-triangle"],s=function(y){var b=y.split(/\s+/);if(b.length!==2&&b.length!==3)return{error:'Expected parameters "abc-note", "drum-sound", and optionally "note-head"'};var _=b[0],E=parseInt(b[1],10);if((isNaN(E)||E<35||E>81)&&b[1]&&(E=i.indexOf(b[1].toLowerCase())+35),isNaN(E)||E<35||E>81)return{error:'Expected drum name, received "'+b[1]+'"'};var F={sound:E};return b.length===3&&(F.noteHead=b[2]),{key:_,value:F}},h=function(y,b){var _=e.getMeasurement(b);return _.used===0||b.length!==0?{error:'Directive "'+y+'" requires a measurement as a parameter.'}:_.value},m=function(y,b){var _=e.getMeasurement(b);return _.used===0||b.length!==0?'Directive "'+y+'" requires a measurement as a parameter.':(u.formatting[y]=_.value,null)},v=function(y,b,_,E,F){if(_.length!==1||_[0].type!=="number")return'Directive "'+b+'" requires a number as a parameter.';var q=_[0].intt;return E!==void 0&&q<E?'Directive "'+b+'" requires a number greater than or equal to '+E+" as a parameter.":F!==void 0&&q>F?'Directive "'+b+'" requires a number less than or equal to '+F+" as a parameter.":(r[y]=q,null)},w=function(y,b,_){if(_.length===1&&(_[0].token==="true"||_[0].token==="false"))return r[y]=_[0].token==="true",null;var E=v(y,b,_,0,1);return E!==null?E:(r[y]=r[y]===1,null)},N=function(y,b,_,E){if(_.length!==1)return'Directive "'+b+'" requires one of [ '+E.join(", ")+" ] as a parameter.";for(var F=_[0].token,q=!1,$=0;!q&&$<E.length;$++)E[$]===F&&(q=!0);return q?(r[y]=F,null):'Directive "'+b+'" requires one of [ '+E.join(", ")+" ] as a parameter."},L=["nobarlines","barlines","beataccents","nobeataccents","droneon","droneoff","drumon","drumoff","fermatafixed","fermataproportional","gchordon","gchordoff","controlcombo","temperamentnormal","noportamento"],x=["gchord","ptstress","beatstring"],g=["bassvol","chordvol","bassprog","chordprog","c","channel","beatmod","deltaloudness","drumbars","gracedivider","makechordchannels","randomchordattack","chordattack","stressmodel","transpose","rtranspose","vol","volinc"],k=["program"],D=["ratio","snt","bendvelocity","pitchbend","control","temperamentlinear"],P=["beat"],A=["drone"],S=["portamento"],M=["expand","grace","trim"],B=["drum","chordname"],I=function(y,b,_){var E=y.shift().token,F=[];if(L.indexOf(E)>=0)y.length!==0&&t("Unexpected parameter in MIDI "+E,_,0);else if(x.indexOf(E)>=0)y.length!==1?t("Expected one parameter in MIDI "+E,_,0):F.push(y[0].token);else if(g.indexOf(E)>=0)y.length!==1?t("Expected one parameter in MIDI "+E,_,0):y[0].type!=="number"?t("Expected one integer parameter in MIDI "+E,_,0):F.push(y[0].intt);else if(k.indexOf(E)>=0)y.length!==1&&y.length!==2?t("Expected one or two parameters in MIDI "+E,_,0):y[0].type!=="number"||y.length===2&&y[1].type!=="number"?t("Expected integer parameter in MIDI "+E,_,0):(F.push(y[0].intt),y.length===2&&F.push(y[1].intt));else if(D.indexOf(E)>=0)y.length!==2?t("Expected two parameters in MIDI "+E,_,0):y[0].type!=="number"||y[1].type!=="number"?t("Expected two integer parameters in MIDI "+E,_,0):(F.push(y[0].intt),F.push(y[1].intt));else if(S.indexOf(E)>=0)y.length!==2?t("Expected two parameters in MIDI "+E,_,0):y[0].type!=="alpha"||y[1].type!=="number"?t("Expected one string and one integer parameters in MIDI "+E,_,0):(F.push(y[0].token),F.push(y[1].intt));else if(E==="drummap")y.length===2&&y[0].type==="alpha"&&y[1].type==="number"?(b.formatting||(b.formatting={}),b.formatting.midi||(b.formatting.midi={}),b.formatting.midi.drummap||(b.formatting.midi.drummap={}),b.formatting.midi.drummap[y[0].token]=y[1].intt,F=b.formatting.midi.drummap):y.length===3&&y[0].type==="punct"&&y[1].type==="alpha"&&y[2].type==="number"?(b.formatting||(b.formatting={}),b.formatting.midi||(b.formatting.midi={}),b.formatting.midi.drummap||(b.formatting.midi.drummap={}),b.formatting.midi.drummap[y[0].token+y[1].token]=y[2].intt,F=b.formatting.midi.drummap):t("Expected one note name and one integer parameter in MIDI "+E,_,0);else if(M.indexOf(E)>=0)y.length!==3||y[0].type!=="number"||y[1].token!=="/"||y[2].type!=="number"?t("Expected fraction parameter in MIDI "+E,_,0):(F.push(y[0].intt),F.push(y[2].intt));else if(P.indexOf(E)>=0)y.length!==4?t("Expected four parameters in MIDI "+E,_,0):y[0].type!=="number"||y[1].type!=="number"||y[2].type!=="number"||y[3].type!=="number"?t("Expected four integer parameters in MIDI "+E,_,0):(F.push(y[0].intt),F.push(y[1].intt),F.push(y[2].intt),F.push(y[3].intt));else if(A.indexOf(E)>=0)y.length!==5?t("Expected five parameters in MIDI "+E,_,0):y[0].type!=="number"||y[1].type!=="number"||y[2].type!=="number"||y[3].type!=="number"||y[4].type!=="number"?t("Expected five integer parameters in MIDI "+E,_,0):(F.push(y[0].intt),F.push(y[1].intt),F.push(y[2].intt),F.push(y[3].intt),F.push(y[4].intt));else if(k.indexOf(E)>=0)y.length!==1||y.length!==4?t("Expected one or two parameters in MIDI "+E,_,0):y[0].type!=="number"?t("Expected integer parameter in MIDI "+E,_,0):y.length===4?(y[1].token!=="octave"&&t("Expected octave parameter in MIDI "+E,_,0),y[2].token!=="="&&t("Expected octave parameter in MIDI "+E,_,0),y[3].type!=="number"&&t("Expected integer parameter for octave in MIDI "+E,_,0)):(F.push(y[0].intt),y.length===4&&F.push(y[3].intt));else if(B.indexOf(E)>=0)if(y.length<2)t("Expected string parameter and at least one integer parameter in MIDI "+E,_,0);else if(y[0].type!=="alpha")t("Expected string parameter and at least one integer parameter in MIDI "+E,_,0);else{var q=y.shift();for(F.push(q.token);y.length>0;)q=y.shift(),q.type!=="number"&&t("Expected integer parameter in MIDI "+E,_,0),F.push(q.intt)}l.hasBeginMusic()?l.appendElement("midi",-1,-1,{cmd:E,params:F}):(b.formatting.midi===void 0&&(b.formatting.midi={}),b.formatting.midi[E]=F)};Ge.parseFontChangeLine=function(y){y=y.replace(/\$\$/g,"");var b=y.split("$");if(b.length>1&&r.setfont){var _=[];b[0]!==""&&_.push({text:b[0]});for(var E=1;E<b.length;E++)if(b[E][0]==="0")_.push({text:b[E].substring(1).replace(/\x03/g,"$$")});else{var F=parseInt(b[E][0],10);r.setfont[F]?_.push({font:r.setfont[F],text:b[E].substring(1).replace(/\x03/g,"$$")}):_[_.length-1].text+="$"+b[E].replace(/\x03/g,"$$")}return _}return y.replace(/\x03/g,"$$")};var z=["auto","above","below","hidden"];Ge.addDirective=function(y){var b=e.tokenize(y,0,y.length);if(b.length===0||b[0].type!=="alpha")return null;var _=y.substring(y.indexOf(b[0].token)+b[0].token.length);_=e.stripComment(_);var E=b.shift().token.toLowerCase(),F="",q;switch(E){case"bagpipes":u.formatting.bagpipes=!0;break;case"flatbeams":u.formatting.flatbeams=!0;break;case"jazzchords":u.formatting.jazzchords=!0;break;case"accentAbove":u.formatting.accentAbove=!0;break;case"germanAlphabet":u.formatting.germanAlphabet=!0;break;case"landscape":r.landscape=!0;break;case"papersize":r.papersize=_;break;case"graceslurs":if(b.length!==1)return"Directive graceslurs requires one parameter: 0 or 1";if(b[0].token==="0"||b[0].token==="false")u.formatting.graceSlurs=!1;else if(b[0].token==="1"||b[0].token==="true")u.formatting.graceSlurs=!0;else return"Directive graceslurs requires one parameter: 0 or 1 (received "+b[0].token+")";break;case"lineThickness":var $=O(b);if($.value!==void 0&&(u.formatting.lineThickness=$.value),$.error)return $.error;break;case"stretchlast":var R=O(b);if(R.value!==void 0&&(u.formatting.stretchlast=R.value),R.error)return R.error;break;case"titlecaps":r.titlecaps=!0;break;case"titleleft":u.formatting.titleleft=!0;break;case"measurebox":u.formatting.measurebox=!0;break;case"vocal":return N("vocalPosition",E,b,z);case"dynamic":return N("dynamicPosition",E,b,z);case"gchord":return N("chordPosition",E,b,z);case"ornament":return N("ornamentPosition",E,b,z);case"volume":return N("volumePosition",E,b,z);case"botmargin":case"botspace":case"composerspace":case"indent":case"leftmargin":case"linesep":case"musicspace":case"partsspace":case"pageheight":case"pagewidth":case"rightmargin":case"staffsep":case"staffwidth":case"subtitlespace":case"sysstaffsep":case"systemsep":case"textspace":case"titlespace":case"topmargin":case"topspace":case"vocalspace":case"wordsspace":return m(E,b);case"voicescale":if(b.length!==1||b[0].type!=="number")return"voicescale requires one float as a parameter";var te=b.shift();return r.currentVoice&&(r.currentVoice.scale=te.floatt,l.changeVoiceScale(r.currentVoice.scale)),null;case"voicecolor":if(b.length!==1)return"voicecolor requires one string as a parameter";var K=b.shift();return r.currentVoice&&(r.currentVoice.color=K.token,l.changeVoiceColor(r.currentVoice.color)),null;case"vskip":var se=Math.round(h(E,b));return se.error?se.error:(l.addSpacing(se),null);case"scale":a(E,b);break;case"sep":if(b.length===0)l.addSeparator(14,14,85,{startChar:r.iChar,endChar:r.iChar+5});else{var U=e.getMeasurement(b);if(U.used===0)return'Directive "'+E+'" requires 3 numbers: space above, space below, length of line';var Me=U.value;if(U=e.getMeasurement(b),U.used===0)return'Directive "'+E+'" requires 3 numbers: space above, space below, length of line';var $e=U.value;if(U=e.getMeasurement(b),U.used===0||b.length!==0)return'Directive "'+E+'" requires 3 numbers: space above, space below, length of line';var ee=U.value;l.addSeparator(Me,$e,ee,{startChar:r.iChar,endChar:r.iChar+_.length})}break;case"barsperstaff":if(F=v("barsperstaff",E,b),F!==null)return F;break;case"staffnonote":if(b.length!==1)return"Directive staffnonote requires one parameter: 0 or 1";if(b[0].token==="0")r.staffnonote=!0;else if(b[0].token==="1")r.staffnonote=!1;else return"Directive staffnonote requires one parameter: 0 or 1 (received "+b[0].token+")";break;case"printtempo":if(F=w("printTempo",E,b),F!==null)return F;break;case"partsbox":if(F=w("partsBox",E,b),F!==null)return F;r.partsfont.box=r.partsBox;break;case"freegchord":if(F=w("freegchord",E,b),F!==null)return F;break;case"measurenb":case"barnumbers":if(F=v("barNumbers",E,b),F!==null)return F;break;case"setbarnb":if(b.length!==1||b[0].type!=="number")return"Directive setbarnb requires a number as a parameter.";r.currBarNumber=l.setBarNumberImmediate(b[0].intt);break;case"begintext":var X="";for(q=e.nextLine();q&&q.indexOf("%%endtext")!==0;)G.startsWith(q,"%%")?X+=q.substring(2)+`
`:X+=q+`
`,q=e.nextLine();l.addText(X,{startChar:r.iChar,endChar:r.iChar+X.length+7});break;case"continueall":r.continueall=!0;break;case"beginps":for(q=e.nextLine();q&&q.indexOf("%%endps")!==0;)e.nextLine();t("Postscript ignored",y,0);break;case"deco":_.length>0&&r.ignoredDecorations.push(_.substring(0,_.indexOf(" "))),t("Decoration redefinition ignored",y,0);break;case"text":var Oe=e.translateString(_);l.addText(Ge.parseFontChangeLine(Oe),{startChar:r.iChar,endChar:r.iChar+_.length+7});break;case"center":var J=e.translateString(_);l.addCentered(Ge.parseFontChangeLine(J));break;case"font":break;case"setfont":var oe=e.tokenize(_,0,_.length);if(oe.length>=4&&oe[0].token==="-"&&oe[1].type==="number"){var xt=parseInt(oe[1].token);xt>=1&&xt<=9&&(r.setfont||(r.setfont=[]),oe.shift(),oe.shift(),r.setfont[xt]=o(oe,r.setfont[xt],y,0,"setfont"))}break;case"gchordfont":case"partsfont":case"tripletfont":case"vocalfont":case"textfont":case"annotationfont":case"historyfont":case"infofont":case"measurefont":case"repeatfont":case"wordsfont":return c(E,b,y);case"composerfont":case"subtitlefont":case"tempofont":case"titlefont":case"voicefont":case"footerfont":case"headerfont":return p(E,b,y);case"barlabelfont":case"barnumberfont":case"barnumfont":return c("measurefont",b,y);case"staves":case"score":r.score_is_present=!0;for(var Va=function(et,nn,Fr,Dr,sn){(nn||r.staves.length===0)&&r.staves.push({index:r.staves.length,numVoices:0});var Be=G.last(r.staves);Fr!==void 0&&Be.bracket===void 0&&(Be.bracket=Fr),Dr!==void 0&&Be.brace===void 0&&(Be.brace=Dr),sn&&(Be.connectBarLines="end"),r.voices[et]===void 0&&(r.voices[et]={staffNum:Be.index,index:Be.numVoices},Be.numVoices++)},Ye=!1,Je=!1,je=!1,wt=!1,Ct=!1,Et=!1,qt=!1,Le,Pr=function(){if(qt=!0,Le){var et="start";Le.staffNum>0&&(r.staves[Le.staffNum-1].connectBarLines==="start"||r.staves[Le.staffNum-1].connectBarLines==="continue")&&(et="continue"),r.staves[Le.staffNum].connectBarLines=et}};b.length;){var ce=b.shift();switch(ce.token){case"(":Ye?t("Can't nest parenthesis in %%score",y,ce.start):(Ye=!0,wt=!0);break;case")":!Ye||wt?t("Unexpected close parenthesis in %%score",y,ce.start):Ye=!1;break;case"[":Je?t("Can't nest brackets in %%score",y,ce.start):(Je=!0,Ct=!0);break;case"]":!Je||Ct?t("Unexpected close bracket in %%score",y,ce.start):(Je=!1,r.staves[Le.staffNum].bracket="end");break;case"{":je?t("Can't nest braces in %%score",y,ce.start):(je=!0,Et=!0);break;case"}":!je||Et?t("Unexpected close brace in %%score",y,ce.start):(je=!1,r.staves[Le.staffNum].brace="end");break;case"|":Pr();break;default:for(var Rt="";(ce.type==="alpha"||ce.type==="number")&&(Rt+=ce.token,ce.continueId);)ce=b.shift();var en=!Ye||wt,tn=Ct?"start":Je?"continue":void 0,rn=Et?"start":je?"continue":void 0;Va(Rt,en,tn,rn,qt),wt=!1,Ct=!1,Et=!1,qt=!1,Le=r.voices[Rt],E==="staves"&&Pr();break}}break;case"newpage":var Ar=e.getInt(_);l.addNewPage(Ar.digits===0?-1:Ar.value);break;case"abc":var kt=_.split(" ");switch(kt[0]){case"-copyright":case"-creator":case"-edited-by":case"-version":case"-charset":var an=kt.shift();l.addMetaText(E+an,kt.join(" "),{startChar:r.iChar,endChar:r.iChar+_.length+5});break;default:return"Unknown directive: "+E+kt[0]}break;case"header":case"footer":var ge=e.getMeat(_,0,_.length);ge=_.substring(ge.start,ge.end),ge[0]==='"'&&ge[ge.length-1]==='"'&&(ge=ge.substring(1,ge.length-1));var ve=ge.split("	"),Nt={};ve.length===1?Nt={left:"",center:ve[0],right:""}:ve.length===2?Nt={left:ve[0],center:ve[1],right:""}:Nt={left:ve[0],center:ve[1],right:ve[2]},ve.length>3&&t("Too many tabs in "+E+": "+ve.length+" found.",_,0),l.addMetaTextObj(E,Nt,{startChar:r.iChar,endChar:r.iChar+y.length});break;case"midi":var Ve=e.tokenize(_,0,_.length,!0);Ve.length>0&&Ve[0].token==="="&&Ve.shift(),Ve.length===0?t("Expected midi command",_,0):I(Ve,u,_);break;case"percmap":var _t=s(_);_t.error?t(_t.error,y,8):(u.formatting.percmap||(u.formatting.percmap={}),u.formatting.percmap[_t.key]=_t.value);break;case"map":case"playtempo":case"auquality":case"continuous":case"nobarcheck":u.formatting[E]=_;break;default:return"Unknown directive: "+E}return null},Ge.globalFormatting=function(y){for(var b in y)if(y.hasOwnProperty(b)){var _=""+y[b],E=e.tokenize(_,0,_.length),F;switch(b){case"titlefont":case"gchordfont":case"composerfont":case"footerfont":case"headerfont":case"historyfont":case"infofont":case"measurefont":case"partsfont":case"repeatfont":case"subtitlefont":case"tempofont":case"textfont":case"voicefont":case"tripletfont":case"vocalfont":case"wordsfont":case"annotationfont":case"tablabelfont":case"tabnumberfont":case"tabgracefont":c(b,E,_);break;case"scale":a(b,E);break;case"partsbox":F=w("partsBox",b,E),F!==null&&t(F),r.partsfont.box=r.partsBox;break;case"freegchord":F=w("freegchord",b,E),F!==null&&t(F);break;case"fontboxpadding":(E.length!==1||E[0].type!=="number")&&t('Directive "'+b+'" requires a number as a parameter.'),u.formatting.fontboxpadding=E[0].floatt;break;case"stretchlast":var q=O(E);if(q.value!==void 0&&(u.formatting.stretchlast=q.value),q.error)return q.error;break;default:t("Formatting directive unrecognized: ",b,0)}}};function O(y){if(y.length===0)return{value:1};if(y.length===1)if(y[0].type==="number"){if(y[0].floatt>=0||y[0].floatt<=1)return{value:y[0].floatt}}else{if(y[0].token==="false")return{value:0};if(y[0].token==="true")return{value:1}}return{error:"Directive stretchlast requires zero or one parameter: false, true, or number between 0 and 1 (received "+y[0].token+")"}}})();var Y=Ge;var ur={},Ea=["C,,,","D,,,","E,,,","F,,,","G,,,","A,,,","B,,,","C,,","D,,","E,,","F,,","G,,","A,,","B,,","C,","D,","E,","F,","G,","A,","B,","C","D","E","F","G","A","B","c","d","e","f","g","a","b","c'","d'","e'","f'","g'","a'","b'","c''","d''","e''","f''","g''","a''","b''","c'''","d'''","e'''","f'''","g'''","a'''","b'''"];ur.pitchIndex=function(e){return Ea.indexOf(e)};ur.noteName=function(e){return Ea[e]};var hr=ur;var At=["C","C♯","D","D♯","E","F","F♯","G","G♯","A","A♯","B"],Ft=["C","D♭","D","E♭","E","F","G♭","G","A♭","A","B♭","B"],Dt=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],St=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"];function dr(e,t,r,u){if(!t||t%12===0)return e;for(;t<0;)t+=12;t>11&&(t=t%12);var l=e.match(/^([A-G][b#♭♯]?)([^\/]+)?\/?([A-G][b#♭♯]?)?(.+)?/);if(!l)return e;var d=l[1],f=l[2],n=l[3],o=l[4],c=At.indexOf(d);if(c<0&&(c=Ft.indexOf(d)),c<0&&(c=Dt.indexOf(d)),c<0&&(c=St.indexOf(d)),c<0)return e;if(c+=t,c=c%12,r?u?e=St[c]:e=Ft[c]:u?e=Dt[c]:e=At[c],f&&(e+=f),n){var c=At.indexOf(n);c<0&&(c=Ft.indexOf(n)),c<0&&(c=Dt.indexOf(n)),c<0&&(c=St.indexOf(n)),e+="/",c>=0?(c+=t,c=c%12,r?u?e+=St[c]:e+=Ft[c]:u?e+=Dt[c]:e+=At[c]):e+=n}return o&&(e+=o),e}var ka={C:{modes:["CMaj","Amin","Am","GMix","DDor","EPhr","FLyd","BLoc"],stepsFromC:0},Db:{modes:["DbMaj","Bbmin","Bbm","AbMix","EbDor","FPhr","GbLyd","CLoc"],stepsFromC:1},D:{modes:["DMaj","Bmin","Bm","AMix","EDor","F#Phr","GLyd","C#Loc"],stepsFromC:2},Eb:{modes:["EbMaj","Cmin","Cm","BbMix","FDor","GPhr","AbLyd","DLoc"],stepsFromC:3},E:{modes:["EMaj","C#min","C#m","BMix","F#Dor","G#Phr","ALyd","D#Loc"],stepsFromC:4},F:{modes:["FMaj","Dmin","Dm","CMix","GDor","APhr","BbLyd","ELoc"],stepsFromC:5},Gb:{modes:["GbMaj","Ebmin","Ebm","DbMix","AbDor","BbPhr","CbLyd","FLoc"],stepsFromC:6},G:{modes:["GMaj","Emin","Em","DMix","ADor","BPhr","CLyd","F#Loc"],stepsFromC:7},Ab:{modes:["AbMaj","Fmin","Fm","EbMix","BbDor","CPhr","DbLyd","GLoc"],stepsFromC:8},A:{modes:["AMaj","F#min","F#m","EMix","BDor","C#Phr","DLyd","G#Loc"],stepsFromC:9},Bb:{modes:["BbMaj","Gmin","Gm","FMix","CDor","DPhr","EbLyd","ALoc"],stepsFromC:10},B:{modes:["BMaj","G#min","G#m","F#Mix","C#Dor","D#Phr","ELyd","A#Loc"],stepsFromC:11},"C#":{modes:["C#Maj","A#min","A#m","G#Mix","D#Dor","E#Phr","F#Lyd","B#Loc"],stepsFromC:1},"F#":{modes:["F#Maj","D#min","D#m","C#Mix","G#Dor","A#Phr","BLyd","E#Loc"],stepsFromC:6},Cb:{modes:["CbMaj","Abmin","Abm","GbMix","DbDor","EbPhr","FbLyd","BbLoc"],stepsFromC:11}},ft=null;function ki(){ft={};for(var e=Object.keys(ka),t=0;t<e.length;t++){var r=ka[e[t]];ft[e[t].toLowerCase()]=e[t];for(var u=0;u<r.modes.length;u++){var l=r.modes[u].toLowerCase();ft[l]=e[t]}}}function Na(e){ft||ki();var t=e.toLowerCase().match(/([a-g][b#]?)(maj|min|mix|dor|phr|lyd|loc|m)?/);if(!t||!t[2])return e;t=t[1]+t[2];var r=ft[t];return r||e}var ze={acc:"sharp",note:"f"},Ze={acc:"sharp",note:"c"},lt={acc:"sharp",note:"g"},It={acc:"sharp",note:"d"},pr={acc:"sharp",note:"A"},_a={acc:"sharp",note:"e"},Ni={acc:"sharp",note:"B"},ue={acc:"flat",note:"B"},Ee={acc:"flat",note:"e"},Se={acc:"flat",note:"A"},ut={acc:"flat",note:"d"},mr={acc:"flat",note:"G"},Ta={acc:"flat",note:"c"},_i={acc:"flat",note:"F"},Ti={"C#":[ze,Ze,lt,It,pr,_a,Ni],"F#":[ze,Ze,lt,It,pr,_a],B:[ze,Ze,lt,It,pr],E:[ze,Ze,lt,It],A:[ze,Ze,lt],D:[ze,Ze],G:[ze],C:[],F:[ue],Bb:[ue,Ee],Eb:[ue,Ee,Se],Cm:[ue,Ee,Se],Ab:[ue,Ee,Se,ut],Db:[ue,Ee,Se,ut,mr],Gb:[ue,Ee,Se,ut,mr,Ta],Cb:[ue,Ee,Se,ut,mr,Ta,_i],"A#":[ue,Ee],"B#":[],"D#":[ue,Ee,Se],"E#":[ue],"G#":[ue,Ee,Se,ut],none:[]};function ht(e){var t=Ti[Na(e)];return t?JSON.parse(JSON.stringify(t)):null}var Ot={},Mi={C:0,"C#":1,Db:1,D:2,"D#":3,Eb:3,E:4,F:5,"F#":6,Gb:6,G:7,"G#":8,Ab:8,A:9,"A#":10,Bb:10,B:11},Li=["C","Db","D","Eb","E","F","F#","G","Ab","A","Bb","B"],Bi=["C","C#","D","D#","E","F","F#","G","G#","A","Bb","B"];Ot.keySignature=function(e,t,r,u,l){if(e.clef.type==="perc"||e.clef.type==="none")return{accidentals:ht(t),root:r,acc:u};l||(l=0),e.localTransposeVerticalMovement=0,e.localTransposePreferFlats=!1;var d=ht(t);if(!d)return e.key;if(e.localTranspose=(e.globalTranspose?e.globalTranspose:0)+l,!e.localTranspose)return{accidentals:d,root:r,acc:u};if(e.globalTransposeOrigKeySig=d,e.localTranspose%12===0)return e.localTransposeVerticalMovement=e.localTranspose/12*7,{accidentals:d,root:r,acc:u};var f=t[0];t[1]==="b"||t[1]==="#"?(f+=t[1],t=t.substr(2)):t=t.substr(1);var n=Mi[f],o=n!==void 0;o||(n=0,f="C",t="");for(var c=n+e.localTranspose;c<0;)c+=12;c>11&&(c=c%12);var p=t[0]==="m"?Bi[c]:Li[c],a=p+t,i=ht(a);i.length>0&&i[0].acc==="flat"&&(e.localTransposePreferFlats=!0);var s=a.charCodeAt(0)-f.charCodeAt(0);return e.localTranspose>0?(s<0||s===0&&(f[1]==="#"||a[1]==="b"))&&(s+=7):e.localTranspose<0&&(s>0||s===0&&(f[1]==="b"||a[1]==="#"))&&(s-=7),e.localTranspose>0?e.localTransposeVerticalMovement=s+Math.floor(e.localTranspose/12)*7:e.localTransposeVerticalMovement=s+Math.ceil(e.localTranspose/12)*7,o?{accidentals:i,root:p[0],acc:p.length>1?p[1]:""}:{accidentals:[],root:r,acc:u}};Ot.chordName=function(e,t){return dr(t,e.localTranspose,e.localTransposePreferFlats,e.freegchord)};var Ma=["c","d","e","f","g","a","b"];function Pi(e,t,r,u,l){for(var d=Ma[(e+49)%7],f=0,n=0;n<u.length;n++)u[n].note.toLowerCase()===d&&(f=gr[u[n].acc]);for(var o=gr[r],c=o-f,p=Ma[(t+49)%7],a=0,i=0;i<l.accidentals.length;i++)l.accidentals[i].note.toLowerCase()===p&&(a=gr[l.accidentals[i].acc]);var s=c+a;return s<-2&&(t--,s+=p==="c"||p==="f"?1:2),s>2&&(t++,s-=p==="b"||p==="e"?1:2),[t,s]}var gr={dblflat:-2,flat:-1,natural:0,sharp:1,dblsharp:2},Ai={"-2":"dblflat","-1":"flat",0:"natural",1:"sharp",2:"dblsharp"},Fi={"-2":"__","-1":"_",0:"=",1:"^",2:"^^"};Ot.note=function(e,t){if(!(!e.localTranspose||e.clef.type==="perc")){var r=t.pitch;if(e.localTransposeVerticalMovement&&(t.pitch=t.pitch+e.localTransposeVerticalMovement,t.name)){var u=t.accidental?t.name.substring(1):t.name,l=t.accidental?t.name[0]:"",d=hr.pitchIndex(u);t.name=l+hr.noteName(d+e.localTransposeVerticalMovement)}if(t.accidental){var f=Pi(r,t.pitch,t.accidental,e.globalTransposeOrigKeySig,e.targetKey);t.pitch=f[0],t.accidental=Ai[f[1]],t.name&&(t.name=Fi[f[1]]+t.name.replace(/[_^=]/g,""))}}};var dt=Ot;var ie={};(function(){var e,t,r,u,l;ie.initialize=function(a,i,s,h,m){e=a,t=i,r=s,u=h,l=m},ie.standardKey=function(a,i,s,h){return dt.keySignature(r,a,i,s,h)};var d={treble:{clef:"treble",pitch:4,mid:0},"treble+8":{clef:"treble+8",pitch:4,mid:0},"treble-8":{clef:"treble-8",pitch:4,mid:0},"treble^8":{clef:"treble+8",pitch:4,mid:0},treble_8:{clef:"treble-8",pitch:4,mid:0},treble1:{clef:"treble",pitch:2,mid:2},treble2:{clef:"treble",pitch:4,mid:0},treble3:{clef:"treble",pitch:6,mid:-2},treble4:{clef:"treble",pitch:8,mid:-4},treble5:{clef:"treble",pitch:10,mid:-6},perc:{clef:"perc",pitch:6,mid:0},none:{clef:"none",mid:0},bass:{clef:"bass",pitch:8,mid:-12},"bass+8":{clef:"bass+8",pitch:8,mid:-12},"bass-8":{clef:"bass-8",pitch:8,mid:-12},"bass^8":{clef:"bass+8",pitch:8,mid:-12},bass_8:{clef:"bass-8",pitch:8,mid:-12},"bass+16":{clef:"bass",pitch:8,mid:-12},"bass-16":{clef:"bass",pitch:8,mid:-12},"bass^16":{clef:"bass",pitch:8,mid:-12},bass_16:{clef:"bass",pitch:8,mid:-12},bass1:{clef:"bass",pitch:2,mid:-6},bass2:{clef:"bass",pitch:4,mid:-8},bass3:{clef:"bass",pitch:6,mid:-10},bass4:{clef:"bass",pitch:8,mid:-12},bass5:{clef:"bass",pitch:10,mid:-14},tenor:{clef:"alto",pitch:8,mid:-8},tenor1:{clef:"alto",pitch:2,mid:-2},tenor2:{clef:"alto",pitch:4,mid:-4},tenor3:{clef:"alto",pitch:6,mid:-6},tenor4:{clef:"alto",pitch:8,mid:-8},tenor5:{clef:"alto",pitch:10,mid:-10},alto:{clef:"alto",pitch:6,mid:-6},alto1:{clef:"alto",pitch:2,mid:-2},alto2:{clef:"alto",pitch:4,mid:-4},alto3:{clef:"alto",pitch:6,mid:-6},alto4:{clef:"alto",pitch:8,mid:-8},alto5:{clef:"alto",pitch:10,mid:-10},"alto+8":{clef:"alto+8",pitch:6,mid:-6},"alto-8":{clef:"alto-8",pitch:6,mid:-6},"alto^8":{clef:"alto+8",pitch:6,mid:-6},alto_8:{clef:"alto-8",pitch:6,mid:-6}},f=function(a,i){var s=d[a],h=s?s.mid:0;return h+i};ie.fixClef=function(a){var i=d[a.type];i&&(a.clefPos=i.pitch,a.type=i.clef)},ie.deepCopyKey=function(a){var i={accidentals:[],root:a.root,acc:a.acc,mode:a.mode};return a.accidentals.forEach(function(s){i.accidentals.push(G.clone(s))}),i};var n={A:5,B:6,C:0,D:1,E:2,F:3,G:4,a:12,b:13,c:7,d:8,e:9,f:10,g:11};ie.addPosToKey=function(a,i){var s=a.verticalPos;i.accidentals.forEach(function(h){var m=n[h.note];m=m-s,h.verticalPos=m}),i.impliedNaturals&&i.impliedNaturals.forEach(function(h){var m=n[h.note];m=m-s,h.verticalPos=m}),s<-10?(i.accidentals.forEach(function(h){h.verticalPos-=7,(h.verticalPos>=11||h.verticalPos===10&&h.acc==="flat")&&(h.verticalPos-=7),h.note==="A"&&h.acc==="sharp"&&(h.verticalPos-=7),(h.note==="G"||h.note==="F")&&h.acc==="flat"&&(h.verticalPos-=7)}),i.impliedNaturals&&i.impliedNaturals.forEach(function(h){h.verticalPos-=7,(h.verticalPos>=11||h.verticalPos===10&&h.acc==="flat")&&(h.verticalPos-=7),h.note==="A"&&h.acc==="sharp"&&(h.verticalPos-=7),(h.note==="G"||h.note==="F")&&h.acc==="flat"&&(h.verticalPos-=7)})):s<-4?(i.accidentals.forEach(function(h){h.verticalPos-=7,s===-8&&(h.note==="f"||h.note==="g")&&h.acc==="sharp"&&(h.verticalPos-=7)}),i.impliedNaturals&&i.impliedNaturals.forEach(function(h){h.verticalPos-=7,s===-8&&(h.note==="f"||h.note==="g")&&h.acc==="sharp"&&(h.verticalPos-=7)})):s>=7&&(i.accidentals.forEach(function(h){h.verticalPos+=7}),i.impliedNaturals&&i.impliedNaturals.forEach(function(h){h.verticalPos+=7}))},ie.fixKey=function(a,i){var s=G.clone(i);return ie.addPosToKey(a,s),s};var o=function(a){var i=0,s=a[i++];(s==="^"||s==="_")&&(s=a[i++]);var h=n[s];for(h===void 0&&(h=6);i<a.length;i++)if(a[i]===",")h-=7;else if(a[i]==="'")h+=7;else break;return{mid:h-6,str:a.substring(i)}},c=function(a){for(var i=0;i<a.length;i++)a[i].note==="b"?a[i].note="B":a[i].note==="a"?a[i].note="A":a[i].note==="F"?a[i].note="f":a[i].note==="E"?a[i].note="e":a[i].note==="D"?a[i].note="d":a[i].note==="C"?a[i].note="c":a[i].note==="G"&&a[i].acc==="sharp"?a[i].note="g":a[i].note==="g"&&a[i].acc==="flat"&&(a[i].note="G")};ie.parseKey=function(a,i){a.length===0&&(a="none");var s=e.tokenize(a,0,a.length),h={};if(s.length===0)return t("Must pass in key signature.",a,0),h;switch(s[0].token){case"HP":Y.addDirective("bagpipes"),r.key={root:"HP",accidentals:[],acc:"",mode:""},h.foundKey=!0,s.shift();break;case"Hp":Y.addDirective("bagpipes"),r.key={root:"Hp",accidentals:[{acc:"natural",note:"g"},{acc:"sharp",note:"f"},{acc:"sharp",note:"c"}],acc:"",mode:""},h.foundKey=!0,s.shift();break;case"none":r.key={root:"none",accidentals:[],acc:"",mode:""},h.foundKey=!0,s.shift();break;default:var m=e.getKeyPitch(s[0].token);if(m.len>0){h.foundKey=!0;var v="",w="";s[0].token.length>1?s[0].token=s[0].token.substring(1):s.shift();var N=m.token;if(s.length>0){var L=e.getSharpFlat(s[0].token);if(L.len>0&&(s[0].token.length>1?s[0].token=s[0].token.substring(1):s.shift(),N+=L.token,v=L.token),s.length>0){var x=e.getMode(s[0].token);x.len>0&&(s.shift(),N+=x.token,w=x.token)}if(ie.standardKey(N,m.token,v,0)===void 0)return t("Unsupported key signature: "+N,a,0),h}var g=ie.deepCopyKey(r.key),k=!i&&r.globalTranspose?-r.globalTranspose:0,D;if(i&&(D=r.globalTransposeOrigKeySig),r.key=ie.deepCopyKey(ie.standardKey(N,m.token,v,k)),i&&(r.globalTransposeOrigKeySig=D),r.key.mode=w,g){for(var P,A=0;A<r.key.accidentals.length;A++)for(P=0;P<g.accidentals.length;P++)g.accidentals[P].note&&r.key.accidentals[A].note.toLowerCase()===g.accidentals[P].note.toLowerCase()&&(g.accidentals[P].note=null);for(P=0;P<g.accidentals.length;P++)g.accidentals[P].note&&(r.key.impliedNaturals||(r.key.impliedNaturals=[]),r.key.impliedNaturals.push({acc:"natural",note:g.accidentals[P].note}))}}break}if(s.length===0||(s[0].token==="exp"&&s.shift(),s.length===0)||(s[0].token==="oct"&&s.shift(),s.length===0))return h;var S=e.getKeyAccidentals2(s);if(S.warn&&t(S.warn,a,0),S.accs){h.foundKey||(h.foundKey=!0,r.key={root:"none",acc:"",mode:"",accidentals:[]}),c(S.accs);for(var M=0;M<S.accs.length;M++){for(var B=!1,I=0;I<r.key.accidentals.length&&!B;I++)r.key.accidentals[I].note===S.accs[M].note&&(B=!0,r.key.accidentals[I].acc!==S.accs[M].acc&&(r.key.accidentals[I].acc=S.accs[M].acc,r.key.explicitAccidentals||(r.key.explicitAccidentals=[]),r.key.explicitAccidentals.push(S.accs[M])));if(!B&&(r.key.explicitAccidentals||(r.key.explicitAccidentals=[]),r.key.explicitAccidentals.push(S.accs[M]),r.key.accidentals.push(S.accs[M]),r.key.impliedNaturals))for(var z=0;z<r.key.impliedNaturals.length;z++)r.key.impliedNaturals[z].note===S.accs[M].note&&r.key.impliedNaturals.splice(z,1)}}for(var O;s.length>0;)switch(s[0].token){case"m":case"middle":if(s.shift(),s.length===0)return t("Expected = after middle",a,0),h;if(O=s.shift(),O.token!=="="){t("Expected = after middle",a,O.start);break}if(s.length===0)return t("Expected parameter after middle=",a,0),h;var y=e.getPitchFromTokens(s);y.warn&&t(y.warn,a,0),y.position&&(r.clef.verticalPos=y.position-6);break;case"transpose":if(s.shift(),s.length===0)return t("Expected = after transpose",a,0),h;if(O=s.shift(),O.token!=="="){t("Expected = after transpose",a,O.start);break}if(s.length===0)return t("Expected parameter after transpose=",a,0),h;if(s[0].type!=="number"){t("Expected number after transpose",a,s[0].start);break}r.clef.transpose=s[0].intt,s.shift();break;case"stafflines":if(s.shift(),s.length===0)return t("Expected = after stafflines",a,0),h;if(O=s.shift(),O.token!=="="){t("Expected = after stafflines",a,O.start);break}if(s.length===0)return t("Expected parameter after stafflines=",a,0),h;if(s[0].type!=="number"){t("Expected number after stafflines",a,s[0].start);break}r.clef.stafflines=s[0].intt,s.shift();break;case"staffscale":if(s.shift(),s.length===0)return t("Expected = after staffscale",a,0),h;if(O=s.shift(),O.token!=="="){t("Expected = after staffscale",a,O.start);break}if(s.length===0)return t("Expected parameter after staffscale=",a,0),h;if(s[0].type!=="number"){t("Expected number after staffscale",a,s[0].start);break}r.clef.staffscale=s[0].floatt,s.shift();break;case"octave":if(s.shift(),s.length===0)return t("Expected = after octave",a,0),h;if(O=s.shift(),O.token!=="="){t("Expected = after octave",a,O.start);break}if(s.length===0)return t("Expected parameter after octave=",a,0),h;if(s[0].type!=="number"){t("Expected number after octave",a,s[0].start);break}r.octave=s[0].intt,s.shift();break;case"style":if(s.shift(),s.length===0)return t("Expected = after style",a,0),h;if(O=s.shift(),O.token!=="="){t("Expected = after style",a,O.start);break}if(s.length===0)return t("Expected parameter after style=",a,0),h;switch(s[0].token){case"normal":case"harmonic":case"rhythm":case"x":case"triangle":r.style=s[0].token,s.shift();break;default:t("error parsing style element: "+s[0].token,a,s[0].start);break}break;case"clef":if(s.shift(),s.length===0)return t("Expected = after clef",a,0),h;if(O=s.shift(),O.token!=="="){t("Expected = after clef",a,O.start);break}if(s.length===0)return t("Expected parameter after clef=",a,0),h;case"treble":case"bass":case"alto":case"tenor":case"perc":case"none":var b=s.shift();switch(b.token){case"treble":case"tenor":case"alto":case"bass":case"perc":case"none":break;case"C":b.token="alto";break;case"F":b.token="bass";break;case"G":b.token="treble";break;case"c":b.token="alto";break;case"f":b.token="bass";break;case"g":b.token="treble";break;default:t("Expected clef name. Found "+b.token,a,b.start);break}s.length>0&&s[0].type==="number"&&(b.token+=s[0].token,s.shift()),s.length>1&&(s[0].token==="-"||s[0].token==="+"||s[0].token==="^"||s[0].token==="_")&&s[1].token==="8"&&(b.token+=s[0].token+s[1].token,s.shift(),s.shift()),r.clef={type:b.token,verticalPos:f(b.token,0)},r.currentVoice&&r.currentVoice.transpose!==void 0&&(r.clef.transpose=r.currentVoice.transpose),h.foundClef=!0;break;default:t("Unknown parameter: "+s[0].token,a,s[0].start),s.shift()}return h};var p=function(a){r.currentVoice=r.voices[a],l.setCurrentVoice(r.currentVoice.staffNum,r.currentVoice.index)};ie.parseVoice=function(a,i,s){var h=e.getMeat(a,i,s),m=h.start,v=h.end,w=e.getToken(a,m,v);if(w.length===0){t("Expected a voice id",a,m);return}var N=!1;r.voices[w]===void 0&&(r.voices[w]={},N=!0,r.score_is_present&&t("Can't have an unknown V: id when the %score directive is present",a,m)),m+=w.length,m+=e.eatWhiteSpace(a,m);for(var L={startStaff:N},x=function(y){var b=e.getVoiceToken(a,m,v);b.warn!==void 0?t("Expected value for "+y+" in voice: "+b.warn,a,m):b.err!==void 0?t("Expected value for "+y+" in voice: "+b.err,a,m):b.token.length===0&&a[m]!=='"'?t("Expected value for "+y+" in voice",a,m):L[y]=b.token,m+=b.len},g=function(y,b,_){var E=e.getVoiceToken(a,m,v);E.warn!==void 0?t("Expected value for "+b+" in voice: "+E.warn,a,m):E.err!==void 0?t("Expected value for "+b+" in voice: "+E.err,a,m):E.token.length===0&&a[m]!=='"'?t("Expected value for "+b+" in voice",a,m):(_==="number"&&(E.token=parseFloat(E.token)),r.voices[y][b]=E.token),m+=E.len},k=function(y,b){var _=e.getVoiceToken(a,m,v);if(_.warn!==void 0)t("Expected value for "+y+" in voice: "+_.warn,a,m);else if(_.err!==void 0)t("Expected value for "+y+" in voice: "+_.err,a,m);else if(_.token.length===0&&a[m]!=='"')t("Expected value for "+y+" in voice",a,m);else return b==="number"&&(_.token=parseFloat(_.token)),_.token;m+=_.len},D=function(y,b){var _={_B:2,_E:9,_b:-10,_e:-3},E=e.getVoiceToken(a,m,v);if(E.warn!==void 0)t("Expected one of (_B, _E, _b, _e) for "+b+" in voice: "+E.warn,a,m);else if(E.token.length===0&&a[m]!=='"')t("Expected one of (_B, _E, _b, _e) for "+b+" in voice",a,m);else{var F=_[E.token];F?r.voices[y][b]=F:t("Expected one of (_B, _E, _b, _e) for "+b+" in voice",a,m)}m+=E.len};m<v;){var P=e.getVoiceToken(a,m,v);if(m+=P.len,P.warn)t("Error parsing voice: "+P.warn,a,m);else{var A=null;switch(P.token){case"clef":case"cl":x("clef");var S=0;L.clef!==void 0&&(L.clef=L.clef.replace(/[',]/g,""),L.clef.indexOf("+16")!==-1&&(S+=14,L.clef=L.clef.replace("+16","")),L.verticalPos=f(L.clef,S));break;case"treble":case"bass":case"tenor":case"alto":case"perc":case"none":case"treble'":case"bass'":case"tenor'":case"alto'":case"none'":case"treble''":case"bass''":case"tenor''":case"alto''":case"none''":case"treble,":case"bass,":case"tenor,":case"alto,":case"none,":case"treble,,":case"bass,,":case"tenor,,":case"alto,,":case"none,,":var M=0;L.clef=P.token.replace(/[',]/g,""),L.verticalPos=f(L.clef,M),r.voices[w].clef=P.token;break;case"staves":case"stave":case"stv":x("staves");break;case"brace":case"brc":x("brace");break;case"bracket":case"brk":x("bracket");break;case"name":case"nm":x("name");break;case"subname":case"sname":case"snm":x("subname");break;case"merge":L.startStaff=!1;break;case"stem":case"stems":A=e.getVoiceToken(a,m,v),A.warn!==void 0?t("Expected value for stems in voice: "+A.warn,a,m):A.err!==void 0?t("Expected value for stems in voice: "+A.err,a,m):A.token==="up"||A.token==="down"?r.voices[w].stem=A.token:t("Expected up or down for voice stem",a,m),m+=A.len;break;case"up":case"down":r.voices[w].stem=P.token;break;case"middle":case"m":x("verticalPos"),L.verticalPos=o(L.verticalPos).mid;break;case"gchords":case"gch":r.voices[w].suppressChords=!0,A=e.getVoiceToken(a,m,v),A.token==="0"&&(m=m+A.len);break;case"space":case"spc":x("spacing");break;case"scale":g(w,"scale","number");break;case"score":D(w,"scoreTranspose");break;case"transpose":g(w,"transpose","number");break;case"stafflines":g(w,"stafflines","number");break;case"staffscale":g(w,"staffscale","number");break;case"octave":g(w,"octave","number");break;case"volume":g(w,"volume","number");break;case"cue":var B=k("cue","string");B==="on"?r.voices[w].scale=.6:r.voices[w].scale=1;break;case"style":A=e.getVoiceToken(a,m,v),A.warn!==void 0?t("Expected value for style in voice: "+A.warn,a,m):A.err!==void 0?t("Expected value for style in voice: "+A.err,a,m):A.token==="normal"||A.token==="harmonic"||A.token==="rhythm"||A.token==="x"||A.token==="triangle"?r.voices[w].style=A.token:t("Expected one of [normal, harmonic, rhythm, x, triangle] for voice style",a,m),m+=A.len;break}}m+=e.eatWhiteSpace(a,m)}if((L.startStaff||r.staves.length===0)&&(r.staves.push({index:r.staves.length,meter:r.origMeter}),r.score_is_present||(r.staves[r.staves.length-1].numVoices=0)),r.voices[w].staffNum===void 0){r.voices[w].staffNum=r.staves.length-1;var I=0;for(var z in r.voices)r.voices.hasOwnProperty(z)&&r.voices[z].staffNum===r.voices[w].staffNum&&I++;r.voices[w].index=I-1}var O=r.staves[r.voices[w].staffNum];r.score_is_present||O.numVoices++,L.clef&&(O.clef={type:L.clef,verticalPos:L.verticalPos}),L.spacing&&(O.spacing_below_offset=L.spacing),L.verticalPos&&(O.verticalPos=L.verticalPos),L.name&&(O.name?O.name.push(L.name):O.name=[L.name]),L.subname&&(O.subname?O.subname.push(L.subname):O.subname=[L.subname]),p(w)}})();var V=ie;function La(e,t,r,u,l){this.reset=function(n,o,c,p){V.initialize(n,o,c,p,l),Y.initialize(n,o,c,p,l)},this.reset(e,t,r,u),this.setTitle=function(n,o){r.hasMainTitle?l.addSubtitle(n,{startChar:r.iChar,endChar:r.iChar+o+2}):(l.addMetaText("title",n,{startChar:r.iChar,endChar:r.iChar+o+2}),r.hasMainTitle=!0)},this.setMeter=function(n){if(n=e.stripComment(n),n==="C")return r.havent_set_length===!0&&(r.default_length=.125,r.havent_set_length=!1),{type:"common_time"};if(n==="C|")return r.havent_set_length===!0&&(r.default_length=.125,r.havent_set_length=!1),{type:"cut_time"};if(n==="o")return r.havent_set_length===!0&&(r.default_length=.125,r.havent_set_length=!1),{type:"tempus_perfectum"};if(n==="c")return r.havent_set_length===!0&&(r.default_length=.125,r.havent_set_length=!1),{type:"tempus_imperfectum"};if(n==="o.")return r.havent_set_length===!0&&(r.default_length=.125,r.havent_set_length=!1),{type:"tempus_perfectum_prolatio"};if(n==="c.")return r.havent_set_length===!0&&(r.default_length=.125,r.havent_set_length=!1),{type:"tempus_imperfectum_prolatio"};if(n.length===0||n.toLowerCase()==="none")return r.havent_set_length===!0&&(r.default_length=.125,r.havent_set_length=!1),null;var o=e.tokenize(n,0,n.length);try{var c=function(){var m={value:0,num:""},v=o.shift();for(v.token==="("&&(v=o.shift());;){if(v.type!=="number")throw"Expected top number of meter";if(m.value+=parseInt(v.token),m.num+=v.token,o.length===0||o[0].token==="/")return m;if(v=o.shift(),v.token===")"){if(o.length===0||o[0].token==="/")return m;throw"Unexpected paren in meter"}if(v.token!=="."&&v.token!=="+"||(m.num+=v.token,o.length===0))throw"Expected top number of meter";v=o.shift()}return m},p=function(){var m=c();if(o.length===0)return m;var v=o.shift();if(v.token!=="/")throw"Expected slash in meter";if(v=o.shift(),v.type!=="number")throw"Expected bottom number of meter";return m.den=v.token,m.value=m.value/parseInt(m.den),m};if(o.length===0)throw"Expected meter definition in M: line";for(var a={type:"specified",value:[]},i=0;;){var s=p();i+=s.value;var h={num:s.num};if(s.den!==void 0&&(h.den=s.den),a.value.push(h),o.length===0)break}return r.havent_set_length===!0&&(r.default_length=i<.75?.0625:.125,r.havent_set_length=!1),a}catch(m){t(m,n,0)}return null},this.calcTempo=function(n){var o=.25;r.meter&&r.meter.type==="specified"?o=1/parseInt(r.meter.value[0].den):r.origMeter&&r.origMeter.type==="specified"&&(o=1/parseInt(r.origMeter.value[0].den));for(var c=0;c<n.duration;c++)n.duration[c]=o*n.duration[c];return n},this.resolveTempo=function(){r.tempo&&(this.calcTempo(r.tempo),u.metaText.tempo=r.tempo,delete r.tempo)},this.addUserDefinition=function(n,o,c){var p=n.indexOf("=",o);if(p===-1){t("Need an = in a macro definition",n,o);return}var a=G.strip(n.substring(o,p)),i=G.strip(n.substring(p+1));if(a.length!==1){t("Macro definitions can only be one character",n,o);return}var s="HIJKLMNOPQRSTUVWXYhijklmnopqrstuvw~";if(s.indexOf(a)===-1){t("Macro definitions must be H-Y, h-w, or tilde",n,o);return}if(i.length===0){t("Missing macro definition",n,o);return}r.macros===void 0&&(r.macros={}),r.macros[a]=i},this.setDefaultLength=function(n,o,c){var p=n.substring(o,c).replace(/ /g,""),a=p.split("/");if(a.length===2){var i=parseInt(a[0]),s=parseInt(a[1]);s>0&&(r.default_length=i/s,r.havent_set_length=!1)}else a.length===1&&a[0]==="1"&&(r.default_length=1,r.havent_set_length=!1)};var d={larghissimo:20,adagissimo:24,sostenuto:28,grave:32,largo:40,lento:50,larghetto:60,adagio:68,adagietto:74,andante:80,andantino:88,"marcia moderato":84,"andante moderato":100,moderato:112,allegretto:116,"allegro moderato":120,allegro:126,animato:132,agitato:140,veloce:148,"mosso vivo":156,vivace:164,vivacissimo:172,allegrissimo:176,presto:184,prestissimo:210};this.setTempo=function(n,o,c,p){try{var a=e.tokenize(n,o,c);if(a.length===0)throw"Missing parameter in Q: field";var i={startChar:p+o-2,endChar:p+c},s=!0,h=a.shift();if(h.type==="quote"&&(i.preString=h.token,h=a.shift(),a.length===0))return d[i.preString.toLowerCase()]&&(i.bpm=d[i.preString.toLowerCase()],i.suppressBpm=!0),{type:"immediate",tempo:i};if(h.type==="alpha"&&h.token==="C"){if(a.length===0)throw"Missing tempo after C in Q: field";if(h=a.shift(),h.type==="punct"&&h.token==="="){if(a.length===0)throw"Missing tempo after = in Q: field";if(h=a.shift(),h.type!=="number")throw"Expected number after = in Q: field";i.duration=[1],i.bpm=parseInt(h.token)}else if(h.type==="number"){if(i.duration=[parseInt(h.token)],a.length===0)throw"Missing = after duration in Q: field";if(h=a.shift(),h.type!=="punct"||h.token!=="=")throw"Expected = after duration in Q: field";if(a.length===0)throw"Missing tempo after = in Q: field";if(h=a.shift(),h.type!=="number")throw"Expected number after = in Q: field";i.bpm=parseInt(h.token)}else throw"Expected number or equal after C in Q: field"}else if(h.type==="number"){var m=parseInt(h.token);if(a.length===0||a[0].type==="quote")i.duration=[1],i.bpm=m;else{if(s=!1,h=a.shift(),h.type!=="punct"&&h.token!=="/"||(h=a.shift(),h.type!=="number"))throw"Expected fraction in Q: field";var v=parseInt(h.token);for(i.duration=[m/v];a.length>0&&a[0].token!=="="&&a[0].type!=="quote";){if(h=a.shift(),h.type!=="number"||(m=parseInt(h.token),h=a.shift(),h.type!=="punct"&&h.token!=="/")||(h=a.shift(),h.type!=="number"))throw"Expected fraction in Q: field";v=parseInt(h.token),i.duration.push(m/v)}if(h=a.shift(),h.type!=="punct"&&h.token!=="=")throw"Expected = in Q: field";if(h=a.shift(),h.type!=="number")throw"Expected tempo in Q: field";i.bpm=parseInt(h.token)}}else throw"Unknown value in Q: field";if(a.length!==0&&(h=a.shift(),h.type==="quote"&&(i.postString=h.token,h=a.shift()),a.length!==0))throw"Unexpected string at end of Q: field";return r.printTempo===!1&&(i.suppress=!0),{type:s?"delaySet":"immediate",tempo:i}}catch(w){return t(w,n,o),{type:"none"}}},this.letter_to_inline_header=function(n,o,c){var p=e.eatWhiteSpace(n,o);if(o+=p,n.length>=o+5&&n[o]==="["&&n[o+2]===":"){var a=n.indexOf("]",o),i=r.iChar+o,s=r.iChar+a+1;switch(n.substring(o,o+3)){case"[I:":var h=Y.addDirective(n.substring(o+3,a));return h&&t(h,n,o),[a-o+1+p];case"[M:":var m=this.setMeter(n.substring(o+3,a));return l.hasBeginMusic()&&m?l.appendStartingElement("meter",i,s,m):r.meter=m,[a-o+1+p];case"[K:":var v=V.parseKey(n.substring(o+3,a),!0);return v.foundClef&&l.hasBeginMusic()&&l.appendStartingElement("clef",i,s,r.clef),v.foundKey&&l.hasBeginMusic()&&l.appendStartingElement("key",i,s,V.fixKey(r.clef,r.key)),[a-o+1+p];case"[P:":var w=Y.parseFontChangeLine(n.substring(o+3,a));return c||u.lines.length<=u.lineNum?r.partForNextLine={title:w,startChar:i,endChar:s}:l.appendElement("part",i,s,{title:w}),[a-o+1+p];case"[L:":return this.setDefaultLength(n,o+3,a),[a-o+1+p];case"[Q:":if(a>0){var N=this.setTempo(n,o+3,a,r.iChar);return N.type==="delaySet"?l.hasBeginMusic()?l.appendElement("tempo",i,s,this.calcTempo(N.tempo)):r.tempoForNextLine=["tempo",i,s,this.calcTempo(N.tempo)]:N.type==="immediate"&&(!c&&l.hasBeginMusic()?l.appendElement("tempo",i,s,N.tempo):r.tempoForNextLine=["tempo",i,s,N.tempo]),[a-o+1+p,n[o+1],n.substring(o+3,a)]}break;case"[V:":if(a>0)return V.parseVoice(n,o+3,a),[a-o+1+p,n[o+1],n.substring(o+3,a)];break;case"[r:":return[a-o+1+p];default:}}return[0]},this.letter_to_body_header=function(n,o){if(n.length>=o+3)switch(n.substring(o,o+2)){case"I:":var c=Y.addDirective(n.substring(o+2));return c&&t(c,n,o),[n.length];case"M:":var p=this.setMeter(n.substring(o+2));return l.hasBeginMusic()&&p&&l.appendStartingElement("meter",r.iChar+o,r.iChar+n.length,p),[n.length];case"K:":var a=V.parseKey(n.substring(o+2),l.hasBeginMusic());return a.foundClef&&l.hasBeginMusic()&&l.appendStartingElement("clef",r.iChar+o,r.iChar+n.length,r.clef),a.foundKey&&l.hasBeginMusic()&&l.appendStartingElement("key",r.iChar+o,r.iChar+n.length,V.fixKey(r.clef,r.key)),[n.length];case"P:":return l.hasBeginMusic()&&l.appendElement("part",r.iChar+o,r.iChar+n.length,{title:n.substring(o+2)}),[n.length];case"L:":return this.setDefaultLength(n,o+2,n.length),[n.length];case"Q:":var i=n.indexOf("",o+2);i===-1&&(i=n.length);var s=this.setTempo(n,o+2,i,r.iChar);return s.type==="delaySet"?l.appendElement("tempo",r.iChar+o,r.iChar+n.length,this.calcTempo(s.tempo)):s.type==="immediate"&&l.appendElement("tempo",r.iChar+o,r.iChar+n.length,s.tempo),[i,n[o],G.strip(n.substring(o+2))];case"V:":return V.parseVoice(n,o+2,n.length),[n.length,n[o],G.strip(n.substring(o+2))];default:}return[0]};var f={A:"author",B:"book",C:"composer",D:"discography",F:"url",G:"group",I:"instruction",N:"notes",O:"origin",R:"rhythm",S:"source",W:"unalignedWords",Z:"transcription"};this.parseHeader=function(n){var o=f[n[0]],c=n.length-2,p=e.translateString(e.stripComment(n.substring(2)));if(o==="unalignedWords"||o==="notes")l.addMetaTextArray(o,Y.parseFontChangeLine(p),{startChar:r.iChar,endChar:r.iChar+n.length});else if(o!==void 0)l.addMetaText(o,Y.parseFontChangeLine(p),{startChar:r.iChar,endChar:r.iChar+n.length});else{var a=r.iChar,i=a+n.length;switch(n[0]){case"H":for(l.addMetaTextArray("history",Y.parseFontChangeLine(p),{startChar:r.iChar,endChar:r.iChar+n.length}),n=e.peekLine();n&&n[1]!==":";)e.nextLine(),l.addMetaTextArray("history",Y.parseFontChangeLine(e.translateString(e.stripComment(n))),{startChar:r.iChar,endChar:r.iChar+n.length}),n=e.peekLine();break;case"K":this.resolveTempo();var s=V.parseKey(n.substring(2),!1);!r.is_in_header&&l.hasBeginMusic()&&(s.foundClef&&l.appendStartingElement("clef",a,i,r.clef),s.foundKey&&l.appendStartingElement("key",a,i,V.fixKey(r.clef,r.key))),r.is_in_header=!1;break;case"L":this.setDefaultLength(n,2,n.length);break;case"M":r.origMeter=r.meter=this.setMeter(n.substring(2));break;case"P":r.is_in_header?l.addMetaText("partOrder",Y.parseFontChangeLine(p),{startChar:r.iChar,endChar:r.iChar+n.length}):r.partForNextLine={title:p,startChar:a,endChar:i};break;case"Q":var h=this.setTempo(n,2,n.length,r.iChar);h.type==="delaySet"?r.tempo=h.tempo:h.type==="immediate"&&(u.metaText.tempo?r.tempoForNextLine=["tempo",a,i,h.tempo]:u.metaText.tempo=h.tempo);break;case"T":r.titlecaps&&(p=p.toUpperCase()),this.setTitle(Y.parseFontChangeLine(e.theReverser(p)),c);break;case"U":this.addUserDefinition(n,2,n.length);break;case"V":if(V.parseVoice(n,2,n.length),!r.is_in_header)return{newline:!0};break;case"s":return{symbols:!0};case"w":return{words:!0};case"X":break;case"E":case"m":t("Ignored header",n,0);break;default:return{regular:!0}}}return{}}}var vr=["trill","lowermordent","uppermordent","mordent","pralltriller","accent","fermata","invertedfermata","tenuto","0","1","2","3","4","5","+","wedge","open","thumb","snap","turn","roll","breath","shortphrase","mediumphrase","longphrase","segno","coda","D.S.","D.C.","fine","beambr1","beambr2","slide","marcato","upbow","downbow","/","//","///","////","trem1","trem2","trem3","trem4","turnx","invertedturn","invertedturnx","trill(","trill)","arpeggio","xstem","mark","umarcato","style=normal","style=harmonic","style=rhythm","style=x","style=triangle","D.C.alcoda","D.C.alfine","D.S.alcoda","D.S.alfine","editorial","courtesy"],br=["p","pp","f","ff","mf","mp","ppp","pppp","fff","ffff","sfz"],yr=["crescendo(","crescendo)","diminuendo(","diminuendo)","glissando(","glissando)","~(","~)"],xr=[["<","accent"],[">","accent"],["tr","trill"],["plus","+"],["emphasis","accent"],["^","umarcato"],["marcato","umarcato"]],wr=[["<(","crescendo("],["<)","crescendo)"],[">(","diminuendo("],[">)","diminuendo)"]],Ba="ABCDEFGabcdefgxyzZ[]|^_{",Pa=[.5,.75,.875,.9375,.96875,.984375,.25,.375,.4375,.46875,.484375,.4921875,.125,.1875,.21875,.234375,.2421875,.24609375,.0625,.09375,.109375,.1171875,.12109375,.123046875,.03125,.046875,.0546875,.05859375,.060546875,.0615234375,.015625,.0234375,.02734375,.029296875,.0302734375,.03076171875],Aa={A:5,B:6,C:0,D:1,E:2,F:3,G:4,a:12,b:13,c:7,d:8,e:9,f:10,g:11},Fa={x:"invisible",X:"invisible-multimeasure",y:"spacer",z:"rest",Z:"multimeasure"},Cr={dblflat:"__",flat:"_",natural:"=",sharp:"^",dblsharp:"^^",quarterflat:"_/",quartersharp:"^/"},Da={2:3,3:2,4:3,5:2,6:2,7:2,8:3,9:2};var Q,Z,C,me,ke,mt;function vt(e,t,r,u,l,d){Q=e,Z=t,C=r,me=u,ke=l,mt=d,this.lineContinuation=!1}var Sa=function(e,t,r){if(e.inTie[t]===void 0)return!1;var u=e.currentVoice?e.currentVoice.staffNum*100+e.currentVoice.index:0;return!!(e.inTie[t][u]&&(r.pitches!==void 0||r.rest.type!=="spacer"))},T={};vt.prototype.parseMusic=function(e){mt.resolveTempo(),C.is_in_header=!1;for(var t=0,r=C.iChar;Q.isWhiteSpace(e[t])&&t<e.length;)t++;if(!(t===e.length||e[t]==="%")){var u=C.start_new_line;C.continueall===void 0?C.start_new_line=!0:C.start_new_line=!1;var l=0,d=mt.letter_to_body_header(e,t);d[0]>0&&(t+=d[0],d[1]==="V"&&this.startNewLine());for(var f=0;t<e.length;){var n=t;if(e[t]==="%")break;var o=mt.letter_to_inline_header(e,t,u);if(o[0]>0)t+=o[0],o[1]==="V"&&(u=!0);else{(!ke.hasBeginMusic()||u&&!this.lineContinuation)&&(this.startNewLine(),u=!1);for(var c;;)if(c=Q.eatWhiteSpace(e,t),c>0&&(t+=c),t>0&&e[t-1]===""&&(c=mt.letter_to_body_header(e,t),c[0]>0&&(c[1]==="V"&&this.startNewLine(),t=c[0],C.start_new_line=!1)),c=Oi(e,t),c[0]>0&&(t+=c[0]),c=Di(e,t),c[0]>0){T.chord||(T.chord=[]);var p=Q.translateString(c[1]);p=p.replace(/;/g,`
`);for(var a=!1,i=0;i<T.chord.length;i++)T.chord[i].position===c[2]&&(a=!0,T.chord[i].name+=`
`+p);a===!1&&(c[2]===null&&c[3]?T.chord.push({name:p,rel_position:c[3]}):T.chord.push({name:p,position:c[2]})),t+=c[0];var s=Q.skipWhiteSpace(e.substring(t));s>0&&(T.force_end_beam_last=!0),t+=s}else if(Ba.indexOf(e[t])===-1?c=Oa(e,t):c=[0],c[0]>0)c[1]===null?t+1<e.length&&this.startNewLine():c[1].length>0&&(c[1].indexOf("style=")===0?T.style=c[1].substr(6):(T.decoration===void 0&&(T.decoration=[]),c[1]==="beambr1"?T.beambr=1:c[1]==="beambr2"?T.beambr=2:T.decoration.push(c[1]))),t+=c[0];else if(c=Si(e,t),c[0]>0)T.gracenotes=c[1],t+=c[0];else break;if(c=Gi(e,t),c[0]>0){f=0,T.gracenotes!==void 0&&(T.rest={type:"spacer"},T.duration=.125,C.addFormattingOptions(T,me.formatting,"note"),ke.appendElement("note",r+t,r+t+c[0],T),C.measureNotEmpty=!0,T={});var h={type:c[1]};if(h.type.length===0)Z("Unknown bar type",e,t);else{if(C.inEnding&&h.type!=="bar_thin"&&(h.endEnding=!0,C.inEnding=!1),c[2]&&(h.startEnding=c[2],C.inEnding&&(h.endEnding=!0),C.inEnding=!0,c[1]==="bar_right_repeat"?C.restoreStartEndingHoldOvers():C.duplicateStartEndingHoldOvers()),T.decoration!==void 0&&(h.decoration=T.decoration),T.chord!==void 0&&(h.chord=T.chord),h.startEnding&&C.barFirstEndingNum===void 0?C.barFirstEndingNum=C.currBarNumber:h.startEnding&&h.endEnding&&C.barFirstEndingNum?C.currBarNumber=C.barFirstEndingNum:h.endEnding&&(C.barFirstEndingNum=void 0),h.type!=="bar_invisible"&&C.measureNotEmpty){var m=C.currentVoice===void 0||C.currentVoice.staffNum===0&&C.currentVoice.index===0;m&&(C.currBarNumber++,C.barNumbers&&C.currBarNumber%C.barNumbers===0&&(h.barNumber=C.currBarNumber))}C.addFormattingOptions(T,me.formatting,"bar"),ke.appendElement("bar",r+n,r+t+c[0],h),C.measureNotEmpty=!1,T={}}t+=c[0]}else if(e[t]==="&")c=Ii(e,t),c[0]>0&&(ke.appendElement("overlay",r,r+1,{}),t+=1,f++);else{if(c=zi(e,t),c.consumed>0&&(c.startSlur!==void 0&&(T.startSlur=c.startSlur),c.dottedSlur&&(T.dottedSlur=!0),c.triplet!==void 0&&(l>0?Z("Can't nest triplets",e,t):(T.startTriplet=c.triplet,T.tripletMultiplier=c.tripletQ/c.triplet,T.tripletR=c.num_notes,l=c.num_notes===void 0?c.triplet:c.num_notes)),t+=c.consumed),e[t]==="["){var v=t;t++;for(var w=null,N=!1,L=!1;!L;){var x=Oa(e,t);x[0]>0&&(t+=x[0]);var g=Er(e,t,{},!1);if(g!==null&&g.pitch!==void 0)x[0]>0&&x[1].indexOf("style=")!==0&&(T.decoration===void 0&&(T.decoration=[]),T.decoration.push(x[1])),g.end_beam&&(T.end_beam=!0,delete g.end_beam),T.pitches===void 0?(T.duration=g.duration,T.pitches=[g]):T.pitches.push(g),delete g.duration,x[0]>0&&x[1].indexOf("style=")===0&&(T.pitches[T.pitches.length-1].style=x[1].substr(6)),C.inTieChord[T.pitches.length]&&(g.endTie=!0,C.inTieChord[T.pitches.length]=void 0),g.startTie&&(C.inTieChord[T.pitches.length]=!0),t=g.endChar,delete g.endChar;else if(e[t]===" ")Z("Spaces are not allowed in chords",e,t),t++;else{if(t<e.length&&e[t]==="]"){t++,C.next_note_duration!==0&&(T.duration=T.duration*C.next_note_duration,C.next_note_duration=0),Sa(C,f,T)&&(T.pitches.forEach(function(B){B.endTie=!0}),pt(C,f,!1)),l>0&&!(T.rest&&T.rest.type==="spacer")&&(l--,l===0&&(T.endTriplet=!0));for(var k=!1;t<e.length&&!k;){switch(e[t]){case" ":case"	":gt(T);break;case")":T.endSlur===void 0?T.endSlur=1:T.endSlur++;break;case"-":T.pitches.forEach(function(B){B.startTie={}}),pt(C,f,!0);break;case">":case"<":var D=Ga(e,t);t+=D[0]-1,C.next_note_duration=D[2],w?w=w*D[1]:w=D[1];break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"/":var P=Q.getFraction(e,t);w=P.value,t=P.index;var A=e[t];A===" "&&(N=!0),A==="-"||A===")"||A===" "||A==="<"||A===">"?t--:k=!0;break;default:k=!0;break}k||t++}}else Z("Expected ']' to end the chords",e,t);T.pitches!==void 0&&(w!==null&&(T.duration=T.duration*w,N&&gt(T)),C.addFormattingOptions(T,me.formatting,"note"),ke.appendElement("note",r+n,r+t,T),C.measureNotEmpty=!0,T={}),L=!0}}}else{var S={},M=Er(e,t,S,!0);S.endTie!==void 0&&pt(C,f,!0),M!==null&&(M.pitch!==void 0?(T.pitches=[{}],M.accidental!==void 0&&(T.pitches[0].accidental=M.accidental),T.pitches[0].pitch=M.pitch,T.pitches[0].name=M.name,(M.midipitch||M.midipitch===0)&&(T.pitches[0].midipitch=M.midipitch),M.endSlur!==void 0&&(T.pitches[0].endSlur=M.endSlur),M.endTie!==void 0&&(T.pitches[0].endTie=M.endTie),M.startSlur!==void 0&&(T.pitches[0].startSlur=M.startSlur),T.startSlur!==void 0&&(T.pitches[0].startSlur=T.startSlur),T.dottedSlur!==void 0&&(T.pitches[0].dottedSlur=!0),M.startTie!==void 0&&(T.pitches[0].startTie=M.startTie),T.startTie!==void 0&&(T.pitches[0].startTie=T.startTie)):(T.rest=M.rest,M.endSlur!==void 0&&(T.endSlur=M.endSlur),M.endTie!==void 0&&(T.rest.endTie=M.endTie),M.startSlur!==void 0&&(T.startSlur=M.startSlur),M.startTie!==void 0&&(T.rest.startTie=M.startTie),T.startTie!==void 0&&(T.rest.startTie=T.startTie)),M.chord!==void 0&&(T.chord=M.chord),M.duration!==void 0&&(T.duration=M.duration),M.decoration!==void 0&&(T.decoration=M.decoration),M.graceNotes!==void 0&&(T.graceNotes=M.graceNotes),delete T.startSlur,delete T.dottedSlur,Sa(C,f,T)&&(T.pitches!==void 0?T.pitches[0].endTie=!0:T.rest.type!=="spacer"&&(T.rest.endTie=!0),pt(C,f,!1)),(M.startTie||T.startTie)&&pt(C,f,!0),t=M.endChar,l>0&&!(M.rest&&M.rest.type==="spacer")&&(l--,l===0&&(T.endTriplet=!0)),M.end_beam&&gt(T),T.rest&&T.rest.type==="rest"&&T.duration===1&&Ia(C)<=1&&(T.rest.type="whole",T.duration=Ia(C)),T.duration<1&&Pa.indexOf(T.duration)===-1&&T.duration!==0&&(!T.rest||T.rest.type!=="spacer")&&Z("Duration not representable: "+e.substring(n,t),e,t),C.addFormattingOptions(T,me.formatting,"note"),ke.appendElement("note",r+n,r+t,T),C.measureNotEmpty=!0,T={})}t===n&&(e[t]!==" "&&e[t]!=="`"&&Z("Unknown character ignored",e,t),t++)}}}this.lineContinuation=e.indexOf("")>=0||d[0]>0,this.lineContinuation||(T={})}};var pt=function(e,t,r){var u=e.currentVoice?e.currentVoice.staffNum*100+e.currentVoice.index:0;e.inTie[t]===void 0&&(e.inTie[t]=[]),e.inTie[t][u]=r},Di=function(e,t){if(e[t]==='"'){var r=Q.getBrackettedSubstring(e,t,5);if(r[2]||Z("Missing the closing quote while parsing the chord symbol",e,t),r[0]>0&&r[1].length>0&&r[1][0]==="^")r[1]=r[1].substring(1),r[2]="above";else if(r[0]>0&&r[1].length>0&&r[1][0]==="_")r[1]=r[1].substring(1),r[2]="below";else if(r[0]>0&&r[1].length>0&&r[1][0]==="<")r[1]=r[1].substring(1),r[2]="left";else if(r[0]>0&&r[1].length>0&&r[1][0]===">")r[1]=r[1].substring(1),r[2]="right";else if(r[0]>0&&r[1].length>0&&r[1][0]==="@"){r[1]=r[1].substring(1);var u=Q.getFloat(r[1]);u.digits===0&&Z("Missing first position in absolutely positioned annotation.",e,t),r[1]=r[1].substring(u.digits),r[1][0]!==","&&Z("Missing comma absolutely positioned annotation.",e,t),r[1]=r[1].substring(1);var l=Q.getFloat(r[1]);l.digits===0&&Z("Missing second position in absolutely positioned annotation.",e,t),r[1]=r[1].substring(l.digits);var d=Q.skipWhiteSpace(r[1]);r[1]=r[1].substring(d),r[2]=null,r[3]={x:u.value,y:l.value}}else C.freegchord!==!0&&(r[1]=r[1].replace(/([ABCDEFG0-9])b/g,"$1♭"),r[1]=r[1].replace(/([ABCDEFG0-9])#/g,"$1♯"),r[1]=r[1].replace(/^([ABCDEFG])([♯♭]?)o([^A-Za-z])/g,"$1$2°$3"),r[1]=r[1].replace(/^([ABCDEFG])([♯♭]?)o$/g,"$1$2°"),r[1]=r[1].replace(/^([ABCDEFG])([♯♭]?)0([^A-Za-z])/g,"$1$2ø$3"),r[1]=r[1].replace(/^([ABCDEFG])([♯♭]?)\^([^A-Za-z])/g,"$1$2∆$3")),r[2]="default",r[1]=dt.chordName(C,r[1]);return r}return[0,""]},Si=function(e,t){if(e[t]==="{"){var r=Q.getBrackettedSubstring(e,t,1,"}");r[2]||Z("Missing the closing '}' while parsing grace note",e,t),e[t+r[0]]===")"&&(r[0]++,r[1]+=")");for(var u=[],l=0,d=!1;l<r[1].length;){var f=!1;r[1][l]==="/"&&(f=!0,l++);var n=Er(r[1],l,{},!1);n!==null?(n.duration=n.duration/(C.default_length*8),f&&(n.acciaccatura=!0),u.push(n),d&&(n.endTie=!0,d=!1),n.startTie&&(d=!0),l=n.endChar,delete n.endChar,n.end_beam&&(n.endBeam=!0,delete n.end_beam)):(r[1][l]===" "?u.length>0&&(u[u.length-1].endBeam=!0):Z("Unknown character '"+r[1][l]+"' while parsing grace note",e,t),l++)}if(u.length)return[r[0],u]}return[0]};function Ii(e,t){if(e[t]==="&"){for(var r=t;e[t]&&e[t]!==":"&&e[t]!=="|";)t++;return[t-r,e.substring(r+1,t)]}return[0]}function Ia(e){var t=e.origMeter;return!t||t.type!=="specified"||!t.value||t.value.length===0?1:parseInt(t.value[0].num,10)/parseInt(t.value[0].den,10)}var Oa=function(e,t){var r=C.macros[e[t]];if(r!==void 0)return(r[0]==="!"||r[0]==="+")&&(r=r.substring(1)),(r[r.length-1]==="!"||r[r.length-1]==="+")&&(r=r.substring(0,r.length-1)),vr.includes(r)?[1,r]:br.includes(r)?(C.volumePosition==="hidden"&&(r=""),[1,r]):yr.includes(r)?(C.dynamicPosition==="hidden"&&(r=""),[1,r]):(C.ignoredDecorations.includes(r)||Z("Unknown macro: "+r,e,t),[1,""]);switch(e[t]){case".":if(e[t+1]==="("||e[t+1]==="-")break;return[1,"staccato"];case"u":return[1,"upbow"];case"v":return[1,"downbow"];case"~":return[1,"irishroll"];case"!":case"+":var u=Q.getBrackettedSubstring(e,t,5);if(u[1].length>1&&(u[1][0]==="^"||u[1][0]==="_")&&(u[1]=u[1].substring(1)),vr.includes(u[1]))return u;if(br.includes(u[1]))return C.volumePosition==="hidden"&&(u[1]=""),u;if(yr.includes(u[1]))return C.dynamicPosition==="hidden"&&(u[1]=""),u;var l=xr.findIndex(function(d){return u[1]===d[0]});return l>=0?(u[1]=xr[l][1],u):(l=wr.findIndex(function(d){return u[1]===d[0]}),l>=0?(u[1]=wr[l][1],C.dynamicPosition==="hidden"&&(u[1]=""),u):e[t]==="!"&&(u[0]===1||e[t+u[0]-1]!=="!")?[1,null]:(Z("Unknown decoration: "+u[1],e,t),u[1]="",u));case"H":return[1,"fermata"];case"J":return[1,"slide"];case"L":return[1,"accent"];case"M":return[1,"mordent"];case"O":return[1,"coda"];case"P":return[1,"pralltriller"];case"R":return[1,"roll"];case"S":return[1,"segno"];case"T":return[1,"trill"]}return[0,0]},Oi=function(e,t){for(var r=t;Q.isWhiteSpace(e[t]);)t++;return[t-r]},Gi=function(e,t){var r=Q.getBarLine(e,t);if(r.len===0)return[0,""];if(r.warn)return Z(r.warn,e,t),[r.len,""];for(var u=0;u<e.length&&e[t+r.len+u]===" ";u++);var l=r.len;if(e[t+r.len+u]==="["&&(r.len+=u+1),e[t+r.len]==='"'&&e[t+r.len-1]==="["){var d=Q.getBrackettedSubstring(e,t+r.len,5);return[r.len+d[0],r.token,d[1]]}var f=Q.getTokenOf(e.substring(t+r.len),"1234567890-,");return f.len===0||f.token[0]==="-"?[l,r.token]:[r.len+f.len,r.token,f.token]},zi=function(e,t){var r={},u=t;for(e[t]==="."&&e[t+1]==="("&&(r.dottedSlur=!0,t++);e[t]==="("||Q.isWhiteSpace(e[t]);)e[t]==="("&&(t+1<e.length&&e[t+1]>="2"&&e[t+1]<="9"?(r.triplet!==void 0?Z("Can't nest triplets",e,t):(r.triplet=e[t+1]-"0",r.tripletQ=Da[r.triplet],r.num_notes=r.triplet,t+2<e.length&&e[t+2]===":"&&(t+3<e.length&&e[t+3]===":"?t+4<e.length&&e[t+4]>="1"&&e[t+4]<="9"?(r.num_notes=e[t+4]-"0",t+=3):Z("expected number after the two colons after the triplet to mark the duration",e,t):t+3<e.length&&e[t+3]>="1"&&e[t+3]<="9"?(r.tripletQ=e[t+3]-"0",t+4<e.length&&e[t+4]===":"?t+5<e.length&&e[t+5]>="1"&&e[t+5]<="9"&&(r.num_notes=e[t+5]-"0",t+=4):t+=2):Z("expected number after the triplet to mark the duration",e,t))),t++):r.startSlur===void 0?r.startSlur=1:r.startSlur++),t++;return r.consumed=t-u,r};vt.prototype.startNewLine=function(){var e={startChar:-1,endChar:-1};C.partForNextLine.title&&(e.part=C.partForNextLine),e.clef=C.currentVoice&&C.staves[C.currentVoice.staffNum].clef!==void 0?G.clone(C.staves[C.currentVoice.staffNum].clef):G.clone(C.clef);var t=C.currentVoice?C.currentVoice.scoreTranspose:0;if(e.key=V.standardKey(C.key.root+C.key.acc+C.key.mode,C.key.root,C.key.acc,t),e.key.mode=C.key.mode,C.key.impliedNaturals&&(e.key.impliedNaturals=C.key.impliedNaturals),C.key.explicitAccidentals)for(var r=0;r<C.key.explicitAccidentals.length;r++){for(var u=!1,l=0;l<e.key.accidentals.length;l++)e.key.accidentals[l].note===C.key.explicitAccidentals[r].note&&(e.key.accidentals[l].acc=C.key.explicitAccidentals[r].acc,u=!0);u||e.key.accidentals.push(C.key.explicitAccidentals[r])}if(C.targetKey=e.key,e.key.explicitAccidentals&&delete e.key.explicitAccidentals,V.addPosToKey(e.clef,e.key),C.meter!==null?(C.currentVoice?(C.staves.forEach(function(n){n.meter=C.meter}),e.meter=C.staves[C.currentVoice.staffNum].meter,C.staves[C.currentVoice.staffNum].meter=null):e.meter=C.meter,C.meter=null):C.currentVoice&&C.staves[C.currentVoice.staffNum].meter&&(e.meter=C.staves[C.currentVoice.staffNum].meter,C.staves[C.currentVoice.staffNum].meter=null),C.currentVoice&&C.currentVoice.name&&(e.name=C.currentVoice.name),C.vocalfont&&(e.vocalfont=C.vocalfont),C.tripletfont&&(e.tripletfont=C.tripletfont),C.gchordfont&&(e.gchordfont=C.gchordfont),C.style&&(e.style=C.style),C.currentVoice){var d=C.staves[C.currentVoice.staffNum];d.brace&&(e.brace=d.brace),d.bracket&&(e.bracket=d.bracket),d.connectBarLines&&(e.connectBarLines=d.connectBarLines),d.name&&(e.name=d.name[C.currentVoice.index]),d.subname&&(e.subname=d.subname[C.currentVoice.index]),C.currentVoice.stem&&(e.stem=C.currentVoice.stem),C.currentVoice.stafflines&&(e.stafflines=C.currentVoice.stafflines),C.currentVoice.staffscale&&(e.staffscale=C.currentVoice.staffscale),C.currentVoice.scale&&(e.scale=C.currentVoice.scale),C.currentVoice.color&&(e.color=C.currentVoice.color),C.currentVoice.style&&(e.style=C.currentVoice.style),C.currentVoice.transpose&&(e.clef.transpose=C.currentVoice.transpose)}var f=C.currentVoice===void 0||C.currentVoice.staffNum===0&&C.currentVoice.index===0;C.barNumbers===0&&f&&C.currBarNumber!==1&&(e.barNumber=C.currBarNumber),ke.startNewLine(e),C.key.impliedNaturals&&delete C.key.impliedNaturals,C.partForNextLine={},C.tempoForNextLine.length===4&&ke.appendElement(C.tempoForNextLine[0],C.tempoForNextLine[1],C.tempoForNextLine[2],C.tempoForNextLine[3]),C.tempoForNextLine=[]};var gt=function(e){return e.duration!==void 0&&e.duration<.25&&(e.end_beam=!0),e},Er=function(e,t,r,u){var l=function(i){return i==="octave"||i==="duration"||i==="Zduration"||i==="broken_rhythm"||i==="end_slur"},d;e[t]==="."&&e[t+1]==="-"&&(d=!0,t++);for(var f="startSlur",n=!1;;){switch(e[t]){case"(":if(f==="startSlur")r.startSlur===void 0?r.startSlur=1:r.startSlur++;else return l(f)?(r.endChar=t,r):null;break;case")":if(l(f))r.endSlur===void 0?r.endSlur=1:r.endSlur++;else return null;break;case"^":if(f==="startSlur")r.accidental="sharp",f="sharp2";else if(f==="sharp2")r.accidental="dblsharp",f="pitch";else return l(f)?(r.endChar=t,r):null;break;case"_":if(f==="startSlur")r.accidental="flat",f="flat2";else if(f==="flat2")r.accidental="dblflat",f="pitch";else return l(f)?(r.endChar=t,r):null;break;case"=":if(f==="startSlur")r.accidental="natural",f="pitch";else return l(f)?(r.endChar=t,r):null;break;case"A":case"B":case"C":case"D":case"E":case"F":case"G":case"a":case"b":case"c":case"d":case"e":case"f":case"g":if(f==="startSlur"||f==="sharp2"||f==="flat2"||f==="pitch"){if(r.pitch=Aa[e[t]],r.pitch+=7*(C.currentVoice&&C.currentVoice.octave!==void 0?C.currentVoice.octave:C.octave),r.name=e[t],r.accidental&&(r.name=Cr[r.accidental]+r.name),dt.note(C,r),f="octave",u&&C.next_note_duration!==0?(r.duration=C.default_length*C.next_note_duration,C.next_note_duration=0,n=!0):r.duration=C.default_length,C.clef&&C.clef.type==="perc"||C.currentVoice&&C.currentVoice.clef==="perc"){var o=e[t];r.accidental&&(o=Cr[r.accidental]+o),me.formatting&&me.formatting.midi&&me.formatting.midi.drummap&&(r.midipitch=me.formatting.midi.drummap[o])}}else return l(f)?(r.endChar=t,r):null;break;case",":if(f==="octave")r.pitch-=7,r.name+=",";else return l(f)?(r.endChar=t,r):null;break;case"'":if(f==="octave")r.pitch+=7,r.name+="'";else return l(f)?(r.endChar=t,r):null;break;case"x":case"X":case"y":case"z":case"Z":if(f==="startSlur")r.rest={type:Fa[e[t]]},delete r.accidental,delete r.startSlur,delete r.startTie,delete r.endSlur,delete r.endTie,delete r.end_beam,delete r.grace_notes,r.rest.type.indexOf("multimeasure")>=0?(r.duration=me.getBarLength(),r.rest.text=1,f="Zduration"):(u&&C.next_note_duration!==0?(r.duration=C.default_length*C.next_note_duration,C.next_note_duration=0,n=!0):r.duration=C.default_length,f="duration");else return l(f)?(r.endChar=t,r):null;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"0":case"/":if(f==="octave"||f==="duration"){var c=Q.getFraction(e,t);for(r.duration=r.duration*c.value,r.endChar=c.index;c.index<e.length&&(Q.isWhiteSpace(e[c.index])||e[c.index]==="-");)e[c.index]==="-"?r.startTie={}:r=gt(r),c.index++;t=c.index-1,f="broken_rhythm"}else if(f==="sharp2")r.accidental="quartersharp",f="pitch";else if(f==="flat2")r.accidental="quarterflat",f="pitch";else if(f==="Zduration"){var p=Q.getNumber(e,t);return r.duration=p.num*me.getBarLength(),r.rest.text=p.num,r.endChar=p.index,r}else return null;break;case"-":if(f==="startSlur")ke.addTieToLastNote(d),r.endTie=!0;else if(f==="octave"||f==="duration"||f==="end_slur")if(r.startTie={},!n&&u)f="broken_rhythm";else return Q.isWhiteSpace(e[t+1])&&gt(r),r.endChar=t+1,r;else return f==="broken_rhythm"?(r.endChar=t,r):null;break;case" ":case"	":if(l(f)){r.end_beam=!0,d=!1;do e[t]==="."&&e[t+1]==="-"&&(d=!0,t++),e[t]==="-"&&(r.startTie={},d&&(r.startTie.style="dotted")),t++;while(t<e.length&&(Q.isWhiteSpace(e[t])||e[t]==="-")||e[t]==="."&&e[t+1]==="-");if(r.endChar=t,!n&&u&&(e[t]==="<"||e[t]===">"))t--,f="broken_rhythm";else return r}else return null;break;case">":case"<":if(l(f))if(u){var a=Ga(e,t);t+=a[0]-1,C.next_note_duration=a[2],r.duration=a[1]*r.duration,f="end_slur"}else return r.endChar=t,r;else return null;break;default:return l(f)?(r.endChar=t,r):null}if(t++,t===e.length)return l(f)?(r.endChar=t,r):null}return null},Ga=function(e,t){switch(e[t]){case">":return t<e.length-2&&e[t+1]===">"&&e[t+2]===">"?[3,1.875,.125]:t<e.length-1&&e[t+1]===">"?[2,1.75,.25]:[1,1.5,.5];case"<":return t<e.length-2&&e[t+1]==="<"&&e[t+2]==="<"?[3,.125,1.875]:t<e.length-1&&e[t+1]==="<"?[2,.25,1.75]:[1,.5,1.5]}return null};var kr=function(e,t){this.lineIndex=0,this.lines=e,this.multilineVars=t,this.skipWhiteSpace=function(a){for(var i=0;i<a.length;i++)if(!this.isWhiteSpace(a[i]))return i;return a.length};var r=function(a,i){return i>=a.length};this.eatWhiteSpace=function(a,i){for(var s=i;s<a.length;s++)if(!this.isWhiteSpace(a[s]))return s-i;return s-i},this.getKeyPitch=function(a){var i=this.skipWhiteSpace(a);if(r(a,i))return{len:0};switch(a[i]){case"A":return{len:i+1,token:"A"};case"B":return{len:i+1,token:"B"};case"C":return{len:i+1,token:"C"};case"D":return{len:i+1,token:"D"};case"E":return{len:i+1,token:"E"};case"F":return{len:i+1,token:"F"};case"G":return{len:i+1,token:"G"}}return{len:0}},this.getSharpFlat=function(a){if(a==="bass")return{len:0};switch(a[0]){case"#":return{len:1,token:"#"};case"b":return{len:1,token:"b"}}return{len:0}},this.getMode=function(a){var i=function(m,v){for(;v<m.length&&(m[v]>="a"&&m[v]<="z"||m[v]>="A"&&m[v]<="Z");)v++;return v},s=this.skipWhiteSpace(a);if(r(a,s))return{len:0};var h=a.substring(s,s+3).toLowerCase();switch((h.length>1&&h[1]===" "||h[1]==="^"||h[1]==="_"||h[1]==="=")&&(h=h[0]),h){case"mix":return{len:i(a,s),token:"Mix"};case"dor":return{len:i(a,s),token:"Dor"};case"phr":return{len:i(a,s),token:"Phr"};case"lyd":return{len:i(a,s),token:"Lyd"};case"loc":return{len:i(a,s),token:"Loc"};case"aeo":return{len:i(a,s),token:"m"};case"maj":return{len:i(a,s),token:""};case"ion":return{len:i(a,s),token:""};case"min":return{len:i(a,s),token:"m"};case"m":return{len:i(a,s),token:"m"}}return{len:0}},this.getClef=function(a,i){var s=a,h=this.skipWhiteSpace(a);if(r(a,h))return{len:0};var m=!1,v=a.substring(h);if(G.startsWith(v,"clef=")&&(m=!0,v=v.substring(5),h+=5),v.length===0&&m)return{len:h+5,warn:"No clef specified: "+s};var w=this.skipWhiteSpace(v);if(r(v,w))return{len:0};w>0&&(h+=w,v=v.substring(w));var N=null;if(G.startsWith(v,"treble"))N="treble";else if(G.startsWith(v,"bass3"))N="bass3";else if(G.startsWith(v,"bass"))N="bass";else if(G.startsWith(v,"tenor"))N="tenor";else if(G.startsWith(v,"alto2"))N="alto2";else if(G.startsWith(v,"alto1"))N="alto1";else if(G.startsWith(v,"alto"))N="alto";else if(!i&&m&&G.startsWith(v,"none"))N="none";else if(G.startsWith(v,"perc"))N="perc";else if(!i&&m&&G.startsWith(v,"C"))N="tenor";else if(!i&&m&&G.startsWith(v,"F"))N="bass";else if(!i&&m&&G.startsWith(v,"G"))N="treble";else return{len:h+5,warn:"Unknown clef specified: "+s};return v=v.substring(N.length),w=this.isMatch(v,"+8"),w>0?N+="+8":(w=this.isMatch(v,"-8"),w>0&&(N+="-8")),{len:h+N.length,token:N,explicit:m}},this.getBarLine=function(a,i){switch(a[i]){case"]":switch(++i,a[i]){case"|":return{len:2,token:"bar_thick_thin"};case"[":return++i,a[i]>="1"&&a[i]<="9"||a[i]==='"'?{len:2,token:"bar_invisible"}:{len:1,warn:"Unknown bar symbol"};default:return{len:1,token:"bar_invisible"}}break;case":":switch(++i,a[i]){case":":return{len:2,token:"bar_dbl_repeat"};case"|":switch(++i,a[i]){case"]":switch(++i,a[i]){case"|":return++i,a[i]===":"?{len:5,token:"bar_dbl_repeat"}:{len:3,token:"bar_right_repeat"};default:return{len:3,token:"bar_right_repeat"}}break;case"|":return++i,a[i]===":"?{len:4,token:"bar_dbl_repeat"}:{len:3,token:"bar_right_repeat"};default:return{len:2,token:"bar_right_repeat"}}break;default:return{len:1,warn:"Unknown bar symbol"}}break;case"[":if(++i,a[i]==="|")switch(++i,a[i]){case":":return{len:3,token:"bar_left_repeat"};case"]":return{len:3,token:"bar_invisible"};default:return{len:2,token:"bar_thick_thin"}}else return a[i]>="1"&&a[i]<="9"||a[i]==='"'?{len:1,token:"bar_invisible"}:{len:0};break;case"|":switch(++i,a[i]){case"]":return{len:2,token:"bar_thin_thick"};case"|":return++i,a[i]===":"?{len:3,token:"bar_left_repeat"}:{len:2,token:"bar_thin_thin"};case":":for(var s=0;a[i+s]===":";)s++;return{len:1+s,token:"bar_left_repeat"};default:return{len:1,token:"bar_thin"}}break}return{len:0}},this.getTokenOf=function(a,i){for(var s=0;s<a.length;s++)if(i.indexOf(a[s])<0)return{len:s,token:a.substring(0,s)};return{len:s,token:a}},this.getToken=function(a,i,s){for(var h=i;h<s&&!this.isWhiteSpace(a[h]);)h++;return a.substring(i,h)},this.isMatch=function(a,i){var s=this.skipWhiteSpace(a);return r(a,s)?0:G.startsWith(a.substring(s),i)?s+i.length:0},this.getPitchFromTokens=function(a){var i={},s={A:5,B:6,C:0,D:1,E:2,F:3,G:4,a:12,b:13,c:7,d:8,e:9,f:10,g:11};if(i.position=s[a[0].token],i.position===void 0)return{warn:"Pitch expected. Found: "+a[0].token};for(a.shift();a.length;)switch(a[0].token){case",":i.position-=7,a.shift();break;case"'":i.position+=7,a.shift();break;default:return i}return i},this.getKeyAccidentals2=function(a){for(var i;a.length>0;){var s;if(a[0].token==="^"){if(s="sharp",a.shift(),a.length===0)return{accs:i,warn:"Expected note name after "+s};switch(a[0].token){case"^":s="dblsharp",a.shift();break;case"/":s="quartersharp",a.shift();break}}else if(a[0].token==="=")s="natural",a.shift();else if(a[0].token==="_"){if(s="flat",a.shift(),a.length===0)return{accs:i,warn:"Expected note name after "+s};switch(a[0].token){case"_":s="dblflat",a.shift();break;case"/":s="quarterflat",a.shift();break}}else return{accs:i};if(a.length===0)return{accs:i,warn:"Expected note name after "+s};switch(a[0].token[0]){case"a":case"b":case"c":case"d":case"e":case"f":case"g":case"A":case"B":case"C":case"D":case"E":case"F":case"G":i===void 0&&(i=[]),i.push({acc:s,note:a[0].token[0]}),a[0].token.length===1?a.shift():a[0].token=a[0].token.substring(1);break;default:return{accs:i,warn:"Expected note name after "+s+" Found: "+a[0].token}}}return{accs:i}},this.getKeyAccidental=function(a){var i={"^":"sharp","^^":"dblsharp","=":"natural",_:"flat",__:"dblflat","_/":"quarterflat","^/":"quartersharp"},s=this.skipWhiteSpace(a);if(r(a,s))return{len:0};var h=null;switch(a[s]){case"^":case"_":case"=":h=a[s];break;default:return{len:0}}if(s++,r(a,s))return{len:1,warn:"Expected note name after accidental"};switch(a[s]){case"a":case"b":case"c":case"d":case"e":case"f":case"g":case"A":case"B":case"C":case"D":case"E":case"F":case"G":return{len:s+1,token:{acc:i[h],note:a[s]}};case"^":case"_":case"/":if(h+=a[s],s++,r(a,s))return{len:2,warn:"Expected note name after accidental"};switch(a[s]){case"a":case"b":case"c":case"d":case"e":case"f":case"g":case"A":case"B":case"C":case"D":case"E":case"F":case"G":return{len:s+1,token:{acc:i[h],note:a[s]}};default:return{len:2,warn:"Expected note name after accidental"}}break;default:return{len:1,warn:"Expected note name after accidental"}}},this.isWhiteSpace=function(a){return a===" "||a==="	"||a===""},this.getMeat=function(a,i,s){var h=a.indexOf("%",i);for(h>=0&&h<s&&(s=h);i<s&&(a[i]===" "||a[i]==="	"||a[i]==="");)i++;for(;i<s&&(a[s-1]===" "||a[s-1]==="	"||a[s-1]==="");)s--;return{start:i,end:s}};var u=function(a){return a>="A"&&a<="Z"||a>="a"&&a<="z"},l=function(a){return a>="0"&&a<="9"};this.tokenize=function(a,i,s,h){var m=this.getMeat(a,i,s);i=m.start,s=m.end;for(var v=[],w;i<s;){if(a[i]==='"'){for(w=i+1;w<s&&a[w]!=='"';)w++;v.push({type:"quote",token:a.substring(i+1,w),start:i+1,end:w}),w++}else if(u(a[i])){if(w=i+1,h)for(;w<s&&!this.isWhiteSpace(a[w]);)w++;else for(;w<s&&u(a[w]);)w++;v.push({type:"alpha",token:a.substring(i,w),continueId:l(a[w]),start:i,end:w}),i=w+1}else if(a[i]==="."&&l(a[w+1])){w=i+1;for(var N=null,L=null;w<s&&l(a[w]);)w++;L=parseFloat(a.substring(i,w)),v.push({type:"number",token:a.substring(i,w),intt:N,floatt:L,continueId:u(a[w]),start:i,end:w}),i=w+1}else if(l(a[i])||a[i]==="-"&&l(a[w+1])){w=i+1;for(var x=null,g=null;w<s&&l(a[w]);)w++;if(a[w]==="."&&l(a[w+1]))for(w++;w<s&&l(a[w]);)w++;else x=parseInt(a.substring(i,w));g=parseFloat(a.substring(i,w)),v.push({type:"number",token:a.substring(i,w),intt:x,floatt:g,continueId:u(a[w]),start:i,end:w}),i=w+1}else a[i]===" "||a[i]==="	"||v.push({type:"punct",token:a[i],start:i,end:i+1}),w=i+1;i=w}return v},this.getVoiceToken=function(a,i,s){for(var h=i;h<s&&this.isWhiteSpace(a[h])||a[h]==="=";)h++;if(a[h]==='"'){var m=a.indexOf('"',h+1);return m===-1||m>=s?{len:1,err:"Missing close quote"}:{len:m-i+1,token:this.translateString(a.substring(h+1,m))}}else{for(var v=h;v<s&&!this.isWhiteSpace(a[v])&&a[v]!=="=";)v++;return{len:v-i+1,token:a.substring(h,v)}}};var d={"`a":"à","'a":"á","^a":"â","~a":"ã",'"a':"ä",oa:"å",aa:"å","=a":"ā",ua:"ă",";a":"ą","`e":"è","'e":"é","^e":"ê",'"e':"ë","=e":"ē",ue:"ĕ",";e":"ę",".e":"ė","`i":"ì","'i":"í","^i":"î",'"i':"ï","=i":"ī",ui:"ĭ",";i":"į","`o":"ò","'o":"ó","^o":"ô","~o":"õ",'"o':"ö","=o":"ō",uo:"ŏ","/o":"ø","`u":"ù","'u":"ú","^u":"û","~u":"ũ",'"u':"ü",ou:"ů","=u":"ū",uu:"ŭ",";u":"ų","`A":"À","'A":"Á","^A":"Â","~A":"Ã",'"A':"Ä",oA:"Å",AA:"Å","=A":"Ā",uA:"Ă",";A":"Ą","`E":"È","'E":"É","^E":"Ê",'"E':"Ë","=E":"Ē",uE:"Ĕ",";E":"Ę",".E":"Ė","`I":"Ì","'I":"Í","^I":"Î","~I":"Ĩ",'"I':"Ï","=I":"Ī",uI:"Ĭ",";I":"Į",".I":"İ","`O":"Ò","'O":"Ó","^O":"Ô","~O":"Õ",'"O':"Ö","=O":"Ō",uO:"Ŏ","/O":"Ø","`U":"Ù","'U":"Ú","^U":"Û","~U":"Ũ",'"U':"Ü",oU:"Ů","=U":"Ū",uU:"Ŭ",";U":"Ų",ae:"æ",AE:"Æ",oe:"œ",OE:"Œ",ss:"ß","'c":"ć","^c":"ĉ",uc:"č",cc:"ç",".c":"ċ",cC:"Ç","'C":"Ć","^C":"Ĉ",uC:"Č",".C":"Ċ","~N":"Ñ","~n":"ñ","=s":"š",vs:"š",DH:"Ð",dh:"ð",HO:"Ő",Ho:"ő",HU:"Ű",Hu:"ű","'Y":"Ý","'y":"ý","^Y":"Ŷ","^y":"ŷ",'"Y':"Ÿ",'"y':"ÿ",vS:"Š",vZ:"Ž",vz:"ž"},f={"#":"♯",b:"♭","=":"♮"},n={201:"♯",202:"♭",203:"♮",241:"¡",242:"¢",252:"a",262:"2",272:"o",302:"Â",312:"Ê",322:"Ò",332:"Ú",342:"â",352:"ê",362:"ò",372:"ú",243:"£",253:"«",263:"3",273:"»",303:"Ã",313:"Ë",323:"Ó",333:"Û",343:"ã",353:"ë",363:"ó",373:"û",244:"¤",254:"¬",264:"  ́",274:"1⁄4",304:"Ä",314:"Ì",324:"Ô",334:"Ü",344:"ä",354:"ì",364:"ô",374:"ü",245:"¥",255:"-",265:"μ",275:"1⁄2",305:"Å",315:"Í",325:"Õ",335:"Ý",345:"å",355:"í",365:"õ",375:"ý",246:"¦",256:"®",266:"¶",276:"3⁄4",306:"Æ",316:"Î",326:"Ö",336:"Þ",346:"æ",356:"î",366:"ö",376:"þ",247:"§",257:" ̄",267:"·",277:"¿",307:"Ç",317:"Ï",327:"×",337:"ß",347:"ç",357:"ï",367:"÷",377:"ÿ",250:" ̈",260:"°",270:" ̧",300:"À",310:"È",320:"Ð",330:"Ø",340:"à",350:"è",360:"ð",370:"ø",251:"©",261:"±",271:"1",301:"Á",311:"É",321:"Ñ",331:"Ù",341:"á",351:"é",361:"ñ",371:"ù"};this.translateString=function(a){var i=a.split("\\");if(i.length===1)return a;var s=null;return i.forEach(function(h){if(s===null)s=h;else{var m=d[h.substring(0,2)];m!==void 0?s+=m+h.substring(2):(m=n[h.substring(0,3)],m!==void 0?s+=m+h.substring(3):(m=f[h.substring(0,1)],m!==void 0?s+=m+h.substring(1):s+="\\"+h))}}),s},this.getNumber=function(a,i){for(var s=0;i<a.length;)switch(a[i]){case"0":s=s*10,i++;break;case"1":s=s*10+1,i++;break;case"2":s=s*10+2,i++;break;case"3":s=s*10+3,i++;break;case"4":s=s*10+4,i++;break;case"5":s=s*10+5,i++;break;case"6":s=s*10+6,i++;break;case"7":s=s*10+7,i++;break;case"8":s=s*10+8,i++;break;case"9":s=s*10+9,i++;break;default:return{num:s,index:i}}return{num:s,index:i}},this.getFraction=function(a,i){var s=1,h=1;if(a[i]!=="/"){var m=this.getNumber(a,i);s=m.num,i=m.index}if(a[i]==="/")if(i++,a[i]==="/"){for(var v=.5;a[i++]==="/";)v=v/2;return{value:s*v,index:i-1}}else{var w=i,N=this.getNumber(a,i);N.num===0&&w===i&&(N.num=2),N.num!==0&&(h=N.num),i=N.index}return{value:s/h,index:i}};function o(a){let s=/^(\d+)\./.exec(a);return s?s[1]:null}var c=[{match:/,\s*[Tt]he$/,replace:"The "},{match:/,\s*[Aa]$/,replace:"A "},{match:/,\s*[Aa]n$/,replace:"An "}];this.theReverser=function(a){for(var i=0;i<c.length;i++){var s=c[i],h=a.match(s.match);if(h){var m=o(a);m&&(a=a.replace(m+".",""),a=a.trim());var v=h[0].length,w=s.replace+a.substring(0,a.length-v);return m&&(w=m+". "+w),w}}return a},this.stripComment=function(a){var i=a.indexOf("%");return i>=0?G.strip(a.substring(0,i)):G.strip(a)},this.getInt=function(a){var i=parseInt(a);if(isNaN(i))return{digits:0};var s=""+i,h=a.indexOf(s);return{value:i,digits:h+s.length}},this.getFloat=function(a){var i=parseFloat(a);if(isNaN(i))return{digits:0};var s=""+i,h=a.indexOf(s);return{value:i,digits:h+s.length}},this.getMeasurement=function(a){if(a.length===0)return{used:0};var i=1,s="";if(a[0].token==="-")a.shift(),s="-",i++;else if(a[0].type!=="number")return{used:0};if(s+=a.shift().token,a.length===0)return{used:1,value:parseInt(s)};var h=a.shift();if(h.token==="."){if(i++,a.length===0)return{used:i,value:parseInt(s)};if(a[0].type==="number"&&(h=a.shift(),s=s+"."+h.token,i++,a.length===0))return{used:i,value:parseFloat(s)};h=a.shift()}switch(h.token){case"pt":return{used:i+1,value:parseFloat(s)};case"px":return{used:i+1,value:parseFloat(s)};case"cm":return{used:i+1,value:parseFloat(s)/2.54*72};case"in":return{used:i+1,value:parseFloat(s)*72};default:return a.unshift(h),{used:i,value:parseFloat(s)}}};var p=function(a){return a=a.replace(/\\n/g,`
`),a=a.replace(/\\"/g,'"'),a};this.getBrackettedSubstring=function(a,i,s,h){for(var m=h||a[i],v=i+1,w=!1;v<a.length&&(w||a[v]!==m);)w=a[v]==="\\",++v;return a[v]===m?[v-i+1,p(a.substring(i+1,v)),!0]:(v=i+s,v>a.length-1&&(v=a.length-1),[v-i+1,p(a.substring(i+1,v)),!1])}};kr.prototype.peekLine=function(){return this.lines[this.lineIndex]};kr.prototype.nextLine=function(){if(this.lineIndex>0&&(this.multilineVars.iChar+=this.lines[this.lineIndex-1].length+1),this.lineIndex<this.lines.length){var e=this.lines[this.lineIndex];return this.lineIndex++,e}return null};var za=kr;function qi(e,t,r){if(!(!t||e.lines.length===0)){var u=e.deline({lineBreaks:!1}),l=$i(u,t);e.lines=Ri(u,l,r),e.lineBreaks=l}}function Ri(e,t,r){for(var u=[],l=[],d=[],f=1,n=0;n<t.length;n++){var o=t[n];if(e[o.ogLine].staff){var c=e[o.ogLine].staff[o.staff];if(u[o.line]||(u[o.line]={staff:[]}),!u[o.line].staff[o.staff]){u[o.line].staff[o.staff]={voices:[]},r!==void 0&&o.staff===0&&o.line>0&&(u[o.line].staff[o.staff].barNumber=f);for(var p=Object.keys(c),a=0;a<p.length;a++){var i=p[a]==="voices";p[a]==="meter"&&o.line!==0&&(i=!0),i||(u[o.line].staff[o.staff][p[a]]=c[p[a]])}l[o.staff]&&(u[o.line].staff[o.staff].key=l[o.staff])}u[o.line].staff[o.staff].voices[o.voice]||(u[o.line].staff[o.staff].voices[o.voice]=[]),u[o.line].staff[o.staff].voices[o.voice]=e[o.ogLine].staff[o.staff].voices[o.voice].slice(o.start,o.end+1),d[o.staff*10+o.voice]&&u[o.line].staff[o.staff].voices[o.voice].unshift({el_type:"stem",direction:d[o.staff*10+o.voice].direction});for(var s=u[o.line].staff[o.staff].voices[o.voice],h=s.length-1;h>=0;h--)if(s[h].el_type==="key"){l[o.staff]={root:s[h].root,acc:s[h].acc,mode:s[h].mode,accidentals:s[h].accidentals.filter(function(v){return v.acc!=="natural"})};break}for(h=s.length-1;h>=0;h--)if(s[h].el_type==="stem"){d[o.staff*10+o.voice]={direction:s[h].direction};break}if(r!==void 0&&o.staff===0&&o.voice===0)for(h=0;h<s.length;h++)s[h].el_type==="bar"&&(f++,h===s.length-1?delete s[h].barNumber:s[h].barNumber=f)}else u[o.line]=e[o.ogLine]}for(var m=0;m<u.length;m++)u[m].staff&&(u[m].staff=u[m].staff.filter(function(v){return v!=null}));return u}function $i(e,t){for(var r=[],u=0,l=0,d=0,f=0;f<e.length;f++){var n=e[f];if(n.staff){var o=l,c=t[u];u++;for(var p=0;p<n.staff.length;p++)for(var a=n.staff[p],i=0;i<a.voices.length;i++){d=o;for(var s=0,h=0,m=a.voices[i],v=0,w=0;w<m.length;w++){var N=m[w];N.el_type==="bar"&&(c[h]===s&&(r.push({ogLine:f,line:d,staff:p,voice:i,start:v,end:w}),v=w+1,d++,l=Math.max(l,d),h++),s++)}r.push({ogLine:f,line:d,staff:p,voice:i,start:v,end:m.length}),d++,l=Math.max(l,d)}}else r.push({ogLine:f,line:d}),d++,l=Math.max(l,d)}return r}function Hi(e,t){for(var r=[],u=[],l=0,d=0;d<e.length;d++){var f=e[d],n=l+f;if(n<t)l=n;else{var o=t-l,c=n-t;o<c&&l>0?(r.push(d-1),u.push(Math.round(l-f)),l=f):d<e.length-1&&(r.push(d),u.push(Math.round(l)),l=0)}}return u.push(Math.round(l)),{lineBreaks:r,totals:u}}function Gt(e){for(var t=[],r=0;r<e.length;r++)t.push(e[r]);return t}function Wi(e,t,r,u,l,d,f,n,o,c,p){for(var a=c;a<e.length;a++){var i=e[a];r+=i,u+=i;var s=Math.abs(r-t[n]),h=Math.abs(s-d)<t[0]/10;if(h)if(s<d){var m=Gt(l),v=Gt(o);v.push(a-1),m.push(u-i),p.push({accumulator:r,lineAccumulator:i,lineWidths:m,lastVariance:Math.abs(r-t[n+1]),highestVariance:Math.max(f,d),currLine:n+1,lineBreaks:v,startIndex:a+1})}else s>d&&a<e.length-1&&(m=Gt(l),v=Gt(o),p.push({accumulator:r,lineAccumulator:u,lineWidths:m,lastVariance:s,highestVariance:Math.max(f,s),currLine:n,lineBreaks:v,startIndex:a+1}));s>d?(o.push(a-1),n++,f=Math.max(f,d),d=Math.abs(r-t[n]),l.push(u-i),u=i):d=s}l.push(u)}function Ui(e,t,r,u){for(var l=Math.ceil(e.total/t),d=Math.floor(e.total/l),f=[],n=0;n<l;n++)f.push(d*(n+1));var o=[];o.push({accumulator:0,lineAccumulator:0,lineWidths:[],lastVariance:999999,highestVariance:0,currLine:0,lineBreaks:[],startIndex:0});for(var c=0;c<o.length;)Wi(e.measureWidths,f,o[c].accumulator,o[c].lineAccumulator,o[c].lineWidths,o[c].lastVariance,o[c].highestVariance,o[c].currLine,o[c].lineBreaks,o[c].startIndex,o),c++;for(n=0;n<o.length;n++){var p=o[n];p.variances=[],p.aveVariance=0;for(var a=0;a<p.lineWidths.length;a++){var i=p.lineWidths[a];p.variances.push(i-f[0]),p.aveVariance+=Math.abs(i-f[0])}p.aveVariance=p.aveVariance/p.lineWidths.length,u.attempts.push({type:"optimizeLineWidths",lineBreaks:p.lineBreaks,variances:p.variances,aveVariance:p.aveVariance,widths:e.measureWidths})}var s=9999999,h=-1;for(n=0;n<o.length;n++)p=o[n],p.aveVariance<s&&(s=p.aveVariance,h=n);return{failed:!1,lineBreaks:o[h].lineBreaks,variance:o[h].highestVariance}}function Ki(e,t,r){for(var u=[],l=[],d=0,f=!1,n=0;n<e.length;n++)d+=e[n],d>t&&(f=!0),n%r===r-1&&(n!==e.length-1&&u.push(n),l.push(Math.round(d)),d=0);return{failed:f,totals:l,lineBreaks:u}}function Qi(e,t,r){var u={lineBreaks:e,staffwidth:t};for(var l in r)r.hasOwnProperty(l)&&l!=="wrap"&&l!=="staffwidth"&&(u[l]=r[l]);return{revisedParams:u}}function Xi(e,t,r){if(t.length===0||r.staffwidth<t[0].left)return{reParse:!1,explanation:"Staff width is narrower than the margin",revisedParams:r};var u=r.scale?Math.max(r.scale,.1):1,l=r.wrap.minSpacing?Math.max(parseFloat(r.wrap.minSpacing),1):1,d=r.wrap.minSpacingLimit?Math.max(parseFloat(r.wrap.minSpacingLimit),1):l-.1,f=r.wrap.maxSpacing?Math.max(parseFloat(r.wrap.maxSpacing),1):void 0;r.wrap.lastLineLimit&&!f&&(f=Math.max(parseFloat(r.wrap.lastLineLimit),1));for(var n=r.wrap.preferredMeasuresPerLine?Math.max(parseInt(r.wrap.preferredMeasuresPerLine,10),0):void 0,o=[],c=[],p=0;p<t.length;p++){var a=t[p],i=r.staffwidth-a.left,s=i/l/u,h=i/f/u,m=i/d/u,v={widths:a,lineBreakPoint:s,minLineSize:h,attempts:[],staffWidth:r.staffwidth,minWidth:Math.round(m)},w=null;if(n){var N=Ki(a.measureWidths,s,n);v.attempts.push({type:"Fixed Measures Per Line",preferredMeasuresPerLine:n,lineBreaks:N.lineBreaks,failed:N.failed,totals:N.totals}),N.failed||(w=N.lineBreaks)}if(!w){var L=Hi(a.measureWidths,s);v.attempts.push({type:"Free Form",lineBreaks:L.lineBreaks,totals:L.totals}),w=L.lineBreaks,w.length>0&&a.measureWidths.length<25&&(L=Ui(a,s,w,v),v.attempts.push({type:"Optimize",failed:L.failed,reason:L.reason,lineBreaks:L.lineBreaks,totals:L.totals}),L.failed||(w=L.lineBreaks))}o.push(w),c.push(v)}var x=r.staffwidth,g=Qi(o,x,r);return g.explanation=c,g.reParse=!0,g}var qa={wrapLines:qi,calcLineWraps:Xi};var Te={};Te.FONTEM=360;Te.FONTSIZE=30;Te.STEP=Te.FONTSIZE*93/720;Te.SPACE=10;Te.TOPNOTE=15;Te.STAVEHEIGHT=100;Te.INDENT=50;var Nr=Te;function _r(e,t){t||(t={});for(var r=!!t.lineBreaks,u=[],l=!1,d=[],f=[],n=[],o=[],c=[],p=[],a=[],i=0;i<e.length;i++){var s=e[i];if(s.staff){if(l&&!s.vskip)for(var h=u[u.length-1],m=0;m<h.staff.length;m++){var v=s.staff[m],w=h.staff[m];if(v&&(qe(v.meter,d[m])||(Zi(v.meter,v.voices),d[m]=v.meter,delete v.meter),qe(v.key,f[m])||(Yi(v.key,v.voices),f[m]=v.key,delete v.key),v.title&&(w.abbrevTitle=v.title),qe(v.clef,n[m])||(Ji(v.clef,v.voices),n[m]=v.clef,delete v.clef),qe(v.vocalfont,o[m])||(zt(v.vocalfont,v.voices,"vocalfont"),o[m]=v.vocalfont,delete v.vocalfont),qe(v.gchordfont,c[m])||(zt(v.gchordfont,v.voices,"gchordfont"),c[m]=v.gchordfont,delete v.gchordfont),qe(v.tripletfont,p[m])||(zt(v.tripletfont,v.voices,"tripletfont"),p[m]=v.tripletfont,delete v.tripletfont),qe(v.annotationfont,a[m])||(zt(v.annotationfont,v.voices,"annotationfont"),a[m]=v.annotationfont,delete v.annotationfont)),v)for(var N=0;N<w.voices.length;N++){var L=w.voices[N],x=v.voices[N];r&&L.push({el_type:"break"}),x&&(w.voices[N]=L.concat(x))}}else{for(var g=0;g<s.staff.length;g++)f[g]=s.staff[g].key,d[g]=s.staff[g].meter,n[g]=s.staff[g].clef;u.push(ji(s))}l=!0}else l=!1,u.push(s)}return u}function Ra(e,t){return e==="abselem"?"abselem":t}function Zi(e,t){e.el_type="meter",e.startChar=-1,e.endChar=-1;for(var r=0;r<t.length;r++)t[r].unshift(e)}function Yi(e,t){e.el_type="key",e.startChar=-1,e.endChar=-1;for(var r=0;r<t.length;r++)t[r].unshift(e)}function Ji(e,t){e.el_type="clef",e.startChar=-1,e.endChar=-1;for(var r=0;r<t.length;r++)t[r].unshift(e)}function zt(e,t,r){e.el_type="font",e.type=r,e.startChar=-1,e.endChar=-1;for(var u=0;u<t.length;u++)t[u].unshift(e)}function qe(e,t){if(!e)return!0;var r=JSON.stringify(e,Ra),u=JSON.stringify(t,Ra);return r===u}function ji(e){for(var t={},r=Object.keys(e),u=0;u<r.length;u++)if(r[u]!=="staff")t[r[u]]=e[r[u]];else{t.staff=[];for(var l=0;l<e.staff.length;l++){for(var d={},f=Object.keys(e.staff[l]),n=0;n<f.length;n++)if(f[n]!=="voices")d[f[n]]=e.staff[l][f[n]];else{d.voices=[];for(var o=0;o<e.staff[l].voices.length;o++)d.voices.push([].concat(e.staff[l].voices[o]))}t.staff.push(d)}}return t}function Tr(){this.reset=function(){this.version="1.1.0",this.media="screen",this.metaText={},this.metaTextInfo={},this.formatting={},this.lines=[],this.staffNum=0,this.voiceNum=0,this.lineNum=0,this.runningFonts={},delete this.visualTranspose},this.reset();function e(f,n,o,c){for(var p=0;p<c.length;p++)f[o][c[p]]=n[o][c[p]]}this.copyTopInfo=function(f){var n=["tempo","title","header","rhythm","origin","composer","author","partOrder"];e(this,f,"metaText",n),e(this,f,"metaTextInfo",n)},this.copyBottomInfo=function(f){var n=["unalignedWords","book","source","discography","notes","transcription","history","abc-copyright","abc-creator","abc-edited-by","footer"];e(this,f,"metaText",n),e(this,f,"metaTextInfo",n)},this.getBeatLength=function(){var f=this.getMeterFraction(),n=1;return(f.num===6||f.num===9||f.num===12||f.num===3&&f.den===8)&&(n=3),n/f.den};function t(f,n){for(var o=0,c=0;c<f.length;c++)if(f[c].staff)for(var p=0;p<f[c].staff.length;p++)for(var a=0;a<f[c].staff[p].voices.length;a++)for(var i=f[c].staff[p].voices[a],s=1,h=0;h<i.length;h++){var m=i[h].rest&&i[h].rest.type==="spacer";if(i[h].startTriplet&&(s=i[h].tripletMultiplier),i[h].duration&&!m&&i[h].el_type!=="tempo"&&(o+=i[h].duration*s),i[h].endTriplet&&(s=1),o>=n&&(o-=n),i[h].el_type==="bar")return o}return o}this.getPickupLength=function(){var f=this.getBarLength(),n=t(this.lines,f);return n<1e-8||f-n<1e-8?0:n},this.getBarLength=function(){var f=this.getMeterFraction();return f.num/f.den},this.getTotalTime=function(){return this.totalTime},this.getTotalBeats=function(){return this.totalBeats},this.millisecondsPerMeasure=function(f){var n;if(f)n=f;else{var o=this.metaText?this.metaText.tempo:null;n=this.getBpm(o)}n<=0&&(n=1);var c=this.getBeatsPerMeasure(),p=c/n;return p*6e4},this.getBeatsPerMeasure=function(){var f=this.getBeatLength(),n=this.getBarLength();return n/f},this.getMeter=function(){for(var f=0;f<this.lines.length;f++){var n=this.lines[f];if(n.staff)for(var o=0;o<n.staff.length;o++){var c=n.staff[o].meter;if(c)return c}}return{type:"common_time"}},this.getMeterFraction=function(){var f=this.getMeter(),n=4,o=4;return f&&(f.type==="specified"?(n=parseInt(f.value[0].num,10),o=parseInt(f.value[0].den,10)):f.type==="cut_time"?(n=2,o=2):f.type==="common_time"&&(n=4,o=4)),this.meter={num:n,den:o},this.meter},this.getKeySignature=function(){for(var f=0;f<this.lines.length;f++){var n=this.lines[f];if(n.staff){for(var o=0;o<n.staff.length;o++)if(n.staff[o].key)return n.staff[o].key}}return{}},this.getElementFromChar=function(f){for(var n=0;n<this.lines.length;n++){var o=this.lines[n];if(o.staff)for(var c=0;c<o.staff.length;c++)for(var p=o.staff[c],a=0;a<p.voices.length;a++)for(var i=p.voices[a],s=0;s<i.length;s++){var h=i[s];if(h.startChar&&h.endChar&&h.startChar<=f&&h.endChar>f)return h}}return null};function r(f){for(var n,o,c,p,a=f.length-1;a>=0;a--){var i=f[a];i.type==="bar"?(i.top=c,i.nextTop=n,n=c,i.bottom=p,i.nextBottom=o,o=p):i.type==="event"&&(c=i.top,p=i.top+i.height)}}function u(f){var n=[];for(var o in f)f.hasOwnProperty(o)&&n.push(f[o]);return n=n.sort(function(c,p){var a=c.milliseconds-p.milliseconds;return a!==0?a:c.type==="bar"?-1:1}),n}this.addElementToEvents=function(f,n,o,c,p,a,i,s,h,m){if(n.hint)return{isTiedState:void 0,duration:0};var v=n.durationClass?n.durationClass:n.duration;if(n.abcelem.rest&&n.abcelem.rest.type==="spacer"&&(v=0),v>0){for(var w=[],N=0;N<n.elemset.length;N++)n.elemset[N]!==null&&w.push(n.elemset[N]);var L=n.startTie;if(h!==void 0)f["event"+h].elements.push(w),m&&(f["event"+o]||(f["event"+o]={type:"event",milliseconds:o,line:a,measureNumber:i,top:c,height:p,left:null,width:0,elements:[],startChar:null,endChar:null,startCharArray:[],endCharArray:[]}),f["event"+o].measureStart=!0,m=!1),L||(h=void 0);else{if(!f["event"+o])f["event"+o]={type:"event",milliseconds:o,line:a,measureNumber:i,top:c,height:p,left:n.x,width:n.w,elements:[w],startChar:n.abcelem.startChar,endChar:n.abcelem.endChar,startCharArray:[n.abcelem.startChar],endCharArray:[n.abcelem.endChar],midiPitches:n.abcelem.midiPitches?G.cloneArray(n.abcelem.midiPitches):[]},n.abcelem.midiGraceNotePitches&&(f["event"+o].midiGraceNotePitches=G.cloneArray(n.abcelem.midiGraceNotePitches));else{if(f["event"+o].left?f["event"+o].left=Math.min(f["event"+o].left,n.x):f["event"+o].left=n.x,f["event"+o].elements.push(w),f["event"+o].startCharArray.push(n.abcelem.startChar),f["event"+o].endCharArray.push(n.abcelem.endChar),f["event"+o].startChar===null&&(f["event"+o].startChar=n.abcelem.startChar),f["event"+o].endChar===null&&(f["event"+o].endChar=n.abcelem.endChar),n.abcelem.midiPitches&&n.abcelem.midiPitches.length){f["event"+o].midiPitches||(f["event"+o].midiPitches=[]);for(var N=0;N<n.abcelem.midiPitches.length;N++)f["event"+o].midiPitches.push(n.abcelem.midiPitches[N])}if(n.abcelem.midiGraceNotePitches&&n.abcelem.midiGraceNotePitches.length){f["event"+o].midiGraceNotePitches||(f["event"+o].midiGraceNotePitches=[]);for(var x=0;x<n.abcelem.midiGraceNotePitches.length;x++)f["event"+o].midiGraceNotePitches.push(n.abcelem.midiGraceNotePitches[x])}}m&&(f["event"+o].measureStart=!0,m=!1),L&&(h=o)}}return{isTiedState:h,duration:v/s,nextIsBar:m||n.type==="bar"}},this.makeVoicesArray=function(){for(var f=[],n=[],o={},c=0;c<this.engraver.staffgroups.length;c++){var p=this.engraver.staffgroups[c];if(p&&p.staffs&&p.staffs.length>0){var a=p.staffs[0],i=a.absoluteY,s=i-a.top*Nr.STEP,h=p.staffs[p.staffs.length-1];i=h.absoluteY;for(var m=i-h.bottom*Nr.STEP,v=m-s,w=p.voices,N=0;N<w.length;N++)if(!(w[N].staff&&w[N].staff.isTabStaff)){var L=!1;f[N]||(f[N]=[]),n[N]===void 0&&(n[N]=0);for(var x=w[N].children,g=0;g<x.length;g++)x[g].type==="tempo"&&(o[n[N]]=this.getBpm(x[g].abcelem)),f[N].push({top:s,height:v,line:p.line,measureNumber:n[N],elem:x[g]}),x[g].type==="bar"&&L&&n[N]++,(x[g].type==="note"||x[g].type==="rest")&&(L=!0)}}}return this.tempoLocations=o,f},this.setupEvents=function(f,n,o,c){c||(c=1);for(var p=[],a={},i=f,s,h=!0,m=this.makeVoicesArray(),v=0,w=0;w<m.length;w++){var N=i,L=Math.round(N*1e3),x=0,g=-1,k=m[w],D=o;n=this.getBeatLength()*D/60;for(var P=-1,A=0;A<k.length;A++){var S=k[A].measureNumber;P!==S&&this.tempoLocations[S]&&(D=this.tempoLocations[S],n=c*this.getBeatLength()*D/60,P=S);var M=k[A].elem,B=this.addElementToEvents(a,M,L,k[A].top,k[A].height,k[A].line,k[A].measureNumber,n,s,h);s=B.isTiedState,h=B.nextIsBar,N+=B.duration;var I;if(M.duration>0&&a["event"+L]&&(I="event"+L),L=Math.round(N*1e3),M.type==="bar"){var z=M.abcelem.type,O=z==="bar_right_repeat"||z==="bar_dbl_repeat",y=M.abcelem.startEnding==="1",b=z==="bar_left_repeat"||z==="bar_dbl_repeat"||z==="bar_right_repeat";if(O){A>0&&(a[I].endX=M.x),g===-1&&(g=A);var _=0;P=-1;for(var E=x;E<g;E++){S=k[E].measureNumber,P!==S&&this.tempoLocations[S]&&(D=this.tempoLocations[S],n=c*this.getBeatLength()*D/60,P=S);var F=k[E].elem;B=this.addElementToEvents(a,F,L,k[E].top,k[E].height,k[E].line,k[E].measureNumber,n,s,h),s=B.isTiedState,h=B.nextIsBar,N+=B.duration,_=L,L=Math.round(N*1e3)}a["event"+_]&&(a["event"+_].endX=k[g].elem.x),h=!0,g=-1}y&&(g=A),b&&(x=A)}}v=Math.max(v,L)}return p=u(a),r(p),d(this.lines,p),p.push({type:"end",milliseconds:v}),this.addUsefulCallbackInfo(p,D*c),p},this.addUsefulCallbackInfo=function(f,n){for(var o=this.millisecondsPerMeasure(n),c=0;c<f.length;c++){var p=f[c];p.millisecondsPerMeasure=o}};function l(f,n){for(;n<f.length&&f[n].left===null;)n++;return f[n]}function d(f,n){if(!(n.length<1)){for(var o=0;o<n.length-1;o++){var c=n[o],p=l(n,o+1);if(c.left!==null){var a=p&&c.top===p.top?p.left:f[c.line].staffGroup.w;c.endX!==void 0?a>c.left&&(c.endX=Math.min(c.endX,a)):c.endX=a}}var i=n[n.length-1];i.endX=f[i.line].staffGroup.w}}this.getBpm=function(f){var n;if(f){n=f.bpm;var o=this.getBeatLength(),c=f.duration&&f.duration.length>0?f.duration[0]:o;n=n*c/o}if(!n){n=180;var p=this.getMeterFraction();p&&p.num!==3&&p.num%3===0&&(n=120)}return n},this.setTiming=function(f,n){if(n=n||0,!this.engraver||!this.engraver.staffgroups)return console.log("setTiming cannot be called before the tune is drawn."),this.noteTimings=[],this.noteTimings;var o=this.metaText?this.metaText.tempo:null,c=this.getBpm(o),p=1;f?o&&(p=f/c):f=c;var a=this.getBeatLength(),i=f/60,s=this.getBarLength(),h=s/a*n/i;h&&(h-=this.getPickupLength()/a/i);var m=a*i;return this.noteTimings=this.setupEvents(h,m,f,p),this.noteTimings.length>0?(this.totalTime=this.noteTimings[this.noteTimings.length-1].milliseconds/1e3,this.totalBeats=this.totalTime*i):(this.totalTime=void 0,this.totalBeats=void 0),this.noteTimings},this.setUpAudio=function(f){console.log("NEUTERED")},this.deline=function(f){return _r(this.lines,f)}}var Vi=function(e){var t=this;this.setVisualTranspose=function(l){l&&(e.visualTranspose=l)},this.resolveOverlays=function(){for(var l=!1,d=[],f=0;f<e.lines.length;f++){var n=e.lines[f];if(n.staff)for(var o=0;o<n.staff.length;o++){for(var c=n.staff[o],p=[],a=0;a<c.voices.length;a++){var i=c.voices[a];p.push({hasOverlay:!1,voice:[],snip:[]}),d[f]=0;for(var s=0,h=!1,m=0,v=-1,w=0;w<i.length;w++){var N=i[w];if(N.el_type==="overlay"&&!h){l=!0,h=!0,v=w,p[a].hasOverlay=!0,m===0&&(m=d[f]);for(var L=0;L<f;L++)d[L]&&e.lines[L].staff&&c.voices.length>=e.lines[L].staff[0].voices.length&&e.lines[L].staff[0].voices.push([{el_type:"note",duration:d[L],rest:{type:"invisible"},startChar:N.startChar,endChar:N.endChar}])}else N.el_type==="bar"?(h?(h=!1,p[a].snip.push({start:v,len:w-v}),p[a].voice.push(N)):(s>0&&p[a].voice.push({el_type:"note",duration:s,rest:{type:"invisible"},startChar:N.startChar,endChar:N.endChar}),p[a].voice.push(N)),s=0):N.el_type==="note"?h?p[a].voice.push(N):(s+=N.duration,d[f]+=N.duration):(N.el_type==="scale"||N.el_type==="stem"||N.el_type==="overlay"||N.el_type==="style"||N.el_type==="transpose"||N.el_type==="color")&&p[a].voice.push(N)}p[a].hasOverlay&&p[a].snip.length===0&&p[a].snip.push({start:v,len:i.length-v})}for(a=0;a<p.length;a++){var x=p[a];if(x.hasOverlay){x.voice.splice(0,0,{el_type:"stem",direction:"down"}),c.voices.push(x.voice);for(var g=x.snip.length-1;g>=0;g--){var k=x.snip[g];c.voices[a].splice(k.start,k.len),c.voices[a].splice(k.start+1,0,{el_type:"stem",direction:"auto"});var D=r(c.voices[a],k.start);c.voices[a].splice(D,0,{el_type:"stem",direction:"up"})}for(g=0;g<c.voices[c.voices.length-1].length;g++){c.voices[c.voices.length-1][g]=G.clone(c.voices[c.voices.length-1][g]);var P=c.voices[c.voices.length-1][g];P.el_type==="bar"&&P.startEnding&&delete P.startEnding,P.el_type==="bar"&&P.endEnding&&delete P.endEnding}}}}}return l};function r(l,d){for(var f=d-1;f>0&&l[f].el_type!=="bar";f--);return f}function u(l){for(var d=!0,f=0;f<l.length;f++){var n=l[f];if(n.staff){for(var o=0;o<n.staff.length;o++){var c=n.staff[o];if(c.title){for(var p=!1,a=0;a<c.title.length;a++)c.title[a]?(c.title[a]=d?c.title[a].name:c.title[a].subname,c.title[a]?p=!0:c.title[a]=""):c.title[a]="";p||delete c.title}}d=!1}}}this.cleanUp=function(l,d,f){this.closeLine(),delete e.runningFonts,es(e),e.metaText.tempo&&e.metaText.tempo.bpm&&!e.metaText.tempo.duration&&(e.metaText.tempo.duration=[e.getBeatLength()]);var n=!1,o,c,p;for(o=0;o<e.lines.length;o++)if(e.lines[o].staff!==void 0){var a=!1;for(c=0;c<e.lines[o].staff.length;c++)if(e.lines[o].staff[c]===void 0)n=!0,e.lines[o].staff[c]=null;else for(p=0;p<e.lines[o].staff[c].voices.length;p++)e.lines[o].staff[c].voices[p]===void 0?e.lines[o].staff[c].voices[p]=[]:this.containsNotes(e.lines[o].staff[c].voices[p])&&(a=!0);a||(e.lines[o]=null,n=!0)}if(n&&(e.lines=e.lines.filter(function(g){return!!g}),e.lines.forEach(function(g){g.staff&&(g.staff=g.staff.filter(function(k){return!!k}))})),l)for(;m(e.lines,l););if(d){for(n=!1,o=0;o<e.lines.length;o++)if(e.lines[o].staff!==void 0)for(c=0;c<e.lines[o].staff.length;c++){var i=!1;for(p=0;p<e.lines[o].staff[c].voices.length;p++)this.containsNotesStrict(e.lines[o].staff[c].voices[p])&&(i=!0);i||(n=!0,e.lines[o].staff[c]=null)}n&&e.lines.forEach(function(g){g.staff&&(g.staff=g.staff.filter(function(k){return!!k}))})}for(u(e.lines),o=0;o<e.lines.length;o++)if(e.lines[o].staff)for(c=0;c<e.lines[o].staff.length;c++)delete e.lines[o].staff[c].workingClef;for(;this.resolveOverlays(););function s(g,k,D){f[k]||(f[k]=[]),f[k][D]||(f[k][D]=[]);for(var P,A=function(q,$,R){if(f[k][D][R]===void 0){for(P=0;P<f[k][D].length;P++)if(f[k][D][P]!==void 0){R=P;break}if(f[k][D][R]===void 0){var te=R*100+1;q.endSlur.forEach(function(U){te===U&&--te}),f[k][D][R]=[te]}}for(var K,se=0;se<$;se++)K=f[k][D][R].pop(),q.endSlur.push(K);return f[k][D][R].length===0&&delete f[k][D][R],K},S=function(q,$,R,te){q.startSlur=[],f[k][D][R]===void 0&&(f[k][D][R]=[]);for(var K=R*100+1,se=0;se<$;se++)te&&(te.forEach(function(U){K===U&&++K}),te.forEach(function(U){K===U&&++K}),te.forEach(function(U){K===U&&++K})),f[k][D][R].forEach(function(U){K===U&&++K}),f[k][D][R].forEach(function(U){K===U&&++K}),f[k][D][R].push(K),q.startSlur.push({label:K}),q.dottedSlur&&(q.startSlur[q.startSlur.length-1].style="dotted",delete q.dottedSlur),K++},M=0;M<g.length;M++){var B=g[M];if(B.el_type==="note"){if(B.gracenotes)for(var I=0;I<B.gracenotes.length;I++){if(B.gracenotes[I].endSlur){var z=B.gracenotes[I].endSlur;B.gracenotes[I].endSlur=[];for(var O=0;O<z;O++)A(B.gracenotes[I],1,20)}B.gracenotes[I].startSlur&&(P=B.gracenotes[I].startSlur,S(B.gracenotes[I],P,20))}if(B.endSlur&&(P=B.endSlur,B.endSlur=[],A(B,P,0)),B.startSlur&&(P=B.startSlur,S(B,P,0)),B.pitches){for(var y=[],b=0;b<B.pitches.length;b++)if(B.pitches[b].endSlur){var _=B.pitches[b].endSlur;B.pitches[b].endSlur=[];for(var E=0;E<_;E++){var F=A(B.pitches[b],1,b+1);y.push(F)}}for(b=0;b<B.pitches.length;b++)B.pitches[b].startSlur&&(P=B.pitches[b].startSlur,S(B.pitches[b],P,b+1,y));B.gracenotes&&B.pitches[0].endSlur&&B.pitches[0].endSlur[0]===100&&B.pitches[0].startSlur&&(B.gracenotes[0].endSlur?B.gracenotes[0].endSlur.push(B.pitches[0].startSlur[0].label):B.gracenotes[0].endSlur=[B.pitches[0].startSlur[0].label],B.pitches[0].endSlur.length===1?delete B.pitches[0].endSlur:B.pitches[0].endSlur[0]===100?B.pitches[0].endSlur.shift():B.pitches[0].endSlur[B.pitches[0].endSlur.length-1]===100&&B.pitches[0].endSlur.pop(),f[k][D][1].length===1?delete f[k][D][1]:f[k][D][1].pop())}}}}function h(g){V.fixClef(g)}function m(g,k){for(o=0;o<g.length;o++)if(g[o].staff!==void 0)for(c=0;c<g[o].staff.length;c++){var D=[];for(p=0;p<g[o].staff[c].voices.length;p++)for(var P=g[o].staff[c].voices[p],A=0,S=0;S<P.length;S++)if(P[S].el_type==="bar"){if(A++,A>=k&&S<P.length-1){var M=v(g,o);if(!M){var B=JSON.parse(JSON.stringify(g[o]));g.push(G.clone(B)),M=g[g.length-1];for(var I=0;I<M.staff.length;I++)for(var z=0;z<M.staff[I].voices.length;z++)M.staff[I].voices[z]=[]}var O=S+1,y=g[o].staff[c].voices[p].slice(O);return g[o].staff[c].voices[p]=g[o].staff[c].voices[p].slice(0,O),M.staff[c].voices[p]=D.concat(y.concat(M.staff[c].voices[p])),!0}}else P[S].duration||D.push(P[S])}return!1}function v(g,k){for(k++;g.length>k;){if(g[k].staff)return g[k];k++}return null}for(e.lineNum=0;e.lineNum<e.lines.length;e.lineNum++){var w=e.lines[e.lineNum].staff;if(w)for(e.staffNum=0;e.staffNum<w.length;e.staffNum++)for(w[e.staffNum].clef&&h(w[e.staffNum].clef),e.voiceNum=0;e.voiceNum<w[e.staffNum].voices.length;e.voiceNum++){var N=w[e.staffNum].voices[e.voiceNum];s(N,e.staffNum,e.voiceNum);for(var L=0;L<N.length;L++)N[L].el_type==="clef"&&h(N[L]);if(N.length>0&&N[N.length-1].barNumber){var x=v(e.lines,e.lineNum);x&&(x.staff[0].barNumber=N[N.length-1].barNumber),delete N[N.length-1].barNumber}}}return delete e.staffNum,delete e.voiceNum,delete e.lineNum,delete e.potentialStartBeam,delete e.potentialEndBeam,delete e.vskipPending,f},e.reset(),this.getLastNote=function(){if(e.lines[e.lineNum]&&e.lines[e.lineNum].staff&&e.lines[e.lineNum].staff[e.staffNum]&&e.lines[e.lineNum].staff[e.staffNum].voices[e.voiceNum])for(var l=e.lines[e.lineNum].staff[e.staffNum].voices[e.voiceNum].length-1;l>=0;l--){var d=e.lines[e.lineNum].staff[e.staffNum].voices[e.voiceNum][l];if(d.el_type==="note")return d}return null},this.addTieToLastNote=function(l){var d=this.getLastNote();return d&&d.pitches&&d.pitches.length>0?(d.pitches[0].startTie={},l&&(d.pitches[0].startTie.style="dotted"),!0):!1},this.getDuration=function(l){return l.duration?l.duration:0},this.closeLine=function(){e.potentialStartBeam&&e.potentialEndBeam&&(e.potentialStartBeam.startBeam=!0,e.potentialEndBeam.endBeam=!0),delete e.potentialStartBeam,delete e.potentialEndBeam},this.appendElement=function(l,d,f,n){var o=e,c=function(s){var h=o.lines[o.lineNum].staff[o.staffNum];if(h){if(s.pitches!==void 0){var m=h.workingClef.verticalPos;s.pitches.forEach(function(w){w.verticalPos=w.pitch-m})}if(s.gracenotes!==void 0){var v=h.workingClef.verticalPos;s.gracenotes.forEach(function(w){w.verticalPos=w.pitch-v})}h.voices[o.voiceNum].push(s)}};n.el_type=l,d!==null&&(n.startChar=d),f!==null&&(n.endChar=f);var p=function(){o.potentialStartBeam.startBeam=!0,n.endBeam=!0,delete o.potentialStartBeam,delete o.potentialEndBeam},a=function(){o.potentialStartBeam!==void 0&&o.potentialEndBeam!==void 0&&(o.potentialStartBeam.startBeam=!0,o.potentialEndBeam.endBeam=!0),delete o.potentialStartBeam,delete o.potentialEndBeam};if(l==="note"){var i=t.getDuration(n);i>=.25||n.force_end_beam_last&&o.potentialStartBeam!==void 0?a():n.end_beam&&o.potentialStartBeam!==void 0?n.rest===void 0?p():a():n.rest===void 0&&(o.potentialStartBeam===void 0?n.end_beam||(o.potentialStartBeam=n,delete o.potentialEndBeam):o.potentialEndBeam=n)}else a();delete n.end_beam,delete n.force_end_beam_last,c(n)},this.appendStartingElement=function(l,d,f,n){this.closeLine();var o;l==="key"&&(o=n.impliedNaturals,delete n.impliedNaturals,delete n.explicitAccidentals);var c=G.clone(n);if(e.lines[e.lineNum]&&e.lines[e.lineNum].staff){e.lines[e.lineNum].staff.length<=e.staffNum&&(e.lines[e.lineNum].staff[e.staffNum]={},e.lines[e.lineNum].staff[e.staffNum].clef=G.clone(e.lines[e.lineNum].staff[0].clef),e.lines[e.lineNum].staff[e.staffNum].key=G.clone(e.lines[e.lineNum].staff[0].key),e.lines[e.lineNum].staff[0].meter&&(e.lines[e.lineNum].staff[e.staffNum].meter=G.clone(e.lines[e.lineNum].staff[0].meter)),e.lines[e.lineNum].staff[e.staffNum].workingClef=G.clone(e.lines[e.lineNum].staff[0].workingClef),e.lines[e.lineNum].staff[e.staffNum].voices=[[]]),l==="clef"&&(e.lines[e.lineNum].staff[e.staffNum].workingClef=c);for(var p=e.lines[e.lineNum].staff[e.staffNum].voices[e.voiceNum],a=0;a<p.length;a++){if(p[a].el_type==="note"||p[a].el_type==="bar"){c.el_type=l,c.startChar=d,c.endChar=f,o&&(c.accidentals=o.concat(c.accidentals)),p.push(c);return}if(p[a].el_type===l){c.el_type=l,c.startChar=d,c.endChar=f,o&&(c.accidentals=o.concat(c.accidentals)),p[a]=c;return}}e.lines[e.lineNum].staff[e.staffNum][l]=n}},this.pushLine=function(l){e.vskipPending&&(l.vskip=e.vskipPending,delete e.vskipPending),e.lines.push(l)},this.addSubtitle=function(l,d){this.pushLine({subtitle:{text:l,startChar:d.startChar,endChar:d.endChar}})},this.addSpacing=function(l){e.vskipPending=l},this.addNewPage=function(l){this.pushLine({newpage:l})},this.addSeparator=function(l,d,f,n){this.pushLine({separator:{spaceAbove:Math.round(l),spaceBelow:Math.round(d),lineLength:Math.round(f),startChar:n.startChar,endChar:n.endChar}})},this.addText=function(l,d){this.pushLine({text:{text:l,startChar:d.startChar,endChar:d.endChar}})},this.addCentered=function(l){this.pushLine({text:[{text:l,center:!0}]})},this.containsNotes=function(l){for(var d=0;d<l.length;d++)if(l[d].el_type==="note"||l[d].el_type==="bar")return!0;return!1},this.containsNotesStrict=function(l){for(var d=0;d<l.length;d++)if(l[d].el_type==="note"&&(l[d].rest===void 0||l[d].chord!==void 0))return!0;return!1},this.changeVoiceScale=function(l){t.appendElement("scale",null,null,{size:l})},this.changeVoiceColor=function(l){t.appendElement("color",null,null,{color:l})},this.startNewLine=function(l){var d=e;this.closeLine();var f=function(c){var p=d.lines[d.lineNum].staff[d.staffNum];if(p.voices[d.voiceNum]=[],p.title||(p.title=[]),p.title[d.voiceNum]={name:c.name,subname:c.subname},c.style&&t.appendElement("style",null,null,{head:c.style}),c.stem)t.appendElement("stem",null,null,{direction:c.stem});else if(d.voiceNum>0){if(p.voices[0]!==void 0){for(var a=!1,i=0;i<p.voices[0].length;i++)p.voices[0].el_type==="stem"&&(a=!0);if(!a){var s={el_type:"stem",direction:"up"};p.voices[0].splice(0,0,s)}}t.appendElement("stem",null,null,{direction:"down"})}c.scale&&t.appendElement("scale",null,null,{size:c.scale}),c.color&&t.appendElement("color",null,null,{color:c.color})},n=function(c){c.key&&c.key.impliedNaturals&&(c.key.accidentals=c.key.accidentals.concat(c.key.impliedNaturals),delete c.key.impliedNaturals),d.lines[d.lineNum].staff[d.staffNum]={voices:[],clef:c.clef,key:c.key,workingClef:c.clef},c.stafflines!==void 0&&(d.lines[d.lineNum].staff[d.staffNum].clef.stafflines=c.stafflines,d.lines[d.lineNum].staff[d.staffNum].workingClef.stafflines=c.stafflines),c.staffscale&&(d.lines[d.lineNum].staff[d.staffNum].staffscale=c.staffscale),c.annotationfont&&t.setLineFont("annotationfont",c.annotationfont),c.gchordfont&&t.setLineFont("gchordfont",c.gchordfont),c.tripletfont&&t.setLineFont("tripletfont",c.tripletfont),c.vocalfont&&t.setLineFont("vocalfont",c.vocalfont),c.bracket&&(d.lines[d.lineNum].staff[d.staffNum].bracket=c.bracket),c.brace&&(d.lines[d.lineNum].staff[d.staffNum].brace=c.brace),c.connectBarLines&&(d.lines[d.lineNum].staff[d.staffNum].connectBarLines=c.connectBarLines),c.barNumber&&(d.lines[d.lineNum].staff[d.staffNum].barNumber=c.barNumber),f(c),c.part&&t.appendElement("part",c.part.startChar,c.part.endChar,{title:c.part.title}),c.meter!==void 0&&(d.lines[d.lineNum].staff[d.staffNum].meter=c.meter),d.vskipPending&&(d.lines[d.lineNum].vskip=d.vskipPending,delete d.vskipPending)},o=function(c){d.lines[d.lineNum]={staff:[]},n(c)};e.lines[e.lineNum]===void 0?o(l):e.lines[e.lineNum].staff===void 0?(e.lineNum++,this.startNewLine(l)):e.lines[e.lineNum].staff[e.staffNum]===void 0?n(l):e.lines[e.lineNum].staff[e.staffNum].voices[e.voiceNum]===void 0?f(l):this.containsNotes(e.lines[e.lineNum].staff[e.staffNum].voices[e.voiceNum])?(e.lineNum++,this.startNewLine(l)):l.part&&t.appendElement("part",l.part.startChar,l.part.endChar,{title:l.part.title})},this.setRunningFont=function(l,d){e.runningFonts[l]=d},this.setLineFont=function(l,d){if(e.runningFonts[l]){for(var f=!1,n=Object.keys(d),o=0;o<n.length;o++)e.runningFonts[l][n[o]]!==d[n[o]]&&(f=!0);f&&(e.lines[e.lineNum].staff[e.staffNum][l]=d)}e.runningFonts[l]=d},this.setBarNumberImmediate=function(l){var d=this.getCurrentVoice();if(d&&d.length>0){var f=d[d.length-1];if(f.el_type==="bar")f.barNumber!==void 0&&(f.barNumber=l);else return l-1}return l},this.hasBeginMusic=function(){for(var l=0;l<e.lines.length;l++)if(e.lines[l].staff)return!0;return!1},this.isFirstLine=function(l){for(var d=l-1;d>=0;d--)if(e.lines[d].staff!==void 0)return!1;return!0},this.getCurrentVoice=function(){var l=e.lines[e.lineNum];if(!l)return null;var d=l.staff[e.staffNum];return d&&d.voices[e.voiceNum]!==void 0?d.voices[e.voiceNum]:null},this.setCurrentVoice=function(l,d){e.staffNum=l,e.voiceNum=d;for(var f=0;f<e.lines.length;f++)if(e.lines[f].staff&&(e.lines[f].staff[l]===void 0||e.lines[f].staff[l].voices[d]===void 0||!this.containsNotes(e.lines[f].staff[l].voices[d]))){e.lineNum=f;return}e.lineNum=f},this.addMetaText=function(l,d,f){e.metaText[l]===void 0?(e.metaText[l]=d,e.metaTextInfo[l]=f):(typeof e.metaText[l]=="string"&&typeof d=="string"?e.metaText[l]+=`
`+d:(e.metaText[l]==="string"&&(e.metaText[l]=[{text:e.metaText[l]}]),typeof d=="string"&&(d=[{text:d}]),e.metaText[l]=e.metaText[l].concat(d)),e.metaTextInfo[l].endChar=f.endChar)},this.addMetaTextArray=function(l,d,f){e.metaText[l]===void 0?(e.metaText[l]=[d],e.metaTextInfo[l]=f):(e.metaText[l].push(d),e.metaTextInfo[l].endChar=f.endChar)},this.addMetaTextObj=function(l,d,f){e.metaText[l]=d,e.metaTextInfo[l]=f}};function $a(e){if(!e||typeof e=="string")return!1;for(var t="",r=0;r<e.length;r++)if(typeof e[r]!="string")return!1;return!0}function es(e){$a(e.metaText.notes)&&(e.metaText.notes=e.metaText.notes.join(`
`)),$a(e.metaText.history)&&(e.metaText.history=e.metaText.history.join(`
`))}var Ha=Vi;function Wa(){"use strict";var e=new Tr,t=new Ha(e),r,u="",l="";this.getTune=function(){var x={formatting:e.formatting,lines:e.lines,media:e.media,metaText:e.metaText,metaTextInfo:e.metaTextInfo,version:e.version,addElementToEvents:e.addElementToEvents,addUsefulCallbackInfo:e.addUsefulCallbackInfo,getTotalTime:e.getTotalTime,getTotalBeats:e.getTotalBeats,getBarLength:e.getBarLength,getBeatLength:e.getBeatLength,getBeatsPerMeasure:e.getBeatsPerMeasure,getBpm:e.getBpm,getMeter:e.getMeter,getMeterFraction:e.getMeterFraction,getPickupLength:e.getPickupLength,getKeySignature:e.getKeySignature,getElementFromChar:e.getElementFromChar,makeVoicesArray:e.makeVoicesArray,millisecondsPerMeasure:e.millisecondsPerMeasure,setupEvents:e.setupEvents,setTiming:e.setTiming,setUpAudio:e.setUpAudio,deline:e.deline};return e.lineBreaks&&(x.lineBreaks=e.lineBreaks),e.visualTranspose&&(x.visualTranspose=e.visualTranspose),x};function d(x,g,k){x.positioning||(x.positioning={}),x.positioning[g]=k}function f(x,g,k){x.fonts||(x.fonts={}),x.fonts[g]=k}var n={reset:function(){for(var x in this)this.hasOwnProperty(x)&&typeof this[x]!="function"&&delete this[x];this.iChar=0,this.key={accidentals:[],root:"none",acc:"",mode:""},this.meter=null,this.origMeter=null,this.hasMainTitle=!1,this.default_length=.125,this.clef={type:"treble",verticalPos:0},this.octave=0,this.next_note_duration=0,this.start_new_line=!0,this.is_in_header=!0,this.partForNextLine={},this.tempoForNextLine=[],this.havent_set_length=!0,this.voices={},this.staves=[],this.macros={},this.currBarNumber=1,this.barCounter={},this.ignoredDecorations=[],this.score_is_present=!1,this.inEnding=!1,this.inTie=[],this.inTieChord={},this.vocalPosition="auto",this.dynamicPosition="auto",this.chordPosition="auto",this.ornamentPosition="auto",this.volumePosition="auto",this.openSlurs=[],this.freegchord=!1,this.endingHoldOver={}},differentFont:function(x,g){return this[x].decoration!==g[x].decoration||this[x].face!==g[x].face||this[x].size!==g[x].size||this[x].style!==g[x].style||this[x].weight!==g[x].weight},addFormattingOptions:function(x,g,k){k==="note"?(this.vocalPosition!=="auto"&&d(x,"vocalPosition",this.vocalPosition),this.dynamicPosition!=="auto"&&d(x,"dynamicPosition",this.dynamicPosition),this.chordPosition!=="auto"&&d(x,"chordPosition",this.chordPosition),this.ornamentPosition!=="auto"&&d(x,"ornamentPosition",this.ornamentPosition),this.volumePosition!=="auto"&&d(x,"volumePosition",this.volumePosition),this.differentFont("annotationfont",g)&&f(x,"annotationfont",this.annotationfont),this.differentFont("gchordfont",g)&&f(x,"gchordfont",this.gchordfont),this.differentFont("vocalfont",g)&&f(x,"vocalfont",this.vocalfont),this.differentFont("tripletfont",g)&&f(x,"tripletfont",this.tripletfont)):k==="bar"&&(this.dynamicPosition!=="auto"&&d(x,"dynamicPosition",this.dynamicPosition),this.chordPosition!=="auto"&&d(x,"chordPosition",this.chordPosition),this.ornamentPosition!=="auto"&&d(x,"ornamentPosition",this.ornamentPosition),this.volumePosition!=="auto"&&d(x,"volumePosition",this.volumePosition),this.differentFont("measurefont",g)&&f(x,"measurefont",this.measurefont),this.differentFont("repeatfont",g)&&f(x,"repeatfont",this.repeatfont))},duplicateStartEndingHoldOvers:function(){this.endingHoldOver={inTie:[],inTieChord:{}};for(var x=0;x<this.inTie.length;x++)if(this.endingHoldOver.inTie.push([]),this.inTie[x])for(var g=0;g<this.inTie[x].length;g++)this.endingHoldOver.inTie[x].push(this.inTie[x][g]);for(var k in this.inTieChord)this.inTieChord.hasOwnProperty(k)&&(this.endingHoldOver.inTieChord[k]=this.inTieChord[k])},restoreStartEndingHoldOvers:function(){if(this.endingHoldOver.inTie){this.inTie=[],this.inTieChord={};for(var x=0;x<this.endingHoldOver.inTie.length;x++){this.inTie.push([]);for(var g=0;g<this.endingHoldOver.inTie[x].length;g++)this.inTie[x].push(this.endingHoldOver.inTie[x][g])}for(var k in this.endingHoldOver.inTieChord)this.endingHoldOver.inTieChord.hasOwnProperty(k)&&(this.inTieChord[k]=this.endingHoldOver.inTieChord[k])}}},o=function(x){n.warnings||(n.warnings=[]),n.warnings.push(x)},c=function(x){n.warningObjects||(n.warningObjects=[]),n.warningObjects.push(x)},p=function(x){var g=x.replace(/\x12/g," ");return g=g.replace(/&/g,"&amp;"),g=g.replace(/</g,"&lt;"),g.replace(/>/g,"&gt;")},a=function(x,g,k){g||(g=" ");var D=g[k];(D===" "||!D)&&(D="SPACE");var P=p(g.substring(k-64,k))+'<span style="text-decoration:underline;font-size:1.3em;font-weight:bold;">'+D+"</span>"+p(g.substring(k+1).substring(0,64));o("Music Line:"+r.lineIndex+":"+(k+1)+": "+x+":  "+P),c({message:x,line:g,startChar:n.iChar+k,column:k})},i,s;this.getWarnings=function(){return n.warnings},this.getWarningObjects=function(){return n.warningObjects};var h=function(x,g){if(g.indexOf("")>=0){u+=g;return}if(g=u+g,u="",!x){a("Can't add words before the first line of music",x,0);return}g=G.strip(g),g[g.length-1]!=="-"&&(g=g+" ");for(var k=[],D=0,P=!1,A=function(I){var z=G.strip(g.substring(D,I));if(z=z.replace(/\\([-_*|~])/g,"$1"),D=I+1,z.length>0){P&&(z=z.replace(/~/g," "));var O=g[I];return O!=="_"&&O!=="-"&&(O=" "),k.push({syllable:r.translateString(z),divider:O}),P=!1,!0}return!1},S=!1,M=0;M<g.length;M++){switch(g[M]){case" ":case"":A(M);break;case"-":!S&&!A(M)&&k.length>0&&(G.last(k).divider="-",k.push({skip:!0,to:"next"}));break;case"_":S||(A(M),k.push({skip:!0,to:"slur"}));break;case"*":S||(A(M),k.push({skip:!0,to:"next"}));break;case"|":S||(A(M),k.push({skip:!0,to:"bar"}));break;case"~":S||(P=!0);break}S=g[M]==="\\"}var B=!1;x.forEach(function(I){if(k.length!==0){if(k[0].skip){switch(k[0].to){case"next":I.el_type==="note"&&I.pitches!==null&&!B&&k.shift();break;case"slur":I.el_type==="note"&&I.pitches!==null&&k.shift();break;case"bar":I.el_type==="bar"&&k.shift();break}I.el_type!=="bar"&&(I.lyric===void 0?I.lyric=[{syllable:"",divider:" "}]:I.lyric.push({syllable:"",divider:" "}))}else if(I.el_type==="note"&&I.rest===void 0&&!B){var z=k.shift();z.syllable&&(z.syllable=z.syllable.replace(/ +/g," ")),I.lyric===void 0?I.lyric=[z]:I.lyric.push(z)}}})},m=function(x,g){if(g.indexOf("")>=0){l+=g;return}if(g=l+g,l="",!x){a("Can't add symbols before the first line of music",x,0);return}g=G.strip(g),g[g.length-1]!=="-"&&(g=g+" ");for(var k=[],D=0,P=!1,A=function(B){var I=G.strip(g.substring(D,B));if(D=B+1,I.length>0){P&&(I=I.replace(/~/g," "));var z=g[B];return z!=="_"&&z!=="-"&&(z=" "),k.push({syllable:r.translateString(I),divider:z}),P=!1,!0}return!1},S=0;S<g.length;S++)switch(g[S]){case" ":case"":A(S);break;case"-":!A(S)&&k.length>0&&(G.last(k).divider="-",k.push({skip:!0,to:"next"}));break;case"_":A(S),k.push({skip:!0,to:"slur"});break;case"*":A(S),k.push({skip:!0,to:"next"});break;case"|":A(S),k.push({skip:!0,to:"bar"});break;case"~":P=!0;break}var M=!1;x.forEach(function(B){if(k.length!==0){if(k[0].skip)switch(k[0].to){case"next":B.el_type==="note"&&B.pitches!==null&&!M&&k.shift();break;case"slur":B.el_type==="note"&&B.pitches!==null&&k.shift();break;case"bar":B.el_type==="bar"&&k.shift();break}else if(B.el_type==="note"&&B.rest===void 0&&!M){var I=k.shift();B.lyric===void 0?B.lyric=[I]:B.lyric.push(I)}}})},v=function(x){if(G.startsWith(x,"%%")){var g=Y.addDirective(x.substring(2));g&&a(g,x,2);return}var k=x.indexOf("%");if(k>=0&&(x=x.substring(0,k)),x=x.replace(/\s+$/,""),x.length!==0){if(u){h(t.getCurrentVoice(),x.substring(2));return}if(l){m(t.getCurrentVoice(),x.substring(2));return}if(x.length<2||x[1]!==":"||s.lineContinuation){s.parseMusic(x);return}var D=i.parseHeader(x);D.regular&&s.parseMusic(x),D.newline&&s.startNewLine(),D.words&&h(t.getCurrentVoice(),x.substring(2)),D.symbols&&m(t.getCurrentVoice(),x.substring(2))}};function w(x,g){x.push({el_type:"hint"});for(var k=0;k<g.length;k++){var D=g[k],P=G.clone(D);if(x.push(P),D.el_type==="bar")return}}function N(x,g){for(var k=0;k<x.length;k++){var D=x[k],P=g[k];if(P)for(var A=0;A<P.voices.length;A++){var S=P.voices[A],M=D.voices[A];M&&w(M,S)}}}function L(){for(var x=0;x<e.lines.length;x++){var g=e.lines[x].staff;if(g){for(var k=x+1;k<e.lines.length&&e.lines[k].staff===void 0;)k++;if(k<e.lines.length){var D=e.lines[k].staff;N(g,D)}}}}this.parse=function(x,g,k){g||(g={}),k||(k=0),e.reset(),x=x.replace(/\r\n?/g,`
`)+`
`;var D=x.split(`
\\`);if(D.length>1){for(var P=1;P<D.length;P++)for(;D[P].length>0&&D[P][0]!==`
`;)D[P]=D[P].substr(1),D[P-1]+=" ";x=D.join("  ")}x=x.replace(/\\([ \t]*)(%.*)*\n/g,function(O,y,b){var _=b?Array(b.length+1).join(" "):"";return y+""+_+`
`});var A=x.split(`
`);G.last(A).length===0&&A.pop(),r=new za(A,n),i=new La(r,a,n,e,t),s=new vt(r,a,n,e,t,i),g.print&&(e.media="print"),n.reset(),n.iChar=k,g.visualTranspose?(n.globalTranspose=parseInt(g.visualTranspose),n.globalTranspose===0?n.globalTranspose=void 0:t.setVisualTranspose(g.visualTranspose)):n.globalTranspose=void 0,g.lineBreaks&&(n.lineBreaks=g.lineBreaks),i.reset(r,a,n,e);try{g.format&&Y.globalFormatting(g.format);for(var S=r.nextLine();S;){if(g.header_only&&n.is_in_header===!1||g.stop_on_warning&&n.warnings)throw"normal_abort";var M=n.is_in_header;v(S),M&&!n.is_in_header&&(t.setRunningFont("annotationfont",n.annotationfont),t.setRunningFont("gchordfont",n.gchordfont),t.setRunningFont("tripletfont",n.tripletfont),t.setRunningFont("vocalfont",n.vocalfont)),S=r.nextLine()}u&&h(t.getCurrentVoice(),""),l&&m(t.getCurrentVoice(),""),n.openSlurs=t.cleanUp(n.barsperstaff,n.staffnonote,n.openSlurs)}catch(O){if(O!=="normal_abort")throw O}var B=11*72,I=8.5*72;switch(n.papersize){case"legal":B=14*72,I=8.5*72;break;case"A4":B=11.7*72,I=8.3*72;break}if(n.landscape){var z=B;B=I,I=z}e.formatting.pagewidth||(e.formatting.pagewidth=I),e.formatting.pageheight||(e.formatting.pageheight=B),g.hint_measures&&L(),qa.wrapLines(e,n.lineBreaks,n.barNumbers)}}var Ua=new Wa;function Mr(e){throw new Error("Todo: "+e)}function ts(e,t){let r=t.sequences.find(Ca({id:e}));return r||(r={id:e,events:[],cursor:0},t.sequences.push(r),t.events.push([0,"sequence",e]),r)}function bt(e,t){let r=t.length;for(;r--;)if(t[r][1]===e)return t[r]}function rs(e,t){return[0,0,2,4,5,7,9,11,12,14,16,17,19,21,23,24,26,28,29,31,33,35,36,38,40,41,43,45,47,48][t]+e+60}function Lr(e){Ua.parse(e);let t=Ua.getTune(),r=t.lines.reduce((u,l)=>(l.staff.reduce((d,f,n)=>{let o=ts(n,u),c=o.events;if(f.clef){let a=f.clef.type,i=bt("clef",c);(!i||i[2]!==a)&&c.push([0,"clef",a])}let p=bt("key",c);if(f.key){let a=f.key.mode===""?f.key.root:Mr("What happens when ABC decides key.mode is not an empty string?"),i={C:0,D:2,E:4,F:5,G:7,A:9,B:11};i[a]||Mr('ABC says root is "'+a+'", we have not implemented support for that');let s=i[a];(!p||p[2]!==a)&&(p=[o.cursor,"key",s],c.push(p))}if(f.meter){let a=1/(+f.meter.value[0].den/4),i=+f.meter.value[0].num*a,s=bt("meter",c);(!s||s[2]!==i||s[3]!==a)&&c.push([0,"meter",i,a])}if(f.voices){let a=bt("note",c);f.voices[0].reduce((i,s)=>{if(s.el_type==="note")s.pitches.reduce((h,m)=>(h.push([o.cursor,"note",rs(p[2],m.pitch),.25,s.duration*4]),h),i),o.cursor+=s.duration*4;else if(s.el_type==="bar"){let h=bt("meter",i);if((o.cursor-h[0])%h[2]!==0){let v=(Math.floor((o.cursor-h[0])/h[2])+1)*h[2];o.cursor=v}}else console.log("ABC voice ignored:",s);return i},c),f.voices[1]&&Mr("What do we do with a second array of voices?")}return d},u.sequences),u),{name:t.metaText.title,events:[],sequences:[],meta:t.metaText});return r.sequences.forEach(u=>delete u.cursor),r}var as={chord:3,note:3,key:1,meter:2,rate:1,lyric:2},ns=/^[ABCDEFG][b♭#♯]{0,1}-?\d$/,Ka=/^[ABCDEFG][b♭#♯]{0,1}/;function Br(e){let t=e.trim().split(/\s+/),r=[],u=-1;for(;t[++u]!==void 0;){let l=Number(t[u]),d=t[++u];ns.test(d)?(d="note",--u):Ka.test(d)&&(d="chord",--u);let f=[l,d],n=as[d];if(n===void 0)throw new TypeError('Unrecognised type "'+d+'" in sequence data');if(d==="chord"){let o=Ka.exec(t[++u])[0],c=t[u].slice(o.length)||t[++u],p=Number(t[++u]);f.push(o,c,p)}else for(;n--;){let o=Number(t[++u]);f.push(Number.isNaN(o)?t[u]:o)}r.push(f)}return r}function is(e){let t=e.files[Object.keys(e.files)[0]];return Re(t.type,t.content)}function ss(e){let t=e.settings.find(matches({id:13324}))||e.settings[0];return Re("abc",t.abc)}function Re(e,t){if(typeof t=="object")return t.files?is(t):t.settings?ss():Array.isArray(t)?{id:0,events:t}:t;if(e==="abc"||e==="text/x-abc")return Lr(t.replace(/\n\s+/g,`
`)).sequences[0];if(e==="sequence"||e==="text/plain")return{events:Br(t)};{let r=JSON.parse(t);return Array.isArray(r)?{id:0,events:r}:r}}var os=lr(wa);var Qa=j((e,t)=>typeof t,{string:function(e,t){return os(t).then(r=>Re(e,r)).catch(r=>console.error(r))},default:function(e,t,r,u){t[e]=u}});var Xa=Math.abs,Ie=1.1;function Za(e,t,r){return`<path class="beam-path-16th beam-path" d="
        M${r[0]},              ${-e*r[0]/(t.length-1)-.5*Ie}
        L${r[r.length-1]},${-e*r[r.length-1]/(t.length-1)-.5*Ie}
        L${r[r.length-1]},${-e*r[r.length-1]/(t.length-1)+.5*Ie}
        L${r[0]},              ${-e*r[0]/(t.length-1)+.5*Ie}
    Z"></path>`}function cs(e,t){let r=e.map(we("duration")),u="",l=-1,d;for(;r[++l];)r[l]<.5&&r[l].toFixed(2)!=="0.33"?d?d.push(l):d=[l]:d&&(u+=Za(t,e,d),d=void 0);return d&&(u+=Za(t,e,d)),u}var Ya=j(we("type"),{clef:e=>e.clef==="percussion"?void 0:H("svg",{class:`${e.clef}-clef clef`,viewBox:"0 0.4 5.2 14.6",preserveAspectRatio:"none",html:`<use x="3.2" y="1" width="8" href="#${e.clef}-clef"></use>`}),chord:e=>H("p",{class:"chord",data:{beat:e.beat+1,duration:e.duration},html:(()=>e.value.replace("(♯11)",'<sup class="chord-brackets">(♯11)</sup>').replace("6",'<sup class="six">6</sup>').replace("7",'<sup class="seven">7</sup>').replace("9",'<sup class="nine">9</sup>').replace("maj",'<sub class="tag">maj</sub>').replace("min",'<sub class="tag">min</sub>').replace("alt",'<sub class="tag">alt</sub>').replace("sus",'<sub class="tag">sus</sub>').replace("ø",'<sup class="halfdim">ø</sup>').replace("♯",'<span class="sharp">♯</span>').replace("♭",'<span class="flat">♭</span>').replace("♮",'<span class="natural">♮</span>'))(e)}),timesig:e=>H("header",{class:"timesig",html:`<p>${e.numerator}</p>
            <p>${e.denominator}</p>`}),lyric:e=>H("p",{class:"lyric",data:{beat:e.beat+1,duration:e.duration},html:e.value}),acci:e=>H("svg",{class:"acci",viewBox:e.value===1?"0 -4 2.3 4":e.value===-1?"0 -4 2 4":"0 -4 1.8 4",preserveAspectRatio:"xMidYMid slice",data:e.beat===void 0?{pitch:e.pitch}:{beat:e.beat+1,pitch:e.pitch,part:e.part},html:'<use href="#acci-'+(e.value===1?"sharp":e.value===-1?"flat":"natural")+'"></use>'}),upledger:e=>H("svg",{class:"up-ledge ledge",viewBox:`0 ${.5-e.rows} 4.4 ${e.rows}`,preserveAspectRatio:"xMidYMax",data:{beat:e.beat+1,pitch:e.pitch,part:e.part},style:`height: calc(${e.rows} * var(--y-size));`,html:'<use x="0" y="-8" href="#ledges"></use>'}),downledger:e=>H("svg",{class:"down-ledge ledge",viewBox:`0 -0.5 4.4 ${e.rows}`,preserveAspectRatio:"xMidYMin",data:{beat:e.beat+1,pitch:e.pitch,part:e.part},style:`height: calc(${e.rows} * var(--y-size));`,html:'<use x="0" y="-8" href="#ledges"></use>'}),head:e=>H("svg",{class:"head",viewBox:"0 -1 2.7 2",preserveAspectRatio:"xMidYMid slice",data:{beat:e.beat+1,pitch:e.pitch,duration:e.duration,part:e.part},html:`<use href="#${e.head||`head[${e.duration}]`}"></use>`}),stem:e=>H("svg",{class:`${e.stemDirection}-stem stem`,viewBox:"0 0 2.7 7",preserveAspectRatio:"none",data:{beat:e.beat+1,pitch:e.pitch,duration:e.duration,part:e.part},style:`--beam-y: ${e.beamY===void 0?0:e.beamY};`,html:'<use href="#stem'+e.stemDirection+'"></use>'}),beam:e=>H("svg",{class:`${e.updown}-beam beam`,viewBox:`0 ${(e.range>0?-e.range:0)-.5} ${e.stems.length-1} ${Xa(e.range)+1}`,preserveAspectRatio:"none",data:{beat:e.beat+1,pitch:e.pitch,duration:e.duration,part:e.part},style:`height: calc(${Xa(e.range)+1} * var(--y-size)); align-self: ${e.range>0?"end":"start"};`,html:`
            <path class="beam-path" d="M0,${-.5*Ie} L${e.stems.length-1},${-e.range-.5*Ie} L${e.stems.length-1},${-e.range+.5*Ie} L0,${.5*Ie} Z"></path>
            ${cs(e.stems,e.range)}
        `}),tie:e=>H("svg",{class:`${e.updown}-tie tie`,viewBox:"0 0 1 1",preserveAspectRatio:"none",data:{beat:e.beat+1,pitch:e.pitch,duration:e.duration,part:e.part},style:`height: calc(6 * var(--y-size)); align-self: ${e.updown==="up"?"end":"start"};`,html:'<use href="#tie"></use>'}),tail:e=>H("svg",{class:`${e.stemDirection}-tail tail`,viewBox:"0 -1 2.7 2",preserveAspectRatio:"xMidYMid",data:{beat:e.beat+1,pitch:e.pitch,duration:e.duration,part:e.part},html:'<use href="#tail'+e.stemDirection+"["+e.duration+']"></use>'}),rest:e=>H("svg",{class:"rest",viewBox:e.duration===.125?"0 -4 3.0 8":e.duration===.25?"0 -4 2.8 8":e.duration===.375?"0 -4 3.8 8":e.duration===.5?"0 -4 2.6 8":e.duration===.75?"-0.2 -4 3.6 8":e.duration===1?"0 -4 2.6 8":e.duration===1.5?"0 -4 3.5 8":(e.duration===2||e.duration===3||e.duration===4||e.duration===6,"0 -4 2.6 8"),preserveAspectRatio:"xMidYMid slice",data:{beat:e.beat+1,pitch:e.pitch,duration:e.duration,part:e.part},html:'<use href="#rest['+e.duration+']"></use>'}),default:function(e){return function(t){e[t.type]||(e[t.type]=!0,console.log(t),console.error('Scribe: symbol type "'+t.type+'" not rendered'))}}({})});var fs=Object.defineProperties,Ja=import.meta.url.replace(/\/[^\/]*\.js/,"/shadow.css"),yt=he.of(),ja=[];yt.each(e=>ja.forEach(t=>t(e)));console.log("SHADOW",Ja);function ls(e,t){let r=Ya(t);return r&&e.push(r),e}function us(e,t){return e.push(H("div",{class:`${t.stave.clef}-stave stave bar`,data:{duration:t.duration},children:t.symbols.reduce(ls,[])})),e}var hs=/^(\d+)\/(\d+)$/;function ds(e){let t=hs.exec(e),r=parseInt(t[1],10),u=4/parseInt(t[2],10);return[0,"meter",r*u,u]}function ps(e){let t=e[2],r=e[3],u=t/r,l=4/r;return u+"/"+l}var cl=fs(Kt("scribe-music",{shadow:`
        <link rel="stylesheet" href="${Ja}" />
        <svg width="0" height="0">
            <defs>
                <!-- Rests -->
                <path id="rest[0.125]" class="rest-path" transform="scale(0.111111) translate(-495 -154)" d="M507.3916,171.1987c0,0.5762,0.2881,1.2241,0.9365,1.8003c0.5762,0.6479,0.9365,1.1519,0.9365,1.4399c0,0.8643-0.6484,2.0884-1.873,3.8164c-1.2236,1.728-2.2314,2.5205-3.0234,2.5205s-1.2246-0.2881-1.4404-0.9365c-0.0723-0.2158-0.0723-0.8638-0.0723-1.9438c0-0.936,0.792-4.3926,2.4482-10.3691c-1.3682,0.2881-2.4482,0.3604-3.3838,0.3604c-3.8887,0-5.833-2.1602-5.833-6.5527c0-2.9521,0.792-5.9043,2.376-8.7847l1.3682-2.3042c-0.2881-1.0083-0.4316-2.0161-0.4316-3.0962c0-2.8804,0.8643-5.8325,2.4482-8.7852c-1.0078-1.1519-1.584-2.8081-1.584-4.9683c0-1.8003,0.5762-4.1045,1.584-6.8403c1.2959-3.2407,2.6641-4.8965,4.1768-4.8965c0.6475,0,0.9355,0.3599,0.9355,1.0801c0,0.6479-0.1436,1.584-0.5039,2.7363c-0.2881,1.1519-0.4316,2.0161-0.4316,2.5918c0,1.6562,0.8633,2.4482,2.6641,2.4482c1.7998,0,3.8164-0.7197,5.9043-2.2319c1.0078-0.7202,2.7363-2.0884,5.04-4.1763c0.2168-0.144,0.5762-0.2881,1.1523-0.2881c1.1523,0,1.7285,0.7197,1.7285,2.0879c0,0.5762-0.0723,1.0801-0.2158,1.3682c-6.4814,15.4097-11.0898,28.3706-13.8262,38.8833C507.752,169.1108,507.3916,170.7666,507.3916,171.1987z M509.4082,153.269c-1.8721,0.4321-3.3125,0.6484-4.3926,0.6484c-1.0078,0-1.8721-0.2163-2.5918-0.6484c-0.1445,0.3604-0.2881,0.6484-0.4326,0.8643c-0.1436,0.6479-0.2158,1.2964-0.2158,1.8721c0,1.5845,0.8643,2.3765,2.6641,2.3765c0.9365,0,2.1602-0.2881,3.8164-0.936C508.4004,156.7974,508.832,155.4297,509.4082,153.269z M513.5127,138.8682c-4.1768,0.8638-6.4805,1.2959-6.9844,1.2959c-0.4326,0-0.8643,0-1.2246-0.0718c-0.1436,0.7197-0.2158,1.2241-0.2158,1.6558c0,1.6562,0.8643,2.4482,2.6641,2.4482c1.1523,0,2.5928-0.4316,4.4648-1.4399C512.2168,142.7563,512.6484,141.4604,513.5127,138.8682z"/>
                <path id="rest[0.25]"  class="rest-path" transform="scale(0.111111) translate(-467 -154)" d="M478.5918,168.4624c0,0.6484,0.2168,1.2964,0.7207,1.8726c0.5039,0.5757,0.792,1.0801,0.792,1.3677c0,0.7925-0.7197,2.0884-2.1602,3.8164c-1.4404,1.7285-2.5205,2.5923-3.2402,2.5923c-0.8643,0-1.2959-0.4321-1.2959-1.4399c0-2.4482,1.0078-6.4805,3.0957-12.1689c-1.8721,0.4316-3.3838,0.6479-4.4639,0.6479c-3.3848,0-5.041-2.0161-5.041-6.1929c0-2.8081,1.0078-5.9043,3.1689-9.3604c-0.7207-1.0083-1.1523-2.4482-1.1523-4.3208c0-1.7998,0.7197-4.248,2.0879-7.2725c1.584-3.3843,3.168-5.1123,4.7529-5.1123c0.5752,0,0.8633,0.2881,0.8633,0.8638c0,0.7202-0.2158,1.6562-0.7197,2.9526c-0.5039,1.2959-0.7197,2.3042-0.7197,2.9521c0,1.4399,0.792,2.0879,2.4482,2.0879c1.8721,0,3.96-0.7197,6.2646-2.3042c0.8633-0.5757,2.5918-1.9438,5.2559-4.1763c0.2158-0.144,0.5762-0.2881,1.1523-0.2881c1.0801,0,1.584,0.5762,1.584,1.7285c0,0.7197-0.1436,1.2959-0.3604,1.728c-3.3115,6.3364-5.5439,10.729-6.624,13.105c-2.376,4.9688-4.1768,9.5049-5.4727,13.6812C478.8799,167.2383,478.5918,168.3184,478.5918,168.4624z M481.832,150.1011c-4.3203,0.8638-6.6963,1.2959-7.0557,1.2959c-0.4326,0-0.8643,0-1.2246-0.0718c-0.2881,0.8638-0.4316,1.584-0.4316,2.0879c0,1.3682,0.8633,2.0166,2.5195,2.0166c1.0801,0,2.5928-0.4321,4.5371-1.4404C480.6084,152.7651,481.1846,151.4692,481.832,150.1011z"/>
                <g id="rest[0.375]">
                    <use xlink:href="#rest[0.25]"></use>
                    <use xlink:href="#dot" transform="translate(0 1)"></use>
                </g>
                <path id="rest[0.5]"   class="rest-path" transform="scale(0.111111) translate(-444 -154)" d="M454.4014,160.0381c0,0.6479,0.2158,1.2959,0.7197,1.8721c0.5039,0.5757,0.792,1.0801,0.792,1.3682c0,0.792-0.7197,2.0879-2.1602,3.8159c-1.4404,1.7285-2.5205,2.5923-3.2402,2.5923c-0.792,0-1.2959-0.2881-1.5117-0.8638c-0.0723-0.2881-0.1445-0.936-0.1445-1.9443c0-1.0078,2.2324-6.1924,6.6963-15.6973c-4.248,0.8643-6.6963,1.2241-7.2725,1.2241c-3.6719,0-5.4727-2.0161-5.4727-6.1206c0-1.8003,0.6484-4.2485,2.0166-7.2725c1.584-3.3125,3.168-5.0405,4.752-5.0405c0.5762,0,0.8643,0.2881,0.8643,0.8638c0,0.7202-0.2158,1.6562-0.7197,2.9526c-0.5039,1.2959-0.7197,2.2319-0.7197,2.9521c0,1.3682,0.792,2.0161,2.4473,2.0161c1.7285,0,3.8164-0.7202,6.4092-2.2324c2.1602-1.2959,4.0322-2.6641,5.4727-4.1763c0.4316-0.144,0.792-0.2158,1.2236-0.2158c1.0801,0,1.584,0.5762,1.584,1.6562c0,0.5757-0.1436,1.1519-0.4316,1.728c-0.8643,1.9443-2.6641,4.9683-5.3281,9.1445c-2.5205,3.8164-4.3213,7.0566-5.3291,9.6489C454.6895,159.3179,454.4727,159.894,454.4014,160.0381z"/>
                <g id="rest[0.75]">
                    <use xlink:href="#rest[0.5]"></use>
                    <use xlink:href="#dot" transform="translate(0 1)"></use>
                </g>
                <path id="rest[1]" class="rest-path" transform="scale(0.111111) translate(-418 -154)" d="M431.4346,152.5493c2.4482,0.4321,3.8877,0.6479,4.3926,0.7197c1.8721,0.3604,3.2402,0.7925,4.1035,1.2241c-0.1436,0.2881-2.3037,2.8804-6.2637,7.7769c-3.5283,4.3203-5.2568,6.6245-5.2568,6.9126c0,0.7202,0.5762,1.8003,1.7285,3.3843c1.1514,1.584,1.7998,2.8081,1.7998,3.8164c0,1.2241-0.7197,2.4482-2.0879,3.6724c-1.3682,1.2959-2.665,1.8721-3.8164,1.8721c-1.8721,0-2.8086-1.5122-2.8086-4.6084c0-2.3042,2.5205-7.4888,7.7051-15.4814c-1.2246-0.4321-2.7363-0.792-4.6084-1.0078c-1.5127-0.0723-3.0967-0.2163-4.6807-0.3604v-0.2881c-0.1445-1.728,2.376-5.3281,7.5605-10.8008c-0.792-0.3599-1.9443-0.936-3.4561-1.8003c-4.7529-2.8081-7.0566-6.6963-7.0566-11.665c0-2.52,0.5039-4.6802,1.6562-6.4805c0.9355-1.5122,2.5195-3.168,4.8242-4.8965c-0.4326,2.3042-0.6484,4.0327-0.6484,5.1846c0,2.7363,1.1523,5.1123,3.6006,7.1289c2.2324,1.8721,5.4727,2.8081,9.7207,2.8799c2.0166,0.0723,3.0967,0.4321,3.0967,1.0083c0,0.5039-1.4404,2.376-4.249,5.6885C434.8906,148.5171,433.1621,150.5332,431.4346,152.5493z"/>
                <g id="rest[1.5]">
                    <use xlink:href="#rest[1]"></use>
                    <use xlink:href="#dot" transform="translate(0 1)"></use>
                </g>
                <path id="rest[2]" class="rest-path" transform="translate(-43.6 -17) scale(0.1111)" d="M418.5479,143.0444v1.4399c0.0723,2.1602-0.4316,5.1128-1.4404,8.7129h-26.9297c0.2158-3.8882,0.792-7.2007,1.6562-9.937c2.9521,0,7.416,0,13.3926-0.0718C411.2031,143.1162,415.668,143.0444,418.5479,143.0444z"/>
                <g id="rest[3]">
                    <use xlink:href="#rest[2]"></use>
                    <use xlink:href="#dot" transform="translate(0 0)"></use>
                </g>
                <g id="rest[4]">
                    <use xlink:href="#rest[2]" transform="translate(0 -1)"></use>
                </g>
                <path id="dot" class="scribe-symbol" transform="translate(-70     -36.28) scale(0.1111)" d="M661.3232,322.9727c0,1.0078-0.4316,2.4482-1.2959,4.248c-0.9365,2.0166-1.7998,3.1689-2.5918,3.3125c-0.3604,0.1445-1.7285,0.1445-4.249,0.1445h-1.2236c-1.1523,0-1.7285-0.5039-1.7285-1.5117c0-0.7207,0.4316-2.0176,1.3682-3.9609c1.0078-1.8721,1.7285-3.0957,2.3047-3.5283c0.2871-0.1436,1.584-0.2881,3.8877-0.2881c1.2959,0,2.0166,0.0723,2.2324,0.0723C660.8916,321.6768,661.3232,322.1807,661.3232,322.9727z"/>
                <path id="acci-flat"    class="acci-path" transform="scale(0.054) translate(-606.4 -191)" d="M629.4297,136.6357c1.4404,0,2.5928,0.8643,3.3848,2.5923c0.5039,1.2959,0.792,2.8081,0.792,4.5366c0,5.04-1.9443,10.6567-5.7607,16.8491c-2.9521,4.8247-6.624,9.5771-11.1611,14.1855l0.5762-60.1255c1.0078-1.1519,2.0879-1.8003,3.2402-1.8003c0.2881,0,0.4326,0.0723,0.5762,0.0723l-0.2881,29.2344C622.877,138.5078,625.7578,136.6357,629.4297,136.6357z M625.9014,145.6367c-1.0801,0-2.376,1.0801-3.7441,3.168c-1.2959,1.9443-1.9443,3.3843-2.0156,4.3208l-0.1445,8.2085c4.9688-4.6802,7.4883-9.2168,7.4883-13.6094C627.4854,146.3564,626.9102,145.6367,625.9014,145.6367z"/>
                <path id="acci-natural" class="acci-path" transform="scale(0.054) translate(-644 -191)"   d="M669.0293,136.9961l-2.9521,56.6685c-1.0088,0.7202-1.585,1.0801-1.873,1.0801c-0.792,0-1.1514,0-1.0801-0.0718l1.6562-30.8906c-0.5039,1.1519-1.7998,2.2319-3.7441,3.312s-3.5283,1.5845-4.8242,1.5845c-0.7197,0-1.4404-0.144-1.9443-0.4321l2.8799-54.5806c0.7207-0.4321,1.2969-0.6484,1.7285-0.6484c0.9365,0,1.2959,0,1.1523,0l-1.0078,28.4429c0.4316-0.8643,1.9434-1.8726,4.5361-2.9526C666.0049,137.5,667.8047,136.9961,669.0293,136.9961z M664.9961,148.4448c-2.6641,0.7202-4.8242,2.0161-6.4805,3.8882l-0.2158,5.4727c2.7363-0.4321,4.8242-1.4399,6.3369-3.1685C664.7803,153.4854,664.9248,151.4692,664.9961,148.4448z"/>
                <path id="acci-sharp"   class="acci-path" transform="scale(0.054) translate(-624.5 -191)" d="M655.709,134.8354c0.1445,0.4321,0.2168,1.1523,0.2168,2.3042c0,1.2964-0.1445,2.5923-0.2881,4.0327c0,0.5757-0.1445,1.4399-0.4326,2.52c-0.5039,1.0083-2.3037,2.3042-5.3281,3.7446l-0.2881,6.6963c1.6562-1.2241,3.0967-1.8721,4.1768-1.8721c0.2871,0,0.5752,1.584,0.7197,4.7524c0.0723,1.0078,0.0723,1.728,0.0723,2.3042c0,1.728-0.0723,2.7363-0.3604,3.168c-0.0723,0.2163-1.8721,1.4404-5.3281,3.6724c0,3.3125-0.1445,6.6968-0.3604,10.2969c-0.0723,1.4404-0.1445,2.8804-0.2158,4.2485c-0.2881,2.3042-0.7207,3.4565-1.3682,3.4565c-0.0723,0.0718-0.1445,0.0718-0.1445,0.0718c-0.792,0-1.1514-1.9443-1.1514-5.8325c0-0.936,0-2.376,0.1436-4.3203c0.0723-1.9443,0.1436-3.3843,0.1436-4.3926c0-1.0078-0.0713-1.6558-0.2158-2.0161c-1.0078,0.144-1.7275,0.5039-2.2314,1.0083c-0.0723,1.9438-0.2168,4.8242-0.4326,8.5688c-0.0723,2.0161-0.1436,3.96-0.2158,5.8325c-0.1445,3.3843-0.4326,5.2563-0.6484,5.6162c-0.2158,0.2163-0.4316,0.2881-0.7197,0.2881c-1.0078,0-1.5117-1.5122-1.5117-4.6802c0-2.3047,0.3594-7.1289,0.9355-14.6177c-1.4404,0.5044-2.8799,1.0083-4.3926,1.4404c-0.7197,0-1.0078-1.9443-1.0078-5.9048c0-0.2881,0-0.792,0.0723-1.5122c0-0.7197,0.0713-1.2241,0.0713-1.5117c0.1445-0.4321,1.0088-1.0083,2.4482-1.8003c1.0088-0.4321,1.9443-0.936,2.9531-1.5122c0.2871-1.4399,0.3594-3.3843,0.2871-5.6885l-0.0713-0.8643c-1.2959,0.7202-2.8809,1.3682-4.7529,2.0161c-0.3594-0.1436-0.5039-0.792-0.5039-1.9438c0-0.8643,0.0723-2.3765,0.3604-4.4644c0.2158-2.0884,0.4316-3.4565,0.7197-4.1045c1.0078-0.8643,2.6641-1.9443,5.1123-3.3125c0-1.7998,0.1445-4.5361,0.3604-8.2803c0.2881-4.9688,0.792-7.4888,1.5117-7.4888c0.8643,0,1.2969,2.3042,1.2969,6.7686c0,1.728-0.1445,4.1763-0.4326,7.4165c0.792,0,1.7285-0.3599,2.8086-1.1519c0.2881-0.4321,0.5762-4.8965,0.8643-13.4653c0.2881-7.8486,1.1514-11.8091,2.5918-11.8091c0.5762,1.1523,0.8643,2.5205,0.8643,4.1045c0,4.4644-0.4326,11.0889-1.1523,20.0176C653.0449,135.4839,654.7012,134.8354,655.709,134.8354z M647.501,148.7329c-1.0801,0.5039-2.3047,1.2241-3.8887,2.2319c-0.1436,2.3042-0.2158,4.1045-0.2158,5.4009c0,0.5757,0,1.0078,0,1.2959c1.0801-0.4321,2.3037-1.0801,3.7441-2.0884C647.1406,154.0615,647.2842,151.7573,647.501,148.7329z"/>

                <!-- Stems -->
                <line id="stemup"   class="stem-path" x1="2.4" y1="0" x2="2.4" y2="6"></line>
                <line id="stemdown" class="stem-path" x1="0.1" y1="0.3" x2="0.1" y2="7"></line>

                <!-- Ties -->
                <path id="tie" class="tie-path" transform="translate(0, 0.14) scale(1 0.6)" d="M0.979174733,0.0124875307 C0.650597814,1.1195554 0.135029714,1.00095361 0.0165376402,0.026468657 C0.0113570514,0.0135475362 0.00253387291,0.00218807553 0,0 C0.0977526897,1.29523004 0.656681642,1.37089992 1,2.43111793e-08 C0.991901367,2.43111797e-08 0.987703936,0.01248753 0.979174733,0.0124875307 Z M0.979174733,0.0124875307"></path>

                <!-- Tails -->
                <path id="tailup[0.5]"    class="tail-path" transform="translate(-33.14  -42) scale(0.1111)" d="M335.6724,356.0957c-0.5039,0-0.936-0.1445-1.2959-0.5762c-0.4321-0.3594-0.5762-0.792-0.5762-1.2246c0-0.2148,0.0723-0.5039,0.2163-0.791c1.0078-2.3047,1.584-4.8965,1.584-7.7773c0-9.6484-5.8325-18.1455-17.3535-25.418v-16.3457c1.728,1.4404,4.2485,3.6006,7.5605,6.5527c8.6406,8.8574,12.9614,20.5215,12.9614,34.9238c0,1.7275-0.2163,3.6719-0.6484,5.9756C337.4727,354.584,336.6807,356.0957,335.6724,356.0957z"/>
                <path id="taildown[0.5]"  class="tail-path" transform="translate(-42.3  -30.5) scale(0.1111)" d="M404.5039,283.8735c1.1514,4.248,1.7275,8.6406,1.7275,13.105c0,8.9287-3.3125,19.3691-9.793,31.251c-4.6797,8.4971-10.2246,14.041-16.6328,16.7773v-11.2334c0-1.4395,1.6562-3.7441,4.9678-6.9844c3.3848-3.0244,6.6973-6.1211,10.0088-9.2168c3.8164-3.8887,6.1934-7.1289,7.0566-9.7207c1.2969-4.1758,2.0166-7.8486,2.0166-10.873l-0.2881-4.3921c-0.0723-0.7202-0.3604-1.9443-0.792-3.6724c-0.3604-1.5845-0.5762-2.7363-0.5762-3.6006C402.1992,284.3057,402.9912,283.8013,404.5039,283.8735z"/>
                <path id="tailup[0.25]"   class="tail-path" transform="translate(-37.7  -42) scale(0.1111)" d="M371.5986,371.793c-0.5049,0-0.8643-0.7207-1.2246-2.2324c2.7363-3.2402,4.1045-6.2637,4.1045-9.1445c0-2.5195-0.792-5.3281-2.376-8.4961c-1.4404-2.5928-3.0967-5.041-5.1846-7.2012c-0.792-0.8643-2.0879-1.9443-3.8887-3.3848c-1.7275-1.4395-3.0244-2.5195-3.6719-3.2402v-31.8984c6.2646,2.5918,11.1611,7.416,14.7607,14.3291c3.2402,6.2646,4.8965,13.0332,4.8965,20.3779c0,1.8721-0.792,4.6084-2.2324,8.3525c0.5049,1.7285,0.793,3.5283,0.793,5.4014c0,7.1279-1.873,12.7441-5.4727,16.8486C371.958,371.7207,371.7422,371.793,371.5986,371.793z M376.4229,342.0547c0-3.3125-3.1689-8.6406-9.5049-15.9141c-1.2246-1.2236-3.0967-3.0957-5.5449-5.6162v4.3926c5.7607,4.4639,10.585,10.9443,14.6172,19.4424C376.2783,343.3506,376.4229,342.6309,376.4229,342.0547z"/>
                <path id="taildown[0.25]" class="tail-path" transform="translate(-51.24  -30.5) scale(0.1111)"  d="M460.2285,319.8047c0-1.0078,1.6562-2.6641,4.9678-5.041c3.3125-2.3037,6.625-4.6797,10.0088-6.9844c3.8164-2.8799,6.1934-5.2559,7.0566-7.2725c1.2969-3.0962,2.0166-5.7603,2.0166-7.9927c0-0.2881-0.1436-1.2959-0.3604-3.1685c0-0.2876-0.2158-0.792-0.5039-1.584s-0.4316-1.2241-0.4316-1.3682c0-0.2881,0.2158-0.5039,0.7197-0.7202c0.4326-0.2158,0.8643-0.3599,1.1523-0.3599s0.5039,0.0723,0.6484,0.0723c0.7197,2.4482,1.1514,4.896,1.1514,7.2007c0,2.5918-0.5039,5.2563-1.3682,7.9204c0.8643,2.5928,1.3682,5.3291,1.3682,8.208c0,3.8887-0.8643,7.5615-2.4482,10.9453c-1.584,3.457-2.7363,5.833-3.3838,7.1289c-1.3682,2.7363-2.7363,4.9688-4.0322,6.7686c-2.3047,3.3125-4.7529,5.9053-7.2012,7.7764c-2.4482,1.873-5.5439,3.6729-9.3604,5.2568V319.8047z M461.8125,334.0625c0.4316-0.4326,2.0156-1.585,4.6084-3.457c4.248-2.7363,7.1289-4.8242,8.7842-6.1211c3.8887-3.0234,6.1934-5.4717,7.0566-7.416c1.2969-3.168,2.0166-5.832,2.0166-7.9209c0-1.9443-0.2158-3.5283-0.5762-4.8242c-3.7441,7.417-6.5527,12.3857-8.4248,14.833c-3.3125,4.3203-7.7764,7.7051-13.4648,10.2969V334.0625z"/>
                <use  id="tailup[0.375]"   href="#tailup[0.25]"></use>
                <use  id="taildown[0.375]" href="#taildown[0.25]"></use>
                <use  id="tailup[0.75]"    href="#tailup[0.5]"></use>
                <use  id="taildown[0.75]"  href="#taildown[0.5]"></use>

                <!-- Note heads -->
                <use  id="head[0.125]" href="#head[1]"></use>
                <use  id="head[0.25]"  href="#head[1]"></use>
                <use  id="head[0.375]" href="#head[1.5]"></use>
                <use  id="head[0.5]"   href="#head[1]"></use>
                <use  id="head[0.75]"  href="#head[1.5]"></use>
                <path id="head[1]" class="head-path" transform="translate(-18.9 -36.28) scale(0.1111)" d="M177.2754,335.8613c-2.0884,0-3.8164-0.3594-5.2568-1.1514c-1.728-1.0088-2.5918-2.4482-2.5918-4.3926c0-3.0244,1.7998-6.1201,5.5444-9.4326c3.6001-3.168,6.9126-4.752,9.9365-4.752c5.7607,0,8.6411,2.2314,8.6411,6.6953c0,3.0254-1.9443,6.0488-5.9766,8.9297C183.8999,334.4941,180.4434,335.8613,177.2754,335.8613z"/>
                <g id="head[1.5]">
                    <use xlink:href="#head[1]"></use>
                    <use xlink:href="#dot" transform="translate(0.8 0.5)"></use>
                </g>
                <path id="head[2]" class="head-path" transform="translate(-16.3 -36.28) scale(0.1111)" d="M169.5732,322.1094c0,1.6553-0.3599,3.168-1.1523,4.4639c-1.5117,2.6641-4.4644,5.1846-8.8564,7.6318c-4.4644,2.4492-8.2808,3.6729-11.521,3.6729c-1.8721,0-3.4565-0.6475-4.6807-2.0166c-1.1519-1.3672-1.728-2.9512-1.728-4.8242c0-4.0312,2.2324-7.9199,6.8408-11.5928c4.4644-3.5283,8.9287-5.3281,13.3931-5.3281C166.981,314.1162,169.5732,316.7803,169.5732,322.1094z M160.5005,325.4209c0-1.1514-0.2163-2.376-0.7202-3.8164c-0.7202-1.7275-1.584-2.5918-2.5923-2.5918c-2.3042,0-4.0322,1.1514-5.3281,3.3115c-1.0083,1.7285-1.4404,3.8164-1.4404,6.1211c0,3.0957,0.8643,4.6084,2.5923,4.6084c2.0161,0,3.7441-0.792,5.2563-2.376S160.5005,327.3652,160.5005,325.4209z"/>
                <g id="head[3]">
                    <use xlink:href="#head[2]"></use>
                    <use xlink:href="#dot" transform="translate(1 0.5)"></use>
                </g>
                <path id="head[4]" class="head-path" transform="translate(-12.6 -36.28) scale(0.1111)" d="M118.0923,336.0781c-6.0488,0-9.001-2.1602-9.001-6.4805c0-3.8887,2.6641-7.2734,8.1367-10.1533c4.7524-2.5205,9.5049-3.8154,14.3291-3.8154c2.7363,0,5.0405,0.5752,6.9126,1.6553c2.1602,1.2236,3.2402,2.9521,3.2402,5.1846c0,2.9521-1.0801,5.3281-3.168,7.2012c-2.1602,1.8711-5.2568,3.4551-9.5049,4.6797C125.2207,335.502,121.5483,336.0781,118.0923,336.0781z M131.269,326.2129c0-4.4648-1.7998-6.7686-5.4004-6.7686c-2.0161,0-3.6724,0.9365-5.0405,2.8086s-2.0161,3.6729-2.0161,5.4717c0,3.0967,1.8721,4.6094,5.6167,4.6094c2.0161,0,3.6001-0.5762,4.8965-1.7285C130.6211,329.4531,131.269,327.9414,131.269,326.2129z"/>
                <g id="head[6]">
                    <use xlink:href="#head[4]"></use>
                    <use xlink:href="#dot" transform="translate(0 0)"></use>
                </g>
                <path id="head[x]" class="head-path" transform="translate(-5.84 -34.2) scale(0.105)" d="M72.8774,337.5898c-1.5122,0-3.1685-0.6484-5.0405-1.9434c-1.3682-1.0088-2.8081-2.0889-4.1763-3.0967c-0.5039,0.2158-1.4399,1.3682-2.8081,3.3838c-1.2964,2.0166-2.3042,3.0244-2.9521,3.0244c-0.7925,0-1.1523-0.5039-1.1523-1.584c0-1.1514,1.584-4.1045,4.7524-8.7842c-0.5762-0.9365-1.2241-1.873-1.8721-2.8086c-1.1523-1.9443-1.728-3.8887-1.728-5.9043c0-3.0967,1.2959-5.5449,4.0322-7.3457c0.144-0.0713,0.2158-0.1436,0.2881-0.1436c0.2158,0,0.5757,0.792,1.0078,2.2324c0.936,3.0244,2.3042,5.4004,3.9604,7.2725c1.5122-1.8721,2.9521-3.8164,4.4644-5.7598c2.4482-3.0967,4.1045-4.6816,4.9683-4.6816c0.2881,0,0.4321,0.1445,0.4321,0.4326c0,0.9365-1.1519,3.2402-3.5283,6.8408c-2.3042,3.5996-3.4561,5.4727-3.4561,5.6162c0,0.8643,0.8638,1.7998,2.7363,2.8799c1.8721,1.0801,3.3843,1.584,4.5361,1.584c0.2881,0,0.3599,0.3613,0.3599,0.9365c0,1.1523-0.4316,2.665-1.4399,4.5361C75.1816,336.5098,74.0293,337.5898,72.8774,337.5898z"/>
                <path id="head[v]" class="head-path" transform="translate(-9.3 -35.86) scale(0.11)" d="M109.0942,319.373v4.1758c-0.5757,1.0078-2.2319,3.0957-4.9683,6.2646c-3.2402,3.8164-6.9844,8.208-11.3047,13.1045c-7.3447-5.4004-12.3853-8.5684-15.0493-9.4316v-4.6816c2.7358-3.3115,5.4722-6.624,8.2803-9.9355c3.3843-4.249,5.8325-7.7773,7.2007-10.5137c3.9604,3.3848,6.4087,5.4727,7.417,6.2646C104.0542,317.1406,106.79,318.7246,109.0942,319.373z M103.8379,323.6934c-2.8804-1.4404-6.0483-3.8164-9.5767-7.1289c-1.2241,2.0879-4.8247,6.3359-10.729,12.8164c1.0801,0.8652,4.2485,3.0967,9.6489,6.8418C95.4131,333.3418,99.0137,329.166,103.8379,323.6934z"/>

                <!-- Ledger lines -->
                <g id="ledges">
                    <line x1="0" x2="4.4" y1="8" y2="8"></line>
                    <line x1="0" x2="4.4" y1="6" y2="6"></line>
                    <line x1="0" x2="4.4" y1="4" y2="4"></line>
                    <line x1="0" x2="4.4" y1="2" y2="2"></line>
                    <line x1="0" x2="4.4" y1="0" y2="0"></line>
                    <line x1="0" x2="4.4" y1="2" y2="2"></line>
                    <line x1="0" x2="4.4" y1="4" y2="4"></line>
                    <line x1="0" x2="4.4" y1="6" y2="6"></line>
                    <line x1="0" x2="4.4" y1="8" y2="8"></line>
                </g>

                <!-- Clefs -->
                <symbol id="treble-clef" viewBox="0 -4 10 8" style="overflow: visible;">
                    <path transform="translate(-9.8 -16) scale(0.1111)" d="M108.2324,146.5005c0,2.0884-0.3599,5.1846-1.0801,9.2168c-0.7202,4.2485-1.4399,7.2007-2.1602,8.9292c-2.0161,4.752-4.8965,8.8564-8.7129,12.1689c-0.936,0.8638-2.5923,2.0161-4.8242,3.5283c-0.144,0.144-0.2881,0.2158-0.3599,0.2881c0,0,0.2158,1.0801,0.6479,3.3843c0.5762,3.312,0.8638,5.8325,0.8638,7.7046c0,3.8164-0.5039,7.9204-1.5117,12.313c-1.3682,6.1924-3.2407,9.2168-5.5444,9.2168c-0.7925,0-1.4404-1.2241-1.8726-3.7441c-0.3599-1.7285-0.5039-3.4565-0.5039-5.1846c3.4565-5.9048,5.2563-11.4492,5.2563-16.6333c0-0.7202-0.144-1.7285-0.2881-2.8804c-0.2881-1.5845-0.5757-2.4482-0.936-2.4482c-0.2881,0-0.7197,0.0718-1.2959,0.2158c-0.5039,0.144-0.936,0.2881-1.0801,0.2881c-1.6562,0.2881-3.4565,0.3599-5.3286,0.3599c-7.4888,0-13.1772-2.4478-17.0654-7.4165c-3.5283-4.4644-5.2563-10.5127-5.2563-18.2173c0-5.4009,1.584-12.9614,4.7524-22.7544c1.2241-3.7441,2.8081-7.9204,4.6084-12.5288c1.8721-4.3926,3.6724-8.8569,5.5444-13.3213c3.2402-7.7764,4.8242-11.9531,4.7524-12.3848l-4.4644-36.2915c0.4321-1.7998,1.3682-2.7363,2.5923-2.7363c0.5757,0,1.6558,0.5762,3.2402,1.6562c6.3364,4.5366,9.5049,12.0972,9.5049,22.7539c0,5.1846-1.6562,11.7373-4.9688,19.73c-0.792,2.0161-1.2241,3.0244-1.2241,3.0244c0,1.6558,0.4321,7.3442,1.2241,16.9932c0.8643,9.8647,1.3682,15.1216,1.6562,15.6973c1.6562-1.7998,3.6001-3.312,5.9043-4.5361c2.5923-1.2964,4.9688-2.0161,7.2007-2.0161C104.6323,130.8755,108.2324,136.1318,108.2324,146.5005z M81.0859,139.876l-2.4482-27.4341c-3.6001,7.9927-6.8403,15.6973-9.7207,23.186c-4.5361,11.665-6.7686,19.2256-6.7686,22.5376c0,4.4644,1.728,7.4888,5.1846,9.001c0.0718,0.0718,0.8643,0.3599,2.376,0.8643c0-7.2007,2.4482-14.6895,7.417-22.4663C78.062,144.3403,79.3579,142.4683,81.0859,139.876z M85.0464,167.6704c-0.5039-3.6001-1.0801-9.1445-1.8721-16.4893c-1.2959,1.4399-3.0962,3.7441-5.4727,6.9126c-2.4482,4.1763-3.6001,7.7046-3.6001,10.5127c0.7202,0.2881,1.6562,0.3604,2.7363,0.3604C78.4219,168.9668,81.1582,168.5347,85.0464,167.6704z M82.8145,80.543c0-0.936-0.5044-2.1602-1.5122-3.6001c-1.0083-1.4404-1.8721-2.1602-2.6646-2.1602c-0.5757,0-0.8638,0.5757-0.8638,1.6558c0,5.4004,0.5762,11.2329,1.728,17.4258c0.6479-2.2324,1.3682-4.4644,2.0161-6.6968C82.3823,84.2153,82.8145,81.9829,82.8145,80.543z M102.9761,146.2129c0-1.0083-0.792-1.8726-2.2324-2.5923c-1.2241-0.5762-2.376-0.8643-3.5283-0.8643c-1.3677,0-3.3843,0.792-6.2642,2.2324c-3.0967,1.6558-4.6084,3.0962-4.6084,4.248c0,2.0884,0.2158,4.8965,0.5757,8.353c0.4321,4.3921,0.6484,7.2002,0.7925,8.4243c2.8799-1.0078,6.1201-3.8159,9.7207-8.4243C101.104,152.9814,102.9761,149.165,102.9761,146.2129z"/>
                </symbol>
                <symbol id="piano-clef" viewBox="0 -4 10 8" style="overflow: visible;">
                    <path transform="translate(-9.8 -16) scale(0.1111)" d="M108.2324,146.5005c0,2.0884-0.3599,5.1846-1.0801,9.2168c-0.7202,4.2485-1.4399,7.2007-2.1602,8.9292c-2.0161,4.752-4.8965,8.8564-8.7129,12.1689c-0.936,0.8638-2.5923,2.0161-4.8242,3.5283c-0.144,0.144-0.2881,0.2158-0.3599,0.2881c0,0,0.2158,1.0801,0.6479,3.3843c0.5762,3.312,0.8638,5.8325,0.8638,7.7046c0,3.8164-0.5039,7.9204-1.5117,12.313c-1.3682,6.1924-3.2407,9.2168-5.5444,9.2168c-0.7925,0-1.4404-1.2241-1.8726-3.7441c-0.3599-1.7285-0.5039-3.4565-0.5039-5.1846c3.4565-5.9048,5.2563-11.4492,5.2563-16.6333c0-0.7202-0.144-1.7285-0.2881-2.8804c-0.2881-1.5845-0.5757-2.4482-0.936-2.4482c-0.2881,0-0.7197,0.0718-1.2959,0.2158c-0.5039,0.144-0.936,0.2881-1.0801,0.2881c-1.6562,0.2881-3.4565,0.3599-5.3286,0.3599c-7.4888,0-13.1772-2.4478-17.0654-7.4165c-3.5283-4.4644-5.2563-10.5127-5.2563-18.2173c0-5.4009,1.584-12.9614,4.7524-22.7544c1.2241-3.7441,2.8081-7.9204,4.6084-12.5288c1.8721-4.3926,3.6724-8.8569,5.5444-13.3213c3.2402-7.7764,4.8242-11.9531,4.7524-12.3848l-4.4644-36.2915c0.4321-1.7998,1.3682-2.7363,2.5923-2.7363c0.5757,0,1.6558,0.5762,3.2402,1.6562c6.3364,4.5366,9.5049,12.0972,9.5049,22.7539c0,5.1846-1.6562,11.7373-4.9688,19.73c-0.792,2.0161-1.2241,3.0244-1.2241,3.0244c0,1.6558,0.4321,7.3442,1.2241,16.9932c0.8643,9.8647,1.3682,15.1216,1.6562,15.6973c1.6562-1.7998,3.6001-3.312,5.9043-4.5361c2.5923-1.2964,4.9688-2.0161,7.2007-2.0161C104.6323,130.8755,108.2324,136.1318,108.2324,146.5005z M81.0859,139.876l-2.4482-27.4341c-3.6001,7.9927-6.8403,15.6973-9.7207,23.186c-4.5361,11.665-6.7686,19.2256-6.7686,22.5376c0,4.4644,1.728,7.4888,5.1846,9.001c0.0718,0.0718,0.8643,0.3599,2.376,0.8643c0-7.2007,2.4482-14.6895,7.417-22.4663C78.062,144.3403,79.3579,142.4683,81.0859,139.876z M85.0464,167.6704c-0.5039-3.6001-1.0801-9.1445-1.8721-16.4893c-1.2959,1.4399-3.0962,3.7441-5.4727,6.9126c-2.4482,4.1763-3.6001,7.7046-3.6001,10.5127c0.7202,0.2881,1.6562,0.3604,2.7363,0.3604C78.4219,168.9668,81.1582,168.5347,85.0464,167.6704z M82.8145,80.543c0-0.936-0.5044-2.1602-1.5122-3.6001c-1.0083-1.4404-1.8721-2.1602-2.6646-2.1602c-0.5757,0-0.8638,0.5757-0.8638,1.6558c0,5.4004,0.5762,11.2329,1.728,17.4258c0.6479-2.2324,1.3682-4.4644,2.0161-6.6968C82.3823,84.2153,82.8145,81.9829,82.8145,80.543z M102.9761,146.2129c0-1.0083-0.792-1.8726-2.2324-2.5923c-1.2241-0.5762-2.376-0.8643-3.5283-0.8643c-1.3677,0-3.3843,0.792-6.2642,2.2324c-3.0967,1.6558-4.6084,3.0962-4.6084,4.248c0,2.0884,0.2158,4.8965,0.5757,8.353c0.4321,4.3921,0.6484,7.2002,0.7925,8.4243c2.8799-1.0078,6.1201-3.8159,9.7207-8.4243C101.104,152.9814,102.9761,149.165,102.9761,146.2129z"/>
                </symbol>
                <path id="bass-clef"  class="clef-path" transform="translate(-29 -9.2)   scale(0.092)" d="M300.395,214.4746c0.0723,0-0.5039-0.2163-1.728-0.6479c0-1.5845,0.144-4.0327,0.4321-7.3447c0-0.144,0.144-0.6479,0.4321-1.5122c0.2158-0.8643,0.3599-1.3682,0.3599-1.6562c0-0.144-0.0718-0.2158-0.0718-0.2881c7.2002-3.312,13.5371-8.3525,19.0093-15.1934c5.9048-7.3442,8.8569-14.7612,8.8569-22.1055c0-1.8726-0.4321-4.0327-1.3682-6.625c-3.1685-8.9287-9.6489-13.3931-19.5137-13.3931c-3.0962,0-6.5527,1.4404-10.3691,4.2485c-4.0322,3.0244-6.0483,5.9766-6.0483,8.9287c0,1.0083,0.6479,2.0161,2.0161,3.1685c1.3682,1.1519,2.0884,2.8799,2.0884,5.04c0,4.6084-0.6479,6.8408-1.9443,6.8408c-0.4321,0-1.0801-0.3599-1.8003-1.0801c-2.8799-2.5923-4.3203-6.1924-4.3203-10.8008c0-7.7051,1.8003-14.4736,5.4004-20.3062c4.2485-6.7686,10.0093-10.1528,17.2817-10.1528c7.6328,0,13.4653,3.5283,17.5693,10.4409c3.3843,5.8325,5.1128,12.8174,5.1128,20.9541c0,12.1689-2.5923,22.3218-7.7769,30.5308c-0.6479,1.1519-2.376,3.6001-5.2563,7.2002c-1.728,2.2324-4.6084,4.9688-8.6406,8.1367C305.5078,212.6025,302.2671,214.4746,300.395,214.4746z M351.4473,140.1641c0,1.4404-0.2158,2.9521-0.6475,4.6084c-0.5039,2.1602-1.2246,3.4565-2.0889,3.7446c-0.2158,0.1436-1.3682,0.2876-3.3115,0.5757c-2.0166,0.2881-3.1689,0.3604-3.6006,0.3604c-1.5122,0-2.2324-0.7925-2.2324-2.3765c0-0.8638,0.2881-2.376,0.8643-4.4644c0.6484-2.0884,1.2236-3.3843,1.7285-3.9604c0.2871-0.2158,1.4395-0.4316,3.5283-0.7197c1.9434-0.2163,3.2402-0.3604,3.96-0.3604C350.8711,137.5718,351.4473,138.436,351.4473,140.1641z M310.5479,114.8179c0-0.144-0.2158-0.2158-0.5757-0.2158c-0.8643,0-1.2964,1.0078-1.2964,2.9521c0.5762-0.2881,1.0801-0.5039,1.5122-0.792C310.4038,116.5459,310.5479,115.8979,310.5479,114.8179z M351.4473,140.1641c0,1.4404-0.2158,2.9521-0.6475,4.6084c-0.5039,2.1602-1.2246,3.4565-2.0889,3.7446c-0.2158,0.1436-1.3682,0.2876-3.3115,0.5757c-2.0166,0.2881-3.1689,0.3604-3.6006,0.3604c-1.5122,0-2.2324-0.7925-2.2324-2.3765c0-0.8638,0.2881-2.376,0.8643-4.4644c0.6484-2.0884,1.2236-3.3843,1.7285-3.9604c0.2871-0.2158,1.4395-0.4316,3.5283-0.7197c1.9434-0.2163,3.2402-0.3604,3.96-0.3604C350.8711,137.5718,351.4473,138.436,351.4473,140.1641z M351.4473,159.1738c0,1.4399-0.2158,2.9521-0.6475,4.6084c-0.5039,2.1602-1.2246,3.4561-2.0889,3.7441c-0.2158,0.144-1.3682,0.2881-3.3115,0.5762c-2.0166,0.2881-3.1689,0.3599-3.6006,0.3599c-1.5122,0-2.2324-0.792-2.2324-2.376c0-0.8643,0.2881-2.3765,0.8643-4.4644c0.6484-2.0884,1.2236-3.3843,1.7285-3.9604c0.2871-0.2158,1.4395-0.4321,3.5283-0.7202c1.9434-0.2158,3.2402-0.3599,3.96-0.3599C350.8711,156.5815,351.4473,157.4458,351.4473,159.1738z" />
                <path id="drums-clef" transform="translate(-2.5 2.6)" class="clef-path" d="M0,2.2 L1.2,2.2 L1.2,5.8 L0,5.8 Z M1.9,2.2 L3.1,2.2 L3.1,5.8 L1.9,5.8 Z" />
            </defs>
        </svg>
    `,construct:function(e,t){let r=e.querySelector("link");ja.push(u=>r.href=u),yt.value&&(r.href=yt.value),t.data=he.of(),t.clef=he.of("treble"),t.key=he.of("C"),t.meter=he.of([-4,"meter",4,1]),t.transpose=he.of(0),t.isSafari=navigator.userAgent.includes("AppleWebKit/")&&!navigator.userAgent.includes("Chrome/")&&!navigator.userAgent.includes("Edge/")&&!navigator.userAgent.includes("Gecko/")},connect:function(e,t){if(t.isSafari&&this.classList.add("safari"),he.from(()=>t.data.value&&fr(t.data.value.events,t.clef.value,t.key.value,t.meter.value,t.transpose.value).reduce(us,[])).each(r=>{e.querySelectorAll(".bar").forEach(u=>u.remove()),e.append.apply(e,r)}),!this.src){let r=this.textContent.trim();t.data.value=Re(this.type,r)}}},{clef:{attribute:function(e){this.clef=e},get:function(){return W(this).clef.value},set:function(e){if(!ct[e]){console.warn('<scribe-music> Attempt to set invalid clef="'+e+'" ignored');return}W(this).clef.value=e}},key:{attribute:function(e){this.key=e===""?"C":""},get:function(){return W(this).key.value},set:function(e){let t=W(this);if(typeof e!="string"||!/^[A-G][#b♯♭]?$/.test(e)){console.warn('<scribe-music> Attempt to set invalid key="'+e+'" ignored');return}t.key.value=e.replace(/[#b]$/,r=>r==="#"?"♯":"♭")}},meter:{attribute:function(e){this.meter=e===""?"4/4":e},get:function(){return ps(W(this).meter.value)},set:function(e){W(this).meter.value=ds(e)}},transpose:{attribute:function(e){this.transpose=e},get:function(){return W(this).transpose.value},set:function(e){W(this).transpose.value=typeof e=="number"?Math.round(e):parseInt(e,10)}},type:{attribute:function(e){this.type=e},writable:!0},src:{attribute:function(e){this.src=e},get:function(){return W(this).src},set:function(e){let t=W(this);t.src=e,Qa(this.type,e).then(r=>this.data=r)},default:null},data:{get:function(){return W(this).data.value},set:function(e){W(this).data.value=e},default:null}}),{stylesheet:{set:e=>yt.value=e,get:()=>yt.value}});export{cl as default};
